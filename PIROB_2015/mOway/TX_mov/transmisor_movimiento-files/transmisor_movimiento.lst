gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00001 ;***************************************************************************
               00002 ;*                              mowayWorld                                 *
               00003 ;***************************************************************************
               00004 ;*Description:                                                             *
               00005 ;*Automatically generated code                                             *
               00006 ;***************************************************************************
               00007 ;***************************************************************************
               00008         list p=18F86j50
               00009    ;*   Include mOways microcontroller
               00010    #include "inc\P18F86j50.INC"
               00001         LIST
               00002 
               00003 ;==========================================================================
               00004 ;  MPASM PIC18F86J50 processor include
               00005 ; 
               00006 ;  (c) Copyright 1999-2007 Microchip Technology, All rights reserved
               00007 ;==========================================================================
               00008 
               02339         LIST
               00011 
               00012 ;****************************************
               00013 ;*   Variables                          *
               00014 ;****************************************
  0000007E     00015 adelante       EQU    0x7E 
  0000007D     00016 girar          EQU    0x7D 
  0000007C     00017 sensorLuz      EQU    0x7C 
               00018 
               00019 ;*      Reset Vector
1000           00020   org           0x1000
1000 EFAD F014 00021   goto  INIT
               00022 ;*      Program memory  *
102A           00023   org           0x102A
               00024 ;************************
               00025 ;***************************[MOWAY LIBRARIES]*********************************************
               00026   #include "inc\lib_sen_moway_GUI.inc"
               00001 ;********************************************************************************
               00002 ;*    lib_re_sen_moway.inc                                                      *
               00003 ;*    version: 2.0                                                              *
               00004 ;*    Esta librería contiene las funciones necesarias para gestionar los        *
               00005 ;*    sensores del robot Moway en ensamblador con código reubicable             *
               00006 ;*    Copyright (C) 2009  Bizintek Innova S.L.                                  *
               00007 ;*                                                                              *
               00008 ;********************************************************************************
               00009 ;*    This program is free software; you can redistribute it and/or modify      *
               00010 ;*    it under the terms of the GNU General Public License as published by      *
               00011 ;*    the Free Software Foundation; either version 2 of the License, or         *
               00012 ;*    (at your option) any later version.                                       *
               00013 ;*                                                                              *
               00014 ;*    This program is distributed in the hope that it will be useful,           *
               00015 ;*    but WITHOUT ANY WARRANTY; without even the implied warranty of            *
               00016 ;*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             *
               00017 ;*    GNU General Public License for more details.                              *
               00018 ;*                                                                              *
               00019 ;*    You should have received a copy of the GNU General Public License along   *
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00020 ;*    with this program; if not, write to the Free Software Foundation, Inc.,   *
               00021 ;*    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.               *
               00022 ;********************************************************************************
               00023 
               00024 ;Elimina los warning de cambio de banco
               00025  ERRORLEVEL -302 
               00026 
               00027 ;********************
               00028 ;*   DEFINICIONES   *
               00029 ;********************
               00030 
               00031 ;NIVEL BATERÍA
               00032 
102A 00033 #define   MIN_BAT_ADC                                           .132                    ;3.3v
102A 00034 #define   MAX_BAT_ADC                                           .162                    ;4.2v
102A 00035 #define   DIV_100_MAX_BAT_ADC_MIN_BAT_ADC   .3
               00036 
102A 00037 #define   ACCE_TAP_SENSI                                        b'01110000'                     ;3.3v
102A 00038 #define   ACCE_TAP_WINDOW                                       b'01111111'                     ;3.3v
102A 00039 #define   ACCE_TAP_LAT                                          b'00000100'                     ;3.3v
               00040 
               00041 
               00042 ; PORTA
102A 00043 #define   LIGHT_SEN                PORTA,0
102A 00044 #define   IR_RX_L_1            PORTA,1
102A 00045 #define   LINE_RX_R            PORTA,2
102A 00046 #define   IR_RX_L_2            PORTA,3
102A 00047 #define   LINE_RX_L            PORTA,5
               00048 
               00049 ; PORTB
               00050 
102A 00051 #define   ACCE_INT1_DRDY           PORTB,1
102A 00052 #define   ACCE_INT2            PORTB,2
102A 00053 #define   SPEAKER              PORTB,3
102A 00054 #define   LED_TOP_RED          PORTB,5
102A 00055 #define   LED_TOP_GREEN        PORTB,6
               00056 
               00057 ; PORTC
102A 00058 #define   LED_FRONT            PORTC,7
               00059 ; PORTD
102A 00060 #define   LINE_TX              PORTD,1
102A 00061 #define   ACCE_SDO                         PORTD,4
102A 00062 #define   ACCE_SDI                         PORTD,5
102A 00063 #define   ACCE_SCL                         PORTD,6
102A 00064 #define   ACCE_CSN                         PORTD,7
               00065 ; PORTE
102A 00066 #define   LED_BRAKE                        PORTE,5
               00067 
               00068 ; PORTF
102A 00069 #define   IR_RX_R_2            PORTF,5
102A 00070 #define   IR_RX_R_1            PORTF,6
               00071 ; PORTH
102A 00072 #define   NTC                  PORTH,5
102A 00073 #define   BATTERY_IN           PORTH,6
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
102A 00074 #define   MIC_IN               PORTH,7
               00075 
               00076 ; PORTJ
102A 00077 #define   LED_IR               PORTJ,7
102A 00078 #define   IR_TX                PORTJ,6
               00079 
               00080 
               00081 ; TRISA
102A 00082 #define   LIGHT_SEN_TRIS       TRISA,0
102A 00083 #define   IR_RX_L_1_TRIS       TRISA,1
102A 00084 #define   LINE_RX_R_TRIS       TRISA,2
102A 00085 #define   IR_RX_L_2_TRIS       TRISA,3
102A 00086 #define   LINE_RX_L_TRIS       TRISA,5
               00087 
               00088 ; TRISB
102A 00089 #define   ACCE_INT1_DRDY_TRIS  TRISB,1
102A 00090 #define   ACCE_INT2_TRIS       TRISB,2
102A 00091 #define   SPEAKER_TRIS          TRISB,3
102A 00092 #define   LED_TOP_RED_TRIS     TRISB,5
102A 00093 #define   LED_TOP_GREEN_TRIS   TRISB,6
               00094 ; TRISC
102A 00095 #define   LED_FRONT_TRIS       TRISC,7
               00096 
               00097 ; TRISE
102A 00098 #define   LED_BRAKE_TRIS           TRISE,5
               00099 ; TRISD
102A 00100 #define   LINE_TX_TRIS         TRISD,1
102A 00101 #define   ACCE_SDI_TRIS            TRISD,5
102A 00102 #define   ACCE_SDO_TRIS            TRISD,4
102A 00103 #define   ACCE_SCL_TRIS            TRISD,6
102A 00104 #define   ACCE_CSN_TRIS            TRISD,7
               00105 ; TRISF
102A 00106 #define   IR_RX_R_2_TRIS       TRISF,5
102A 00107 #define   IR_RX_R_1_TRIS       TRISF,6
               00108 ; TRISH
102A 00109 #define   NTC_TRIS             TRISH,5
102A 00110 #define   BATTERY_TRIS         TRISH,6
102A 00111 #define   MIC_IN_TRIS          TRISH,7
               00112 ; TRISJ
102A 00113 #define   LED_IR_TRIS          TRISJ,7
102A 00114 #define   IR_TX_TRIS           TRISJ,6
               00115 
               00116 ; Registros acelerometro
102A 00117 #define XOUTL           0x00
102A 00118 #define XOUTH           0x01
102A 00119 #define YOUTL           0x02
102A 00120 #define YOUTH           0x03
102A 00121 #define ZOUTL           0x04
102A 00122 #define ZOUTH           0x05
102A 00123 #define XOUT8           0x06
102A 00124 #define YOUT8           0x07
102A 00125 #define ZOUT8           0x08
102A 00126 #define STATUS_ACCE     0x09
102A 00127 #define DETSRC          0x0A
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
102A 00128 #define TOUT            0x0B
102A 00129 #define I2CAD           0x0D
102A 00130 #define USRINF          0x0E
102A 00131 #define WHOAMI          0x0F
102A 00132 #define XOFFL           0x10
102A 00133 #define XOFFH           0x11
102A 00134 #define YOFFL           0x12
102A 00135 #define YOFFH           0x13
102A 00136 #define ZOFFL           0x14
102A 00137 #define ZOFFH           0x15
102A 00138 #define MCTL            0x16
102A 00139 #define INTRST          0x17
102A 00140 #define CTL1            0x18
102A 00141 #define CTL2            0x19
102A 00142 #define LDTH            0x1A
102A 00143 #define PDTH            0x1B
102A 00144 #define PW                      0x1C
102A 00145 #define LT                      0x1D
102A 00146 #define TW                      0x1E
               00147 
               00148 ;* Variable FLAGS_MOT
102A 00149 #define         SENOK                   1               ;Lectura del sensor obstaculos correcta (1) o incorrecta (0)
102A 00150 #define         TAP                             0
102A 00151 #define         TAP_TAP                 1
               00152 
102A 00153 #define         OBS_CENTER_L    0
102A 00154 #define         OBS_SIDE_L              1
102A 00155 #define         OBS_CENTER_R    2
102A 00156 #define         OBS_SIDE_R              3
               00157 
102A 00158 #define         SPEAKER_OFF             0
102A 00159 #define         SPEAKER_ON              1
102A 00160 #define         SPEAKER_TIME    2
               00161 ;****************
               00162 ;*      VARIABLES       *
               00163 ;****************
               00164 ;(BANK0)
               00165         cblock  0xc0
               00166 ;Variables usuario
               00167 SEN_LIGHT_P                                                     ;Porcentage de luz incidente en sensor de luz
               00168 SEN_BATTERY_P                                                   ;Porcentage de batería
               00169 SEN_TEMPERATURE_C                                               ;Temperatura en ºC      
               00170 SEN_MIC                                                                 ;Valor micrófono
               00171 SEN_SPEAKER_FREQ                        ;Frecuencia del zumbador
               00172 SEN_SPEAKER_TIME                                                ;Tiempo zumbador
               00173 SEN_SPEAKER_ON_OFF                                              ;Indica si se quiere encender/apagar o temporizar el zumbador
               00174 SEN_LINE_L                                                      ;Salida del sensor de línea izquierdo
               00175 SEN_LINE_R                                                      ;Salida del sensor de línea derecho
               00176 SEN_OBS_CENTER_L                                                ;Salida del sensor de obstáculos izquierdo central
               00177 SEN_OBS_CENTER_R                                                ;Salida del sensor de obstáculos derecho central
               00178 SEN_OBS_SIDE_L                                                  ;Salida del sensor de obstáculos izquierdo lateral
               00179 SEN_OBS_SIDE_R                                                  ;Salida del sensor de obstáculos derecho lateral
               00180 SEN_CHECK_OBS                                                   ;Indicación chequear obstáculo
               00181 SEN_ACCE_BYTE_OUT_1                                             ;Byte para acelerometro
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE  5


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00182 SEN_ACCE_BYTE_OUT_2                                             ;Byte para acelerometro
               00183 SEN_ACCE_BYTE_IN_1                                              ;Byte para acelerometro
               00184 SEN_ACCE_BYTE_IN_2                                              ;Byte para acelerometro
               00185 SEN_ACCE_X                                                              ;Valor x del acelerometro
               00186 SEN_ACCE_Y                                                              ;Valor x del acelerometro
               00187 SEN_ACCE_Z                                                              ;Valor x del acelerometro
               00188 ACCE_NO_HIGH                                                    ;Variable para contador
               00189 ACCE_NO_LOW                                                             ;Variable para contador
               00190 ACCE_ADRESS                                                             ;Variables para función de comunicación con acelerometro
               00191 ACCE_DATA_OUT                                                   ;Variables para función de comunicación con acelerometro                        
               00192 ACCE_DATA_IN                                                    ;Variables para función de comunicación con acelerometro
               00193 SEN_ACCE_TAP                                                    ;Variable para detecta golpes y caida
               00194 SEN_STATUS                                                              ;Estado de lectura de sensor
               00195 ;
               00196 ;;Variables SEN internas
               00197 AUX_00  
               00198 AUX_01
               00199 INTER_SEN                               
               00200 DELAY_1                                 
               00201 DELAY_1_1                               
               00202 TEMP0
               00203         endc
               00204 
               00205 
               00206 ;************
               00207 ;*      CÓDIGO  *
               00208 ;************
               00209 
               00210 ;*****************************************************
               00211 ;*                   SEN_CONFIG                      *
               00212 ;*****************************************************
               00213 ;*Descripción: La función configura las E/S del PIC y*
               00214 ;*a su vez configura el ADC                                                      *
               00215 ;*****************************************************
               00216 ;*Variables de entrada:                              *
               00217 ;*Variables de salida:                               *
               00218 ;*****************************************************
               00219 
102A 00220 SEN_CONFIG
               00221 
102A ECEE F00C 00222         call    SEN_INTER_CALL
               00223 
               00224         ;Initialization
102E 010F      00225         banksel PORTA
1030 6A80      00226         clrf    PORTA
1032 6A81      00227         clrf    PORTB
1034 6A82      00228         clrf    PORTC
1036 6A83      00229         clrf    PORTD
1038 6A84      00230         clrf    PORTE
103A 6A85      00231         clrf    PORTF
103C 6A86      00232         clrf    PORTG
103E 6A87      00233         clrf    PORTH
1040 6A88      00234         clrf    PORTJ
1042 010F      00235         banksel TRISA
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1044 6A92      00236         clrf    TRISA
1046 6A93      00237         clrf    TRISB
1048 6A94      00238         clrf    TRISC
104A 6A95      00239         clrf    TRISD
104C 6A96      00240         clrf    TRISE
104E 6A97      00241         clrf    TRISF
1050 6A98      00242         clrf    TRISG
1052 6A99      00243         clrf    TRISH
1054 6A9A      00244         clrf    TRISJ
               00245 
               00246         ;Deshabilitar puerto paralelo
1056 010F      00247         banksel PMCONH
1058 6B4B      00248         clrf    PMCONH
               00249 
               00250         ;Deshabilitar comparador
105A 010F      00251         banksel CM1CON
105C 6AD2      00252         clrf    CM1CON
105E 010F      00253         banksel CM2CON
1060 6AD1      00254         clrf    CM2CON
               00255 
               00256         ;Configuración del ADC
1062 010F      00257         banksel WDTCON
1064 98C0      00258         bcf             WDTCON,ADSHR
1066 010F      00259         banksel ADCON0
1068 0E00      00260         movlw   b'00000000'
106A 6EC2      00261         movwf   ADCON0
               00262 
106C 010F      00263         banksel ADCON1
106E 0E23      00264         movlw   b'00100011'
1070 6EC1      00265         movwf   ADCON1
               00266 
1072 010F      00267         banksel WDTCON
1074 88C0      00268         bsf             WDTCON,ADSHR
1076 010F      00269         banksel ANCON0
1078 0EFF      00270         movlw   b'11111111'
107A 6EC1      00271         movwf   ANCON0
               00272 
107C 010F      00273         banksel ANCON1
107E 0EFF      00274         movlw   b'11111111'
1080 6EC2      00275         movwf   ANCON1
1082 010F      00276         banksel WDTCON
1084 98C0      00277         bcf             WDTCON,ADSHR
               00278 
               00279         ;Desahbilitar circuito Vref
1086 010F      00280         banksel CVRCON
1088 6A77      00281         clrf    CVRCON
               00282         
               00283         ;Deshabilitar PLL
108A 010F      00284         banksel OSCTUNE
108C 9C9B      00285         bcf             OSCTUNE,PLLEN
               00286         
               00287 
               00288         ;Configuración TRIS
108E 010F      00289         banksel TRISA
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1090 8092      00290         bsf             LIGHT_SEN_TRIS   
1092 8492      00291         bsf             LINE_RX_R_TRIS 
1094 8A92      00292         bsf             LINE_RX_L_TRIS  
1096 8692      00293         bsf             IR_RX_L_2_TRIS  
1098 8292      00294         bsf             IR_RX_L_1_TRIS       
109A 010F      00295         banksel TRISE
109C 9A96      00296         bcf             LED_BRAKE_TRIS 
109E 010F      00297         banksel TRISC
10A0 9E94      00298         bcf             LED_FRONT_TRIS   
10A2 010F      00299         banksel TRISB
10A4 9A93      00300         bcf             LED_TOP_RED_TRIS
10A6 9C93      00301         bcf             LED_TOP_GREEN_TRIS  
10A8 9693      00302         bcf             SPEAKER_TRIS  
10AA 010F      00303         banksel TRISD
10AC 9295      00304         bcf             LINE_TX_TRIS 
10AE 010F      00305         banksel TRISF
10B0 8C97      00306         bsf             IR_RX_R_1_TRIS  
10B2 8A97      00307         bsf             IR_RX_R_2_TRIS 
10B4 010F      00308         banksel TRISJ
10B6 9E9A      00309         bcf             LED_IR_TRIS  
10B8 9C9A      00310         bcf             IR_TX_TRIS  
10BA 010F      00311         banksel TRISH
10BC 8A99      00312         bsf             NTC_TRIS
10BE 8C99      00313         bsf             BATTERY_TRIS
10C0 8E99      00314         bsf     MIC_IN_TRIS 
               00315 
               00316 
               00317         ;Configuración spi para leer el acelerometro
               00318 
               00319         ;I/O Configuration
10C2 010F      00320         banksel TRISD
10C4 8A95      00321         bsf             ACCE_SDI_TRIS              
10C6 9895      00322         bcf             ACCE_SDO_TRIS              
10C8 9C95      00323         bcf             ACCE_SCL_TRIS              
10CA 9E95      00324         bcf             ACCE_CSN_TRIS              
               00325         ;I/Os are configured 
10CC 010F      00326         banksel TRISB
10CE 8293      00327         bsf             ACCE_INT1_DRDY_TRIS
10D0 8493      00328         bsf             ACCE_INT2_TRIS
10D2 010F      00329         banksel PMCONH
10D4 6B4B      00330         clrf    PMCONH
10D6 010F      00331         banksel PORTD
10D8 8E83      00332         bsf             ACCE_CSN
               00333 
               00334         ;Configuration of SPI module
10DA 010F      00335         banksel SSP2STAT
10DC 0EC0      00336         movlw   b'11000000'
10DE 6E6D      00337         movwf   SSP2STAT
10E0 010F      00338         banksel SSP2CON2
10E2 6A6B      00339         clrf    SSP2CON2
               00340 
10E4 010F      00341         banksel SSP2CON1
10E6 0E20      00342         movlw   b'00100000'
10E8 6E6C      00343         movwf   SSP2CON1
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00344 
               00345         ;Configurar acelerometro para detección de pulso.
10EA 0100      00346         banksel ACCE_ADRESS
10EC 0E16      00347         movlw   MCTL
10EE 6FD7      00348         movwf   ACCE_ADRESS
10F0 0E43      00349         movlw   b'01000011'
10F2 6FD8      00350         movwf   ACCE_DATA_OUT
10F4 ECAF F00C 00351         call    ACCE_WRITE
               00352 
               00353         ;Configuración para TAP
               00354         ;Configuración sensibilidad
10F8 0100      00355         banksel ACCE_ADRESS
10FA 0E1B      00356         movlw   PDTH
10FC 6FD7      00357         movwf   ACCE_ADRESS
10FE 0E70      00358         movlw   ACCE_TAP_SENSI
1100 6FD8      00359         movwf   ACCE_DATA_OUT
1102 ECAF F00C 00360         call    ACCE_WRITE
               00361 
               00362         ;Ventana de pulso
1106 0100      00363         banksel ACCE_ADRESS
1108 0E1C      00364         movlw   PW
110A 6FD7      00365         movwf   ACCE_ADRESS
110C 0E7F      00366         movlw   ACCE_TAP_WINDOW
110E 6FD8      00367         movwf   ACCE_DATA_OUT
1110 ECAF F00C 00368         call    ACCE_WRITE
               00369 
               00370         ;Latencia con el segundo pulso
1114 0100      00371         banksel ACCE_ADRESS
1116 0E1D      00372         movlw   LT
1118 6FD7      00373         movwf   ACCE_ADRESS
111A 0E04      00374         movlw   ACCE_TAP_LAT
111C 6FD8      00375         movwf   ACCE_DATA_OUT
111E ECAF F00C 00376         call    ACCE_WRITE
               00377 
               00378         ;Ventana del segundo pulso
1122 0100      00379         banksel ACCE_ADRESS
1124 0E1E      00380         movlw   TW
1126 6FD7      00381         movwf   ACCE_ADRESS
1128 0E7F      00382         movlw   ACCE_TAP_WINDOW
112A 6FD8      00383         movwf   ACCE_DATA_OUT
112C ECAF F00C 00384         call    ACCE_WRITE
               00385 
               00386         ;Asignación interrupciones
1130 0100      00387         banksel ACCE_ADRESS
1132 0E18      00388         movlw   CTL1
1134 6FD7      00389         movwf   ACCE_ADRESS
1136 0E04      00390         movlw   b'00000100'
1138 6FD8      00391         movwf   ACCE_DATA_OUT
113A ECAF F00C 00392         call    ACCE_WRITE
               00393 
113E 010F      00394         banksel PORTB
               00395         ;Por defecto el LED verde está apagado
1140 8C81      00396         bsf             LED_TOP_GREEN   
               00397         ;Por defecto el LED rojo está apagado
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1142 8A81      00398         bsf             LED_TOP_RED     
               00399         ;Por defecto el LED verde está apagadoç
1144 010F      00400         banksel PORTE
1146 9A84      00401         bcf             LED_BRAKE       
               00402         ;Por defecto el LED rojo está apagado
1148 010F      00403         banksel PORTC
114A 8E82      00404         bsf             LED_FRONT       
               00405 
               00406 
114C 6BC0      00407         clrf    SEN_LIGHT_P                                                     ;Porcentage de luz incidente en sensor de luz
114E 6BC1      00408         clrf    SEN_BATTERY_P                                                   ;Porcentage de batería
1150 6BC2      00409         clrf    SEN_TEMPERATURE_C                                               ;Temperatura en ºC      
1152 6BC3      00410         clrf    SEN_MIC                                                                 ;Valor micrófono
1154 6BC4      00411         clrf    SEN_SPEAKER_FREQ                         ;Frecuencia del zumbador
1156 6BC5      00412         clrf    SEN_SPEAKER_TIME                                                ;Tiempo zumbador
1158 6BC7      00413         clrf    SEN_LINE_L                                                      ;Salida del sensor de línea izquierdo
115A 6BC8      00414         clrf    SEN_LINE_R                                                      ;Salida del sensor de línea derecho
115C 6BC9      00415         clrf    SEN_OBS_CENTER_L                                                ;Salida del sensor de obstáculos izquierdo central
115E 6BCA      00416         clrf    SEN_OBS_CENTER_R                                                ;Salida del sensor de obstáculos derecho central
1160 6BCB      00417         clrf    SEN_OBS_SIDE_L                                                  ;Salida del sensor de obstáculos izquierdo lateral
1162 6BCC      00418         clrf    SEN_OBS_SIDE_R                                                  ;Salida del sensor de obstáculos derecho lateral
1164 6BCE      00419         clrf    SEN_ACCE_BYTE_OUT_1                                             ;Byte para acelerometro
1166 6BCF      00420         clrf    SEN_ACCE_BYTE_OUT_2                                             ;Byte para acelerometro
1168 6BD0      00421         clrf    SEN_ACCE_BYTE_IN_1                                              ;Byte para acelerometro
116A 6BD1      00422         clrf    SEN_ACCE_BYTE_IN_2                                              ;Byte para acelerometro
116C 6BD2      00423         clrf    SEN_ACCE_X                                                              ;Valor x del acelerometro
116E 6BD3      00424         clrf    SEN_ACCE_Y                                                              ;Valor x del acelerometro
1170 6BD4      00425         clrf    SEN_ACCE_Z                                                              ;Valor x del acelerometro
1172 6BD5      00426         clrf    ACCE_NO_HIGH                                                    ;Variable para contador
1174 6BD6      00427         clrf    ACCE_NO_LOW                                                             ;Variable para contador
1176 6BD7      00428         clrf    ACCE_ADRESS                                                             ;Variables para función de comunicación con acelerometro
1178 6BD8      00429         clrf    ACCE_DATA_OUT                                                   ;Variables para función de comunicación con acelerometro                        
117A 6BD9      00430         clrf    ACCE_DATA_IN                                                    ;Variables para función de comunicación con acelerometro
117C 6BDA      00431         clrf    SEN_ACCE_TAP                                                    ;Variable para detecta golpes y caida
117E 6BDB      00432         clrf    SEN_STATUS                                                              ;Estado de lectura de sensor
               00433 
               00434         ;Variables SEN internas
1180 6BDC      00435         clrf    AUX_00  
1182 6BDD      00436         clrf    AUX_01
1184 6BDE      00437         clrf    INTER_SEN                               
1186 6BDF      00438         clrf    DELAY_1                                 
1188 6BE0      00439         clrf    DELAY_1_1                               
               00440 
118A ECF6 F00C 00441         call    SEN_INTER_RETURN
               00442 
118E 0012      00443         return
               00444 ;*****************************************************
               00445 
               00446 
               00447 
               00448 
               00449 ;*****************************************************
               00450 ;*                  SEN_LIGHT                        *
               00451 ;*****************************************************
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 10


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00452 ;*Descripción:Devuelve el porcentage de luz          *
               00453 ;*recibida por el sensor de luz (0-100)              *
               00454 ;*****************************************************
               00455 ;*Variables de entrada:                              *
               00456 ;*Variables de salida: -SEN_LIGHT_P                  *
               00457 ;*****************************************************
               00458 
1190 00459 SEN_LIGHT
1190 ECEE F00C 00460         call    SEN_INTER_CALL
               00461 
               00462         ;Se selecciona el canal0 del ADC y se espera el
               00463         ;tiempo de adquisición del convertidor analógico
               00464         ;digital
               00465         ;Configuramos las entradas como analógicas
1194 010F      00466         banksel WDTCON
1196 88C0      00467         bsf             WDTCON,ADSHR
1198 010F      00468         banksel ANCON0
119A 0EFE      00469         movlw   b'11111110'
119C 6EC1      00470         movwf   ANCON0
119E 010F      00471         banksel WDTCON
11A0 98C0      00472         bcf             WDTCON,ADSHR
               00473 
11A2 0E01      00474         movlw   b'00000001'             
11A4 010F      00475         banksel ADCON0
11A6 6EC2      00476         movwf   ADCON0
               00477 ;       call    Delay_100us
               00478 
               00479         ;Lectura y calculo del porcentage de luz incidente
11A8 82C2      00480         bsf             ADCON0,GO
11AA 00481 SEN_LIGHT_TAG_00
11AA B2C2      00482         btfsc   ADCON0,GO       
11AC EFD5 F008 00483         goto    SEN_LIGHT_TAG_00
11B0 010F      00484         banksel ADRESH
11B2 50C4      00485         movf    ADRESH,W        
11B4 0100      00486         banksel SEN_LIGHT_P             
11B6 6FC0      00487         movwf   SEN_LIGHT_P
11B8 010F      00488         banksel STATUS
11BA 90D8      00489         bcf             STATUS,C
11BC 0100      00490         banksel SEN_LIGHT_P
11BE 33C0      00491         rrcf    SEN_LIGHT_P,F
11C0 010F      00492         banksel ADCON0
11C2 90C2      00493         bcf             ADCON0,ADON
               00494 
11C4 ECF6 F00C 00495         call    SEN_INTER_RETURN
11C8 0012      00496         return
               00497 ;*****************************************************
               00498 
               00499 
               00500 ;*****************************************************
               00501 ;*                  SEN_BATTERY                      *
               00502 ;*****************************************************
               00503 ;*Descripción:Devuelve el nivel de batería                   *
               00504 ;*****************************************************
               00505 ;*Variables de entrada:                              *
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 11


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00506 ;*Variables de salida: -SEN_BATTERY_P                *
               00507 ;*****************************************************
               00508 
11CA 00509 SEN_BATTERY
11CA ECEE F00C 00510         call    SEN_INTER_CALL
               00511 
               00512         ;Se selecciona el canal0 del ADC y se espera el
               00513         ;tiempo de adquisición del convertidor analógico
               00514         ;digital
               00515         ;Configuramos las entradas como analógicas
11CE 010F      00516         banksel WDTCON
11D0 88C0      00517         bsf             WDTCON,ADSHR
11D2 010F      00518         banksel ANCON1
11D4 0EBF      00519         movlw   b'10111111'
11D6 6EC2      00520         movwf   ANCON1
11D8 010F      00521         banksel WDTCON
11DA 98C0      00522         bcf             WDTCON,ADSHR
               00523 
11DC 0E39      00524         movlw   b'00111001'             
11DE 010F      00525         banksel ADCON0
11E0 6EC2      00526         movwf   ADCON0
11E2 EC27 F00D 00527         call    Delay_100us
               00528 
               00529         ;Lectura y calculo del nivel de batería
11E6 82C2      00530         bsf             ADCON0,GO
11E8 00531 SEN_BATTERY_TAG_00
11E8 B2C2      00532         btfsc   ADCON0,GO       
11EA EFF4 F008 00533         goto    SEN_BATTERY_TAG_00
11EE 010F      00534         banksel ADRESH
11F0 50C4      00535         movf    ADRESH,W        
11F2 0100      00536         banksel SEN_BATTERY_P           
11F4 6FC1      00537         movwf   SEN_BATTERY_P
               00538 
               00539         ;Comprobar límites 100%
11F6 010F      00540         banksel STATUS
11F8 90D8      00541         bcf             STATUS,C
11FA 0100      00542         banksel SEN_BATTERY_P
11FC 08A2      00543         sublw   MAX_BAT_ADC
11FE 010F      00544         banksel STATUS
1200 A0D8      00545         btfss   STATUS,C
1202 EF19 F009 00546         goto    SEN_BATTERY_TAG_01      
               00547 
               00548         ;Comprobar límites 0%
1206 010F      00549         banksel STATUS
1208 90D8      00550         bcf             STATUS,C
120A 0100      00551         banksel SEN_BATTERY_P
120C 51C1      00552         movf    SEN_BATTERY_P,W
120E 0884      00553         sublw   MIN_BAT_ADC
1210 010F      00554         banksel STATUS
1212 B0D8      00555         btfsc   STATUS,C
1214 EF21 F009 00556         goto    SEN_BATTERY_TAG_02      
               00557 
               00558         ;Calcular valor %
1218 0100      00559         banksel SEN_BATTERY_P
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 12


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
121A 0E84      00560         movlw   MIN_BAT_ADC
121C 5DC1      00561         subwf   SEN_BATTERY_P,W
121E 0D03      00562         mullw   DIV_100_MAX_BAT_ADC_MIN_BAT_ADC
1220 010F      00563         banksel PRODL
1222 50F3      00564         movf    PRODL,W
1224 0100      00565         banksel SEN_BATTERY_P
1226 6FC1      00566         movwf   SEN_BATTERY_P
               00567 
               00568 
1228 010F      00569         banksel ADCON0
122A 90C2      00570         bcf             ADCON0,ADON
               00571 
122C ECF6 F00C 00572         call    SEN_INTER_RETURN
1230 0012      00573         return
               00574 
               00575 
1232 00576 SEN_BATTERY_TAG_01
1232 0100      00577         banksel SEN_BATTERY_P
1234 0E64      00578         movlw   .100
1236 6FC1      00579         movwf   SEN_BATTERY_P
1238 010F      00580         banksel ADCON0
123A 90C2      00581         bcf             ADCON0,ADON
123C ECF6 F00C 00582         call    SEN_INTER_RETURN
1240 0012      00583         return
1242 00584 SEN_BATTERY_TAG_02
1242 0100      00585         banksel SEN_BATTERY_P
1244 0E00      00586         movlw   .0
1246 6FC1      00587         movwf   SEN_BATTERY_P
1248 010F      00588         banksel ADCON0
124A 90C2      00589         bcf             ADCON0,ADON
124C ECF6 F00C 00590         call    SEN_INTER_RETURN
1250 0012      00591         return
               00592 ;*****************************************************
               00593 
               00594 
               00595 ;*****************************************************
               00596 ;*                  SEN_TEMPERATURE                  *
               00597 ;*****************************************************
               00598 ;*Descripción:Devuelbe la temperatura                        *
               00599 ;*****************************************************
               00600 ;*Variables de entrada:                              *
               00601 ;*Variables de salida: -SEN_TEMPERATURE_P            *
               00602 ;*****************************************************
               00603 
1252 00604 SEN_TEMPERATURE
1252 ECEE F00C 00605         call    SEN_INTER_CALL
               00606 
               00607         ;Se selecciona el canal0 del ADC y se espera el
               00608         ;tiempo de adquisición del convertidor analógico
               00609         ;digital
               00610         ;Configuramos las entradas como analógicas
1256 010F      00611         banksel WDTCON
1258 88C0      00612         bsf             WDTCON,ADSHR
125A 010F      00613         banksel ANCON1
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 13


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
125C 0EDF      00614         movlw   b'11011111'
125E 6EC2      00615         movwf   ANCON1
1260 010F      00616         banksel WDTCON
1262 98C0      00617         bcf             WDTCON,ADSHR
               00618 
1264 0E35      00619         movlw   b'00110101'             
1266 010F      00620         banksel ADCON0
1268 6EC2      00621         movwf   ADCON0
126A EC27 F00D 00622         call    Delay_100us
               00623 
               00624         ;Lectura y calculo de temperatura
126E 82C2      00625         bsf             ADCON0,GO
1270 00626 SEN_TEMPERATURE_TAG_00
1270 B2C2      00627         btfsc   ADCON0,GO       
1272 EF38 F009 00628         goto    SEN_TEMPERATURE_TAG_00
1276 010F      00629         banksel ADRESH
1278 50C4      00630         movf    ADRESH,W        
127A 0100      00631         banksel SEN_TEMPERATURE_C               
127C 6FC2      00632         movwf   SEN_TEMPERATURE_C
127E 0E45      00633         movlw   .69
1280 010F      00634         banksel STATUS
1282 90D8      00635         bcf             STATUS,C
1284 0100      00636         banksel SEN_TEMPERATURE_C
1286 5DC2      00637         subwf   SEN_TEMPERATURE_C,W
1288 6FC2      00638         movwf   SEN_TEMPERATURE_C
128A 010F      00639         banksel STATUS
128C A0D8      00640         btfss   STATUS,C
128E EF61 F009 00641         goto    SEN_TEMPERATURE_TAG_01
1292 0100      00642         banksel SEN_TEMPERATURE_C
               00643         
               00644         
               00645         ;Rutina para dividir entre 2.2
               00646         
               00647         ;copy accumulator to temporary
1294 51C2      00648         movf    SEN_TEMPERATURE_C, w
1296 6FE1      00649         movwf   TEMP0
               00650 
               00651         ;shift accumulator right 2 times
1298 90D8      00652         bcf             STATUS,C
129A 33C2      00653         rrcf    SEN_TEMPERATURE_C, f
129C 90D8      00654         bcf             STATUS,C
129E 33C2      00655         rrcf    SEN_TEMPERATURE_C, f
               00656 
               00657         ;substract temporary from accumulator
12A0 5FC2      00658         subwf   SEN_TEMPERATURE_C, f
               00659 
               00660         ;shift accumulator right 3 times
12A2 33C2      00661         rrcf    SEN_TEMPERATURE_C, f
12A4 0E80      00662         movlw   0x80
12A6 1BC2      00663         xorwf   SEN_TEMPERATURE_C, f
12A8 35C2      00664         rlcf    SEN_TEMPERATURE_C, w
12AA 33C2      00665         rrcf    SEN_TEMPERATURE_C, f
12AC 35C2      00666         rlcf    SEN_TEMPERATURE_C, w
12AE 33C2      00667         rrcf    SEN_TEMPERATURE_C, f
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 14


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00668 
               00669         ;add temporary to accumulator
12B0 51E1      00670         movf    TEMP0, w
12B2 27C2      00671         addwf   SEN_TEMPERATURE_C, f
               00672 
               00673         ;shift accumulator right 1 times
12B4 90D8      00674         bcf             STATUS,C
12B6 33C2      00675         rrcf    SEN_TEMPERATURE_C, f
               00676 
               00677         
12B8 010F      00678         banksel ADCON0
12BA 90C2      00679         bcf             ADCON0,ADON
12BC ECF6 F00C 00680         call    SEN_INTER_RETURN
12C0 0012      00681         return
               00682 
12C2 00683 SEN_TEMPERATURE_TAG_01
12C2 0100      00684         banksel SEN_TEMPERATURE_C
12C4 0E00      00685         movlw   .0
12C6 6FC2      00686         movwf   SEN_TEMPERATURE_C
12C8 010F      00687         banksel ADCON0
12CA 90C2      00688         bcf             ADCON0,ADON
12CC ECF6 F00C 00689         call    SEN_INTER_RETURN
12D0 0012      00690         return
               00691 ;*****************************************************
               00692 
               00693 
               00694 ;*****************************************************
               00695 ;*                  SEN_MIC_ANALOG                   *
               00696 ;*****************************************************
               00697 ;*Descripción:El valor analogico del micrófono       *
               00698 ;*****************************************************
               00699 ;*Variables de entrada:                              *
               00700 ;*Variables de salida: -SEN_MIC                      *
               00701 ;*****************************************************
               00702 
12D2 00703 SEN_MIC_ANALOG
12D2 ECEE F00C 00704         call    SEN_INTER_CALL
               00705 
               00706         ;Se selecciona el canal0 del ADC y se espera el
               00707         ;tiempo de adquisición del convertidor analógico
               00708         ;digital
               00709         ;Configuramos las entradas como analógicas
12D6 010F      00710         banksel WDTCON
12D8 88C0      00711         bsf             WDTCON,ADSHR
12DA 010F      00712         banksel ANCON1
12DC 0E7F      00713         movlw   b'01111111'
12DE 6EC2      00714         movwf   ANCON1
12E0 010F      00715         banksel WDTCON
12E2 98C0      00716         bcf             WDTCON,ADSHR
               00717 
12E4 0E3D      00718         movlw   b'00111101'             
12E6 010F      00719         banksel ADCON0
12E8 6EC2      00720         movwf   ADCON0
12EA EC27 F00D 00721         call    Delay_100us
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 15


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00722 
               00723         ;Lectura y calculo de temperatura
12EE 82C2      00724         bsf             ADCON0,GO
12F0 00725 SEN_MIC_ANALOG_TAG_00
12F0 B2C2      00726         btfsc   ADCON0,GO       
12F2 EF78 F009 00727         goto    SEN_MIC_ANALOG_TAG_00
12F6 010F      00728         banksel ADRESH
12F8 50C4      00729         movf    ADRESH,W        
12FA 0100      00730         banksel SEN_MIC         
12FC 6FC3      00731         movwf   SEN_MIC         
               00732 
12FE 010F      00733         banksel ADCON0
1300 90C2      00734         bcf             ADCON0,ADON
               00735         
               00736         
               00737         
               00738         ;Divide by 2.55
1302 0100      00739         banksel SEN_MIC
1304 51C3      00740         movf    SEN_MIC, W
1306 90D8      00741         bcf             STATUS,C
1308 33C3      00742         rrcf    SEN_MIC, F
130A 90D8      00743         bcf             STATUS,C
130C 33C3      00744         rrcf    SEN_MIC, F
130E 27C3      00745         addwf   SEN_MIC, F
1310 33C3      00746         rrcf    SEN_MIC, F
1312 90D8      00747         bcf             STATUS,C
1314 33C3      00748         rrcf    SEN_MIC, F
1316 90D8      00749         bcf             STATUS,C
1318 33C3      00750         rrcf    SEN_MIC, F
131A 27C3      00751         addwf   SEN_MIC, F
131C 33C3      00752         rrcf    SEN_MIC, F
131E 27C3      00753         addwf   SEN_MIC, F
1320 33C3      00754         rrcf    SEN_MIC, F
1322 90D8      00755         bcf             STATUS,C
1324 33C3      00756         rrcf    SEN_MIC, F
               00757 
1326 ECF6 F00C 00758         call    SEN_INTER_RETURN
132A 0012      00759         return
               00760 ;*****************************************************
               00761 
               00762 
               00763 ;*****************************************************
               00764 ;*                  SEN_MIC_DIG                      *
               00765 ;*****************************************************
               00766 ;*Descripción:El valor digital del micrófono              *
               00767 ;*****************************************************
               00768 ;*Variables de entrada:                              *
               00769 ;*Variables de salida: -SEN_MIC                      *
               00770 ;*****************************************************
               00771 
132C 00772 SEN_MIC_DIG
132C ECEE F00C 00773         call    SEN_INTER_CALL
               00774 
               00775         ;Se selecciona el canal0 del ADC y se espera el
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 16


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00776         ;tiempo de adquisición del convertidor analógico
               00777         ;digital
               00778         ;Configuramos las entradas como analógicas
1330 010F      00779         banksel WDTCON
1332 88C0      00780         bsf             WDTCON,ADSHR
1334 010F      00781         banksel ANCON1
1336 0EFF      00782         movlw   b'11111111'
1338 6EC2      00783         movwf   ANCON1
133A 010F      00784         banksel WDTCON
133C 98C0      00785         bcf             WDTCON,ADSHR
               00786 
133E 0100      00787         banksel SEN_MIC
1340 6BC3      00788         clrf    SEN_MIC
               00789 
1342 010F      00790         banksel PORTH
1344 AE87      00791         btfss   MIC_IN
1346 EFA7 F009 00792         goto    SEN_MIC_DIG_TAG_00
134A 0100      00793         banksel SEN_MIC
Message [305] : Using default destination of 1 (file).
134C 2BC3      00794         incf    SEN_MIC
134E 00795 SEN_MIC_DIG_TAG_00
               00796 
134E ECF6 F00C 00797         call    SEN_INTER_RETURN
1352 0012      00798         return
               00799 ;*****************************************************
               00800 
               00801 
               00802 ;*****************************************************
               00803 ;*                  SEN_SPEAKER                      *
               00804 ;*****************************************************
               00805 ;* Descripción:Activa el zumbador a la frequencia    *
               00806 ;* indicada y el tiempo                                                  *
               00807 ;*****************************************************
               00808 ;*Variables de entrada:                              *
               00809 ;*Variables de salida:-SEN_SPEAKER_FREQ  (Tabla)     *          
               00810 ;*                                        -SEN_SPEAKER_TIME  (100ms)     *
               00811 ;*                                        -SEN_SPEAKER_ON_OFF ON/OFF/TIME*
               00812 ;*****************************************************
1354 00813 SEN_SPEAKER
1354 ECEE F00C 00814         call    SEN_INTER_CALL
               00815 
               00816         
1358 0100      00817         banksel SEN_SPEAKER_ON_OFF
135A 51C6      00818         movf    SEN_SPEAKER_ON_OFF,W
135C B4D8      00819         btfsc   STATUS,Z
135E EFDF F009 00820         goto    SEN_SEN_SPEAKER_TAG_01
               00821         
               00822         ;PR2 controla la frecuencia
1362 0100      00823         banksel SEN_SPEAKER_FREQ        
1364 51C4      00824         movf    SEN_SPEAKER_FREQ,W
1366 010F      00825         banksel PR2
1368 6ECB      00826         movwf   PR2     
               00827 
               00828         ;CCPR2L controla el duty
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 17


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
136A 0100      00829         banksel SEN_SPEAKER_FREQ        
136C 91C4      00830         bcf             SEN_SPEAKER_FREQ,0
136E 41C4      00831         rrncf   SEN_SPEAKER_FREQ,W
1370 010F      00832         banksel CCPR2L
1372 6EB7      00833         movwf   CCPR2L
               00834 
1374 010F      00835         banksel TRISB
1376 9681      00836         bcf             SPEAKER
               00837 
1378 010F      00838         banksel T2CON
137A 84CA      00839         bsf             T2CON,TMR2ON
137C 80CA      00840         bsf             T2CON,T2CKPS0
137E 82CA      00841         bsf             T2CON,T2CKPS1
               00842         
1380 0100      00843         banksel SEN_SPEAKER_ON_OFF
1382 51C6      00844         movf    SEN_SPEAKER_ON_OFF,W
1384 0801      00845         sublw   SPEAKER_ON
1386 A4D8      00846         btfss   STATUS,Z
1388 EFCB F009 00847         goto    SEN_SEN_SPEAKER_TAG_00
               00848         
138C 010F      00849         banksel CCP2CON
138E 0E3F      00850         movlw   b'00111111'
1390 6EB6      00851         movwf   CCP2CON 
1392 EFE2 F009 00852         goto    SEN_SEN_SPEAKER_TAG_02
               00853         
               00854         
1396 00855 SEN_SEN_SPEAKER_TAG_00  
               00856 
1396 0100      00857         banksel SEN_SPEAKER_ON_OFF
1398 51C6      00858         movf    SEN_SPEAKER_ON_OFF,W
139A 0802      00859         sublw   SPEAKER_TIME
139C A4D8      00860         btfss   STATUS,Z
139E EFE2 F009 00861         goto    SEN_SEN_SPEAKER_TAG_02
               00862 
13A2 0100      00863         banksel SEN_SPEAKER_TIME
13A4 51C5      00864         movf    SEN_SPEAKER_TIME,W
13A6 B4D8      00865         btfsc   STATUS,Z
13A8 EFE2 F009 00866         goto    SEN_SEN_SPEAKER_TAG_02
               00867         
13AC 010F      00868         banksel CCP2CON
13AE 0E3F      00869         movlw   b'00111111'
13B0 6EB6      00870         movwf   CCP2CON 
               00871 
13B2 EC6E F00D 00872         call    Delay_100ms
13B6 0100      00873         banksel SEN_SPEAKER_TIME
13B8 2FC5      00874         decfsz  SEN_SPEAKER_TIME,F
13BA EFCB F009 00875         goto    SEN_SEN_SPEAKER_TAG_00
               00876 
13BE 00877 SEN_SEN_SPEAKER_TAG_01
13BE 010F      00878         banksel CCP2CON
13C0 0E00      00879         movlw   b'00000000'
13C2 6EB6      00880         movwf   CCP2CON 
               00881 
13C4 00882 SEN_SEN_SPEAKER_TAG_02
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 18


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
13C4 ECF6 F00C 00883         call    SEN_INTER_RETURN
13C8 0012      00884         return
               00885 ;*****************************************************
               00886 
               00887 
               00888 ;*****************************************************
               00889 ;*                 SEN_OBS_DIG                       *
               00890 ;*****************************************************
               00891 ;*Descripción: Devuelve si se ha detectado un        *
               00892 ;*obstáculo en la izquierda o derecha del robot      *
               00893 ;*****************************************************
               00894 ;*Variables de entrada:                              *
               00895 ;*Variables de salida: -SEN_OBS_CENTER_R             *
               00896 ;*                     -SEN_OBS_CENTER_L             *
               00897 ;*                                         -SEN_OBS_SIDE_R               *
               00898 ;*                     -SEN_OBS_SIDE_L               *
               00899 ;*Salida:                          -SEN_STATUS                                   *
               00900 ;*                                               -SENOK:                                         *
               00901 ;*                                    -0:Detectado señal externa *
               00902 ;*                        (Moway o interferecia)     *
               00903 ;*                        -1:Lectura correcta        *
               00904 ;*****************************************************
13CA 00905 SEN_OBS_DIG     
13CA ECEE F00C 00906         call    SEN_INTER_CALL
               00907 
               00908         ;Limpiar variables
13CE 0100      00909         banksel SEN_OBS_CENTER_L
13D0 6BC9      00910         clrf    SEN_OBS_CENTER_L
13D2 0100      00911         banksel SEN_OBS_SIDE_L
13D4 6BCB      00912         clrf    SEN_OBS_SIDE_L
13D6 0100      00913         banksel SEN_OBS_CENTER_R
13D8 6BCA      00914         clrf    SEN_OBS_CENTER_R
13DA 0100      00915         banksel SEN_OBS_SIDE_R
13DC 6BCC      00916         clrf    SEN_OBS_SIDE_R
               00917 
               00918         ;Comprobación de la no existencia de señal externa
               00919     ;indeseada
13DE 010F      00920         banksel PORTA
13E0 B280      00921         btfsc   IR_RX_L_1
13E2 EF30 F00A 00922         goto    COLISION_DIG
               00923         
13E6 B680      00924         btfsc   IR_RX_L_2
13E8 EF30 F00A 00925         goto    COLISION_DIG    
               00926 
13EC 010F      00927         banksel PORTF
13EE BC85      00928         btfsc   IR_RX_R_1
13F0 EF30 F00A 00929         goto    COLISION_DIG
               00930         
13F4 BA85      00931         btfsc   IR_RX_R_2
13F6 EF30 F00A 00932         goto    COLISION_DIG
               00933 
               00934         ;Se manda pulso de luz infrarroja para
               00935         ;la deteción de obstáculo
13FA 010F      00936         banksel PORTJ
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 19


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
13FC 8C88      00937         bsf             IR_TX
13FE EC30 F00D 00938         call    Delay_120us
               00939 
               00940         ;Comprobación si el pulso a rebotado en
               00941         ;algún objeto
1402 010F      00942         banksel PORTA
1404 A280      00943         btfss   IR_RX_L_1
1406 EF07 F00A 00944         goto    SEN_OBS_DIG_CONT_01
140A 0100      00945         banksel SEN_OBS_CENTER_L
Message [305] : Using default destination of 1 (file).
140C 2BC9      00946         incf    SEN_OBS_CENTER_L
140E 00947 SEN_OBS_DIG_CONT_01
140E 010F      00948         banksel PORTA
1410 A680      00949         btfss   IR_RX_L_2
1412 EF0D F00A 00950         goto    SEN_OBS_DIG_CONT_02
1416 0100      00951         banksel SEN_OBS_SIDE_L
Message [305] : Using default destination of 1 (file).
1418 2BCB      00952         incf    SEN_OBS_SIDE_L
141A 00953 SEN_OBS_DIG_CONT_02
141A 010F      00954         banksel PORTF
141C AC85      00955         btfss   IR_RX_R_1
141E EF13 F00A 00956         goto    SEN_OBS_DIG_CONT_03
1422 0100      00957         banksel SEN_OBS_CENTER_R
Message [305] : Using default destination of 1 (file).
1424 2BCA      00958         incf    SEN_OBS_CENTER_R
1426 00959 SEN_OBS_DIG_CONT_03
1426 010F      00960         banksel PORTF
1428 AA85      00961         btfss   IR_RX_R_2
142A EF19 F00A 00962         goto    SEN_OBS_DIG_CONT_04
142E 0100      00963         banksel SEN_OBS_SIDE_R
Message [305] : Using default destination of 1 (file).
1430 2BCC      00964         incf    SEN_OBS_SIDE_R
1432 00965 SEN_OBS_DIG_CONT_04
               00966         ;Finalización del pulso de luz infrarroja
1432 010F      00967         banksel PORTJ
1434 9C88      00968         bcf             IR_TX
1436 EC49 F00D 00969         call    Delay_500us
               00970 
               00971         ;Comprobación de la no existencia de señal externa
               00972     ;indeseada
143A 010F      00973         banksel PORTA
143C B280      00974         btfsc   IR_RX_L_1
143E EF30 F00A 00975         goto    COLISION_DIG
               00976         
1442 B680      00977         btfsc   IR_RX_L_2
1444 EF30 F00A 00978         goto    COLISION_DIG    
               00979 
1448 010F      00980         banksel PORTF
144A BC85      00981         btfsc   IR_RX_R_1
144C EF30 F00A 00982         goto    COLISION_DIG
               00983         
1450 BA85      00984         btfsc   IR_RX_R_2
1452 EF30 F00A 00985         goto    COLISION_DIG
               00986                 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 20


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1456 0100      00987         banksel SEN_STATUS
1458 83DB      00988         bsf             SEN_STATUS,SENOK
               00989 
145A ECF6 F00C 00990         call    SEN_INTER_RETURN
               00991         
145E 0012      00992         return
               00993 
1460 00994 COLISION_DIG
1460 EC49 F00D 00995         call    Delay_500us
1464 0100      00996         banksel SEN_STATUS
1466 93DB      00997         bcf             SEN_STATUS,SENOK
1468 6BC9      00998         clrf    SEN_OBS_CENTER_L
146A 6BCB      00999         clrf    SEN_OBS_SIDE_L
146C 6BCA      01000         clrf    SEN_OBS_CENTER_R
146E 6BCC      01001         clrf    SEN_OBS_SIDE_R
1470 ECF6 F00C 01002         call    SEN_INTER_RETURN
1474 0012      01003         return
               01004 ;*****************************************************
               01005 
               01006 
               01007 ;*****************************************************
               01008 ;*                 SEN_OBS_ANALOG                    *
               01009 ;*****************************************************
               01010 ;*Descripción: Devuelve si se ha detectado un        *
               01011 ;*obstáculo en la izquierda o derecha del robot en   *
               01012 ;*valor proporcional a la distancia.                 *
               01013 ;*****************************************************
               01014 ;*Variables de entrada:                              *
               01015 ;*                                              SEN_CHECK_OBS,OBS_CENTER_R       *
               01016 ;*                                              SEN_CHECK_OBS,OBS_SIDE_R         *
               01017 ;*                                              SEN_CHECK_OBS,OBS_CENTER_L       *
               01018 ;*                                              SEN_CHECK_OBS,OBS_SIDE_L         *
               01019 ;*Variables de salida: -SEN_OBS_CENTER_R             *
               01020 ;*                     -SEN_OBS_CENTER_L             *
               01021 ;*                                         -SEN_OBS_SIDE_R               *
               01022 ;*                     -SEN_OBS_SIDE_L               *
               01023 ;*Salida:                          -SEN_STATUS                                   *
               01024 ;*                                               -SENOK:                                         *
               01025 ;*                                    -0:Detectado señal externa *
               01026 ;*                        (Moway o interferecia)     *
               01027 ;*                        -1:Lectura correcta        *
               01028 ;*****************************************************
               01029 
1476 01030 SEN_OBS_ANALOG
1476 ECEE F00C 01031         call    SEN_INTER_CALL
               01032 
               01033         ;Limpiar variables
147A 0100      01034         banksel SEN_OBS_CENTER_L
147C 6BC9      01035         clrf    SEN_OBS_CENTER_L
147E 0100      01036         banksel SEN_OBS_SIDE_L
1480 6BCB      01037         clrf    SEN_OBS_SIDE_L
1482 0100      01038         banksel SEN_OBS_CENTER_R
1484 6BCA      01039         clrf    SEN_OBS_CENTER_R
1486 0100      01040         banksel SEN_OBS_SIDE_R
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 21


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1488 6BCC      01041         clrf    SEN_OBS_SIDE_R
               01042         
148A 0100      01043         banksel SEN_CHECK_OBS
148C A1CD      01044         btfss   SEN_CHECK_OBS,OBS_CENTER_L
148E EF67 F00A 01045         goto    SEN_OBS_ANALOG_TAG_NEXT_00
               01046 
               01047         ;Comprobación de la no existencia de señal externa
               01048     ;indeseada
1492 010F      01049         banksel PORTA
1494 B280      01050         btfsc   IR_RX_L_1
1496 EF22 F00B 01051         goto    COLISION_ANALOG
               01052 
               01053         ;Se manda pulso de luz infrarroja para
               01054         ;la deteción de obstáculo
149A 010F      01055         banksel PORTJ
149C 8C88      01056         bsf             IR_TX
149E EC30 F00D 01057         call    Delay_120us
               01058 
14A2 010F      01059         banksel WDTCON
14A4 88C0      01060         bsf             WDTCON,ADSHR
14A6 010F      01061         banksel ANCON0
14A8 0EFD      01062         movlw   b'11111101'
14AA 6EC1      01063         movwf   ANCON0
14AC 010F      01064         banksel WDTCON
14AE 98C0      01065         bcf             WDTCON,ADSHR
               01066 
14B0 0E05      01067         movlw   b'00000101'             
14B2 010F      01068         banksel ADCON0
14B4 6EC2      01069         movwf   ADCON0
               01070 
               01071         ;Lectura y calculo de temperatura
14B6 82C2      01072         bsf             ADCON0,GO
14B8 01073 SEN_OBS_ANALOG_TAG_00
14B8 B2C2      01074         btfsc   ADCON0,GO       
14BA EF5C F00A 01075         goto    SEN_OBS_ANALOG_TAG_00
14BE 010F      01076         banksel ADRESH
14C0 50C4      01077         movf    ADRESH,W
14C2 0100      01078         banksel SEN_OBS_CENTER_L        
14C4 6FC9      01079         movwf   SEN_OBS_CENTER_L
14C6 010F      01080         banksel PORTJ
14C8 9C88      01081         bcf             IR_TX
14CA EC49 F00D 01082         call    Delay_500us
               01083 
14CE 01084 SEN_OBS_ANALOG_TAG_NEXT_00
14CE 0100      01085         banksel SEN_CHECK_OBS
14D0 A3CD      01086         btfss   SEN_CHECK_OBS,OBS_SIDE_L
14D2 EF89 F00A 01087         goto    SEN_OBS_ANALOG_TAG_NEXT_01
               01088 
               01089         ;Comprobación de la no existencia de señal externa
               01090     ;indeseada
14D6 010F      01091         banksel PORTA
14D8 B680      01092         btfsc   IR_RX_L_2
14DA EF22 F00B 01093         goto    COLISION_ANALOG
               01094         
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 22


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01095         ;Se manda pulso de luz infrarroja para
               01096         ;la deteción de obstáculo
14DE 010F      01097         banksel PORTJ
14E0 8C88      01098         bsf             IR_TX
14E2 EC30 F00D 01099         call    Delay_120us
               01100 
14E6 010F      01101         banksel WDTCON
14E8 88C0      01102         bsf             WDTCON,ADSHR
14EA 010F      01103         banksel ANCON0
14EC 0EF7      01104         movlw   b'11110111'
14EE 6EC1      01105         movwf   ANCON0
14F0 010F      01106         banksel WDTCON
14F2 98C0      01107         bcf             WDTCON,ADSHR
               01108 
14F4 0E0D      01109         movlw   b'00001101'             
14F6 010F      01110         banksel ADCON0
14F8 6EC2      01111         movwf   ADCON0
               01112 
               01113         ;Lectura y calculo de temperatura
14FA 82C2      01114         bsf             ADCON0,GO
14FC 01115 SEN_OBS_ANALOG_TAG_01
14FC B2C2      01116         btfsc   ADCON0,GO       
14FE EF7E F00A 01117         goto    SEN_OBS_ANALOG_TAG_01
1502 010F      01118         banksel ADRESH
1504 50C4      01119         movf    ADRESH,W
1506 0100      01120         banksel SEN_OBS_SIDE_L  
1508 6FCB      01121         movwf   SEN_OBS_SIDE_L
               01122 
150A 010F      01123         banksel PORTJ
150C 9C88      01124         bcf             IR_TX
150E EC49 F00D 01125         call    Delay_500us
               01126 
1512 01127 SEN_OBS_ANALOG_TAG_NEXT_01
1512 0100      01128         banksel SEN_CHECK_OBS
1514 A5CD      01129         btfss   SEN_CHECK_OBS,OBS_CENTER_R
1516 EFAB F00A 01130         goto    SEN_OBS_ANALOG_TAG_NEXT_02
               01131 
               01132         ;Comprobación de la no existencia de señal externa
               01133     ;indeseada
151A 010F      01134         banksel PORTF
151C BC85      01135         btfsc   IR_RX_R_1
151E EF22 F00B 01136         goto    COLISION_ANALOG
               01137         
               01138         ;Se manda pulso de luz infrarroja para
               01139         ;la deteción de obstáculo
1522 010F      01140         banksel PORTJ
1524 8C88      01141         bsf             IR_TX
1526 EC30 F00D 01142         call    Delay_120us
               01143 
               01144 
               01145         
152A 010F      01146         banksel WDTCON
152C 88C0      01147         bsf             WDTCON,ADSHR
152E 010F      01148         banksel ANCON1
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 23


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1530 0EF7      01149         movlw   b'11110111'
1532 6EC2      01150         movwf   ANCON1
1534 010F      01151         banksel WDTCON
1536 98C0      01152         bcf             WDTCON,ADSHR
               01153 
1538 0E2D      01154         movlw   b'00101101'             
153A 010F      01155         banksel ADCON0
153C 6EC2      01156         movwf   ADCON0
               01157 
               01158         ;Lectura y calculo de temperatura
153E 82C2      01159         bsf             ADCON0,GO
1540 01160 SEN_OBS_ANALOG_TAG_02
1540 B2C2      01161         btfsc   ADCON0,GO       
1542 EFA0 F00A 01162         goto    SEN_OBS_ANALOG_TAG_02
1546 010F      01163         banksel ADRESH
1548 50C4      01164         movf    ADRESH,W
154A 0100      01165         banksel SEN_OBS_CENTER_R        
154C 6FCA      01166         movwf   SEN_OBS_CENTER_R
154E 010F      01167         banksel PORTJ
1550 9C88      01168         bcf             IR_TX
1552 EC49 F00D 01169         call    Delay_500us
               01170 
1556 01171 SEN_OBS_ANALOG_TAG_NEXT_02
1556 0100      01172         banksel SEN_CHECK_OBS
1558 A7CD      01173         btfss   SEN_CHECK_OBS,OBS_SIDE_R
155A EFCD F00A 01174         goto    SEN_OBS_ANALOG_TAG_NEXT_03
               01175 
               01176         ;Comprobación de la no existencia de señal externa
               01177     ;indeseada
155E 010F      01178         banksel PORTF
1560 BA85      01179         btfsc   IR_RX_R_2
1562 EF22 F00B 01180         goto    COLISION_ANALOG
               01181         
               01182         ;Se manda pulso de luz infrarroja para
               01183         ;la deteción de obstáculo
1566 010F      01184         banksel PORTJ
1568 8C88      01185         bsf             IR_TX
156A EC30 F00D 01186         call    Delay_120us
               01187 
               01188 
156E 010F      01189         banksel WDTCON
1570 88C0      01190         bsf             WDTCON,ADSHR
1572 010F      01191         banksel ANCON1
1574 0EFB      01192         movlw   b'11111011'
1576 6EC2      01193         movwf   ANCON1
1578 010F      01194         banksel WDTCON
157A 98C0      01195         bcf             WDTCON,ADSHR
               01196 
157C 0E29      01197         movlw   b'00101001'             
157E 010F      01198         banksel ADCON0
1580 6EC2      01199         movwf   ADCON0
               01200 
               01201         ;Lectura y calculo de temperatura
1582 82C2      01202         bsf             ADCON0,GO
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 24


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1584 01203 SEN_OBS_ANALOG_TAG_03
1584 B2C2      01204         btfsc   ADCON0,GO       
1586 EFC2 F00A 01205         goto    SEN_OBS_ANALOG_TAG_03
158A 010F      01206         banksel ADRESH
158C 50C4      01207         movf    ADRESH,W
158E 0100      01208         banksel SEN_OBS_SIDE_R
1590 6FCC      01209         movwf   SEN_OBS_SIDE_R
               01210 
1592 010F      01211         banksel PORTJ
1594 9C88      01212         bcf             IR_TX
1596 EC49 F00D 01213         call    Delay_500us
               01214 
               01215 
159A 01216 SEN_OBS_ANALOG_TAG_NEXT_03
159A EC49 F00D 01217         call    Delay_500us
159E 010F      01218         banksel WDTCON
15A0 88C0      01219         bsf             WDTCON,ADSHR
15A2 010F      01220         banksel ANCON0
15A4 0EFF      01221         movlw   b'11111111'
15A6 6EC1      01222         movwf   ANCON0
15A8 010F      01223         banksel WDTCON
15AA 98C0      01224         bcf             WDTCON,ADSHR
               01225 
15AC 83DB      01226         bsf             SEN_STATUS,SENOK
               01227         
               01228         ;Divide by 2.55
15AE 0100      01229         banksel SEN_OBS_CENTER_L
15B0 51C9      01230         movf    SEN_OBS_CENTER_L, W
15B2 90D8      01231         bcf             STATUS,C
15B4 33C9      01232         rrcf    SEN_OBS_CENTER_L, F
15B6 90D8      01233         bcf             STATUS,C
15B8 33C9      01234         rrcf    SEN_OBS_CENTER_L, F
15BA 27C9      01235         addwf   SEN_OBS_CENTER_L, F
15BC 33C9      01236         rrcf    SEN_OBS_CENTER_L, F
15BE 90D8      01237         bcf             STATUS,C
15C0 33C9      01238         rrcf    SEN_OBS_CENTER_L, F
15C2 90D8      01239         bcf             STATUS,C
15C4 33C9      01240         rrcf    SEN_OBS_CENTER_L, F
15C6 27C9      01241         addwf   SEN_OBS_CENTER_L, F
15C8 33C9      01242         rrcf    SEN_OBS_CENTER_L, F
15CA 27C9      01243         addwf   SEN_OBS_CENTER_L, F
15CC 33C9      01244         rrcf    SEN_OBS_CENTER_L, F
15CE 90D8      01245         bcf             STATUS,C
15D0 33C9      01246         rrcf    SEN_OBS_CENTER_L, F
               01247         
               01248         ;Divide by 2.55
15D2 0100      01249         banksel SEN_OBS_CENTER_R
15D4 51CA      01250         movf    SEN_OBS_CENTER_R, W
15D6 90D8      01251         bcf             STATUS,C
15D8 33CA      01252         rrcf    SEN_OBS_CENTER_R, F
15DA 90D8      01253         bcf             STATUS,C
15DC 33CA      01254         rrcf    SEN_OBS_CENTER_R, F
15DE 27CA      01255         addwf   SEN_OBS_CENTER_R, F
15E0 33CA      01256         rrcf    SEN_OBS_CENTER_R, F
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 25


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
15E2 90D8      01257         bcf             STATUS,C
15E4 33CA      01258         rrcf    SEN_OBS_CENTER_R, F
15E6 90D8      01259         bcf             STATUS,C
15E8 33CA      01260         rrcf    SEN_OBS_CENTER_R, F
15EA 27CA      01261         addwf   SEN_OBS_CENTER_R, F
15EC 33CA      01262         rrcf    SEN_OBS_CENTER_R, F
15EE 27CA      01263         addwf   SEN_OBS_CENTER_R, F
15F0 33CA      01264         rrcf    SEN_OBS_CENTER_R, F
15F2 90D8      01265         bcf             STATUS,C
15F4 33CA      01266         rrcf    SEN_OBS_CENTER_R, F
               01267         
               01268                 ;Divide by 2.55
15F6 0100      01269         banksel SEN_OBS_SIDE_L
15F8 51CB      01270         movf    SEN_OBS_SIDE_L, W
15FA 90D8      01271         bcf             STATUS,C
15FC 33CB      01272         rrcf    SEN_OBS_SIDE_L, F
15FE 90D8      01273         bcf             STATUS,C
1600 33CB      01274         rrcf    SEN_OBS_SIDE_L, F
1602 27CB      01275         addwf   SEN_OBS_SIDE_L, F
1604 33CB      01276         rrcf    SEN_OBS_SIDE_L, F
1606 90D8      01277         bcf             STATUS,C
1608 33CB      01278         rrcf    SEN_OBS_SIDE_L, F
160A 90D8      01279         bcf             STATUS,C
160C 33CB      01280         rrcf    SEN_OBS_SIDE_L, F
160E 27CB      01281         addwf   SEN_OBS_SIDE_L, F
1610 33CB      01282         rrcf    SEN_OBS_SIDE_L, F
1612 27CB      01283         addwf   SEN_OBS_SIDE_L, F
1614 33CB      01284         rrcf    SEN_OBS_SIDE_L, F
1616 90D8      01285         bcf             STATUS,C
1618 33CB      01286         rrcf    SEN_OBS_SIDE_L, F
               01287         
               01288         ;Divide by 2.55
161A 0100      01289         banksel SEN_OBS_SIDE_R
161C 51CC      01290         movf    SEN_OBS_SIDE_R, W
161E 90D8      01291         bcf             STATUS,C
1620 33CC      01292         rrcf    SEN_OBS_SIDE_R, F
1622 90D8      01293         bcf             STATUS,C
1624 33CC      01294         rrcf    SEN_OBS_SIDE_R, F
1626 27CC      01295         addwf   SEN_OBS_SIDE_R, F
1628 33CC      01296         rrcf    SEN_OBS_SIDE_R, F
162A 90D8      01297         bcf             STATUS,C
162C 33CC      01298         rrcf    SEN_OBS_SIDE_R, F
162E 90D8      01299         bcf             STATUS,C
1630 33CC      01300         rrcf    SEN_OBS_SIDE_R, F
1632 27CC      01301         addwf   SEN_OBS_SIDE_R, F
1634 33CC      01302         rrcf    SEN_OBS_SIDE_R, F
1636 27CC      01303         addwf   SEN_OBS_SIDE_R, F
1638 33CC      01304         rrcf    SEN_OBS_SIDE_R, F
163A 90D8      01305         bcf             STATUS,C
163C 33CC      01306         rrcf    SEN_OBS_SIDE_R, F
               01307         
               01308 
163E ECF6 F00C 01309         call    SEN_INTER_RETURN
               01310         
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 26


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1642 0012      01311         return
               01312 
1644 01313 COLISION_ANALOG
1644 EC49 F00D 01314         call    Delay_500us
1648 93DB      01315         bcf             SEN_STATUS,SENOK
164A 6BC9      01316         clrf    SEN_OBS_CENTER_L
164C 6BCB      01317         clrf    SEN_OBS_SIDE_L
164E 6BCA      01318         clrf    SEN_OBS_CENTER_R
1650 6BCC      01319         clrf    SEN_OBS_SIDE_R
1652 ECF6 F00C 01320         call    SEN_INTER_RETURN
1656 0012      01321         return
               01322 ;*****************************************************
               01323 
               01324 
               01325 
               01326 ;*****************************************************
               01327 ;*                 SEN_ACCE_XYZ_READ                 *
               01328 ;*****************************************************
               01329 ;*Descripción: Devuelve los valores x,y,z del            *
               01330 ;*acelerometro.                                                                          *
               01331 ;*****************************************************
               01332 ;*Variables de entrada:                              *
               01333 ;*Variables de salida: -SEN_ACCE_X                   *
               01334 ;*                     -SEN_ACCE_Y                   *
               01335 ;*                     -SEN_ACCE_Z                   *
               01336 ;*Salida:                          -SEN_STATUS                                   *
               01337 ;*                                               -SENOK:                                         *
               01338 ;*                                    -0:Lectura incorrecta              *
               01339 ;*                        -1:Lectura correcta        *
               01340 ;*****************************************************
1658 01341 SEN_ACCE_XYZ_READ
1658 ECEE F00C 01342         call    SEN_INTER_CALL
165C 0100      01343         banksel SEN_ACCE_X
165E 6BD2      01344         clrf    SEN_ACCE_X
1660 0100      01345         banksel SEN_ACCE_Y
1662 6BD3      01346         clrf    SEN_ACCE_Y
1664 0100      01347         banksel SEN_ACCE_Z
1666 6BD4      01348         clrf    SEN_ACCE_Z
               01349 
               01350         ; Se pone el acelerometro en modo "medida"
1668 0100      01351         banksel ACCE_ADRESS
166A 0E16      01352         movlw   MCTL
166C 6FD7      01353         movwf   ACCE_ADRESS
166E 0E05      01354         movlw   b'00000101'
1670 6FD8      01355         movwf   ACCE_DATA_OUT
1672 ECAF F00C 01356         call    ACCE_WRITE
               01357 
1676 0100      01358         banksel ACCE_NO_LOW
1678 6BD6      01359         clrf    ACCE_NO_LOW
167A 0100      01360         banksel ACCE_NO_HIGH
167C 6BD5      01361         clrf    ACCE_NO_HIGH
               01362         
               01363         ;Comprobación INT
167E 01364 ACCE_CHECK_loop
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 27


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
167E 0100      01365         banksel ACCE_NO_LOW
1680 2BD6      01366         incf    ACCE_NO_LOW,F
1682 010F      01367         banksel STATUS
1684 B4D8      01368         btfsc   STATUS,Z
1686 EF4B F00B 01369         goto    ACCE_CHECK_cont
168A 01370 ACCE_CHECK_check_irq
168A 010F      01371         banksel PORTB
168C A281      01372         btfss   ACCE_INT1_DRDY
168E EF3F F00B 01373         goto    ACCE_CHECK_loop
1692 EF55 F00B 01374         goto    ACCE_CHECK_ok   
1696 01375 ACCE_CHECK_cont
1696 0100      01376         banksel ACCE_NO_HIGH
1698 2BD5      01377         incf    ACCE_NO_HIGH,F
169A 0EFF      01378         movlw   .255
169C 5DD5      01379         subwf   ACCE_NO_HIGH,W
169E 010F      01380         banksel STATUS
16A0 B0D8      01381         btfsc   STATUS,C
16A2 EF7F F00B 01382         goto    ACCE_CHECK_NO
16A6 EF45 F00B 01383         goto    ACCE_CHECK_check_irq
               01384 
               01385 
16AA 01386 ACCE_CHECK_ok
               01387         ;Lectura X 
16AA 0100      01388         banksel ACCE_ADRESS
16AC 0E06      01389         movlw   XOUT8
16AE 6FD7      01390         movwf   ACCE_ADRESS
16B0 ECC1 F00C 01391         call    ACCE_READ
16B4 0100      01392         banksel ACCE_DATA_IN
16B6 51D9      01393         movf    ACCE_DATA_IN,W
16B8 0A80      01394         xorlw   b'10000000'
16BA 0100      01395         banksel SEN_ACCE_X
16BC 6FD2      01396         movwf   SEN_ACCE_X
               01397 
               01398 
               01399         ;Lectura Y
16BE 0100      01400         banksel ACCE_ADRESS
16C0 0E07      01401         movlw   YOUT8
16C2 6FD7      01402         movwf   ACCE_ADRESS
16C4 ECC1 F00C 01403         call    ACCE_READ
16C8 0100      01404         banksel ACCE_DATA_IN
16CA 51D9      01405         movf    ACCE_DATA_IN,W
16CC 0A80      01406         xorlw   b'10000000'
16CE 0100      01407         banksel SEN_ACCE_Y
16D0 6FD3      01408         movwf   SEN_ACCE_Y
               01409 
               01410         ;Lectura Z
16D2 0100      01411         banksel ACCE_ADRESS
16D4 0E08      01412         movlw   ZOUT8
16D6 6FD7      01413         movwf   ACCE_ADRESS
16D8 ECC1 F00C 01414         call    ACCE_READ
16DC 0100      01415         banksel ACCE_DATA_IN
16DE 51D9      01416         movf    ACCE_DATA_IN,W
16E0 0A80      01417         xorlw   b'10000000'
16E2 0100      01418         banksel SEN_ACCE_Z
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 28


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
16E4 6FD4      01419         movwf   SEN_ACCE_Z
               01420 
               01421         ;El acelerometro vuelve a "detección de pulso"
16E6 0100      01422         banksel ACCE_ADRESS
16E8 0E16      01423         movlw   MCTL
16EA 6FD7      01424         movwf   ACCE_ADRESS
16EC 0E43      01425         movlw   b'01000011'
16EE 6FD8      01426         movwf   ACCE_DATA_OUT
16F0 ECAF F00C 01427         call    ACCE_WRITE
               01428 
16F4 0100      01429         banksel SEN_STATUS
16F6 83DB      01430         bsf             SEN_STATUS,SENOK
               01431 
16F8 ECF6 F00C 01432         call    SEN_INTER_RETURN
16FC 0012      01433         return
               01434 
16FE 01435 ACCE_CHECK_NO
               01436         ;El acelerometro vuelve a "detección de pulso"
16FE 0100      01437         banksel ACCE_ADRESS
1700 0E16      01438         movlw   MCTL
1702 6FD7      01439         movwf   ACCE_ADRESS
1704 0E43      01440         movlw   b'01000011'
1706 6FD8      01441         movwf   ACCE_DATA_OUT
1708 ECAF F00C 01442         call    ACCE_WRITE
               01443 
170C 0100      01444         banksel SEN_STATUS
170E 93DB      01445         bcf             SEN_STATUS,SENOK
1710 ECF6 F00C 01446         call    SEN_INTER_RETURN
1714 0012      01447         return
               01448 
               01449 
               01450 ;*****************************************************
               01451 ;*                 SEN_ACCE_CHECK_TAP                    *
               01452 ;*****************************************************
               01453 ;*Descripción: Comprueba si se a golpeado al robot   *
               01454 ;*****************************************************
               01455 ;*Variables de entrada:                              *
               01456 ;*Variables de salida: -SEN_ACCE_TAP,TAP                 *
               01457 ;*                                         -SEN_ACCE_TAP,TAP_TAP         *
               01458 ;*Salida:                          -SEN_STATUS                                   *
               01459 ;*                                               -SENOK:                                         *
               01460 ;*                                    -0:Lectura incorrecta              *
               01461 ;*                        -1:Lectura correcta        *
               01462 ;*****************************************************
1716 01463 SEN_ACCE_CHECK_TAP
1716 ECEE F00C 01464         call    SEN_INTER_CALL
171A 0100      01465         banksel SEN_ACCE_TAP
171C 6BDA      01466         clrf    SEN_ACCE_TAP
               01467 
171E 0100      01468         banksel ACCE_NO_LOW
1720 6BD6      01469         clrf    ACCE_NO_LOW
1722 0100      01470         banksel ACCE_NO_HIGH
1724 6BD5      01471         clrf    ACCE_NO_HIGH
               01472 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 29


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01473         ;Lectura registros interrupciones
1726 0100      01474         banksel ACCE_ADRESS
1728 0E0A      01475         movlw   DETSRC
172A 6FD7      01476         movwf   ACCE_ADRESS
172C ECC1 F00C 01477         call    ACCE_READ
1730 0100      01478         banksel ACCE_DATA_IN
1732 51D9      01479         movf    ACCE_DATA_IN,W
1734 0B03      01480         andlw   b'00000011'
1736 0100      01481         banksel SEN_ACCE_TAP
1738 6FDA      01482         movwf   SEN_ACCE_TAP
               01483 
173A B3DA      01484         btfsc   SEN_ACCE_TAP,TAP_TAP
173C 91DA      01485         bcf             SEN_ACCE_TAP,TAP
               01486 
               01487         ;Borrado interrupciones
173E 0100      01488         banksel ACCE_ADRESS
1740 0E17      01489         movlw   INTRST
1742 6FD7      01490         movwf   ACCE_ADRESS
1744 0E03      01491         movlw   b'00000011'
1746 6FD8      01492         movwf   ACCE_DATA_OUT
1748 ECAF F00C 01493         call    ACCE_WRITE
               01494 
               01495         ;Borrado interrupciones
174C 0100      01496         banksel ACCE_ADRESS
174E 0E17      01497         movlw   INTRST
1750 6FD7      01498         movwf   ACCE_ADRESS
1752 0E00      01499         movlw   b'00000000'
1754 6FD8      01500         movwf   ACCE_DATA_OUT
1756 ECAF F00C 01501         call    ACCE_WRITE
               01502 
175A 0100      01503         banksel SEN_STATUS
175C 83DB      01504         bsf             SEN_STATUS,SENOK
               01505 
               01506         ;Delay para doble tap
175E EC05 F00D 01507         call    Delay_50ms
1762 EC05 F00D 01508         call    Delay_50ms
1766 EC05 F00D 01509         call    Delay_50ms
176A EC05 F00D 01510         call    Delay_50ms
176E EC05 F00D 01511         call    Delay_50ms
               01512 
               01513 
1772 ECF6 F00C 01514         call    SEN_INTER_RETURN
1776 0012      01515         return
               01516 
               01517 
               01518 ;*****************************************************
               01519 ;*               SEN_LINE_DIG                       *
               01520 ;*****************************************************
               01521 ;*Descripción: Devuelve si se ha detectado una       *
               01522 ;*línea negra sobre suelo claro                      *
               01523 ;*****************************************************
               01524 ;*Variables de entrada:                              *
               01525 ;*Variables de salida: -SEN_LINE_R                       *
               01526 ;*                     -SEN_LINE_L                       *
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 30


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01527 ;*****************************************************
1778 01528 SEN_LINE_DIG
1778 ECEE F00C 01529         call    SEN_INTER_CALL
               01530 
               01531         ;Se manda pulso de luz infrarroja para
               01532     ;la deteción de línea
177C 010F      01533         banksel PORTD
177E 8283      01534         bsf             LINE_TX
1780 EC39 F00D 01535         call    Delay_900us
               01536 
1784 0100      01537         banksel SEN_LINE_R
1786 6BC8      01538         clrf    SEN_LINE_R
1788 6BC7      01539         clrf    SEN_LINE_L
               01540 
178A 010F      01541         banksel PORTA
178C A480      01542         btfss   PORTA,2
178E EFCB F00B 01543         goto    SEN_LINE_CONT_01
1792 0100      01544         banksel SEN_LINE_R
Message [305] : Using default destination of 1 (file).
1794 2BC8      01545         incf    SEN_LINE_R
               01546 
1796 01547 SEN_LINE_CONT_01
               01548 
1796 010F      01549         banksel PORTA
1798 AA80      01550         btfss   PORTA,5
179A EFD1 F00B 01551         goto    SEN_LINE_CONT_02
179E 0100      01552         banksel SEN_LINE_L
Message [305] : Using default destination of 1 (file).
17A0 2BC7      01553         incf    SEN_LINE_L
               01554 
17A2 01555 SEN_LINE_CONT_02
               01556 
17A2 010F      01557         banksel PORTD
17A4 9283      01558         bcf             LINE_TX
               01559 
17A6 ECF6 F00C 01560         call    SEN_INTER_RETURN
17AA 0012      01561         return  
               01562 ;*****************************************************
               01563 
               01564 
               01565 
               01566 
               01567 ;*****************************************************
               01568 ;*               SEN_LINE_ANALOG                     *
               01569 ;*****************************************************
               01570 ;*Descripción: Devuelve el valor de la claridad del  *
               01571 ;*suelo. Se puede distinguir colores dependiendo del *
               01572 ;*material.                                          *
               01573 ;*****************************************************
               01574 ;*Variables de entrada:                              *
               01575 ;*Variables de salida: -SEN_LINE_R                       *
               01576 ;*                     -SEN_LINE_L                   *
               01577 ;*****************************************************
17AC 01578 SEN_LINE_ANALOG
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 31


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
17AC ECEE F00C 01579         call    SEN_INTER_CALL
               01580 
               01581         ;Configuramos las entradas como analógicas
17B0 010F      01582         banksel WDTCON
17B2 88C0      01583         bsf             WDTCON,ADSHR
17B4 010F      01584         banksel ANCON0
17B6 0EFB      01585         movlw   b'11111011'
17B8 6EC1      01586         movwf   ANCON0
17BA 010F      01587         banksel WDTCON
17BC 98C0      01588         bcf             WDTCON,ADSHR
               01589 
17BE 0E09      01590         movlw   b'00001001'             
17C0 010F      01591         banksel ADCON0
17C2 6EC2      01592         movwf   ADCON0
               01593 
               01594         ;Se manda pulso de luz infrarroja para
               01595     ;la deteción de línea
               01596         
17C4 010F      01597         banksel PORTD
17C6 8283      01598         bsf             LINE_TX
17C8 EC39 F00D 01599         call    Delay_900us
               01600 
               01601         ;Lectura del sensor derecho
               01602 
17CC 010F      01603         banksel ADCON0
17CE 82C2      01604         bsf             ADCON0,GO
17D0 01605 SEN_LINE_ANALOG_TAG_00
17D0 B2C2      01606         btfsc   ADCON0,GO       
17D2 EFE8 F00B 01607         goto    SEN_LINE_ANALOG_TAG_00
17D6 010F      01608         banksel ADRESH
17D8 50C4      01609         movf    ADRESH,W                
17DA 0100      01610         banksel SEN_LINE_R
17DC 6FC8      01611         movwf   SEN_LINE_R
               01612         
17DE 010F      01613         banksel ADCON0
17E0 0E11      01614         movlw   b'00010001'             
17E2 6EC2      01615         movwf   ADCON0
               01616         
17E4 EC27 F00D 01617         call    Delay_100us
               01618 
17E8 010F      01619         banksel ADCON0
17EA 82C2      01620         bsf             ADCON0,GO
17EC 01621 SEN_LINE_ANALOG_TAG_01
17EC B2C2      01622         btfsc   ADCON0,GO       
17EE EFF6 F00B 01623         goto    SEN_LINE_ANALOG_TAG_01
17F2 010F      01624         banksel ADRESH
17F4 50C4      01625         movf    ADRESH,W
17F6 0100      01626         banksel SEN_LINE_L              
17F8 6FC7      01627         movwf   SEN_LINE_L      
               01628         
               01629         ;Finalización del pulso de luz infrarroja
17FA 010F      01630         banksel PORTD
17FC 9283      01631         bcf             LINE_TX
17FE 010F      01632         banksel WDTCON
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 32


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1800 88C0      01633         bsf             WDTCON,ADSHR
1802 010F      01634         banksel ANCON0
1804 0EFF      01635         movlw   b'11111111'
1806 6EC1      01636         movwf   ANCON0
1808 010F      01637         banksel WDTCON
180A 98C0      01638         bcf             WDTCON,ADSHR
               01639         
               01640         ;Divide by 2.55
180C 0100      01641         banksel SEN_LINE_L
180E 51C7      01642         movf    SEN_LINE_L, W
1810 90D8      01643         bcf             STATUS,C
1812 33C7      01644         rrcf    SEN_LINE_L, F
1814 90D8      01645         bcf             STATUS,C
1816 33C7      01646         rrcf    SEN_LINE_L, F
1818 27C7      01647         addwf   SEN_LINE_L, F
181A 33C7      01648         rrcf    SEN_LINE_L, F
181C 90D8      01649         bcf             STATUS,C
181E 33C7      01650         rrcf    SEN_LINE_L, F
1820 90D8      01651         bcf             STATUS,C
1822 33C7      01652         rrcf    SEN_LINE_L, F
1824 27C7      01653         addwf   SEN_LINE_L, F
1826 33C7      01654         rrcf    SEN_LINE_L, F
1828 27C7      01655         addwf   SEN_LINE_L, F
182A 33C7      01656         rrcf    SEN_LINE_L, F
182C 90D8      01657         bcf             STATUS,C
182E 33C7      01658         rrcf    SEN_LINE_L, F
               01659         
               01660         
1830 0100      01661         banksel SEN_LINE_R
1832 51C8      01662         movf    SEN_LINE_R, W
1834 90D8      01663         bcf             STATUS,C
1836 33C8      01664         rrcf    SEN_LINE_R, F
1838 90D8      01665         bcf             STATUS,C
183A 33C8      01666         rrcf    SEN_LINE_R, F
183C 27C8      01667         addwf   SEN_LINE_R, F
183E 33C8      01668         rrcf    SEN_LINE_R, F
1840 90D8      01669         bcf             STATUS,C
1842 33C8      01670         rrcf    SEN_LINE_R, F
1844 90D8      01671         bcf             STATUS,C
1846 33C8      01672         rrcf    SEN_LINE_R, F
1848 27C8      01673         addwf   SEN_LINE_R, F
184A 33C8      01674         rrcf    SEN_LINE_R, F
184C 27C8      01675         addwf   SEN_LINE_R, F
184E 33C8      01676         rrcf    SEN_LINE_R, F
1850 90D8      01677         bcf             STATUS,C
1852 33C8      01678         rrcf    SEN_LINE_R, F
               01679         
               01680         
1854 ECF6 F00C 01681         call    SEN_INTER_RETURN
1858 0012      01682         return  
               01683 ;*****************************************************
               01684 ;*****************************************************
               01685 
               01686 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 33


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01687 
               01688 
               01689 
               01690 ;*****************************************************
               01691 ;*                   LED_xx_xx                       *
               01692 ;*****************************************************
               01693 ;*Descripción: Funciones de manejo de LED del robot  *
               01694 ;*****************************************************
               01695 ;*Variables de entrada:                              *
               01696 ;*Variables de salida:                               *
               01697 ;*****************************************************
               01698 ;Encendido de led de freno
185A 01699 LED_BRAKE_ON    
185A ECEE F00C 01700         call    SEN_INTER_CALL
185E 010F      01701         banksel TRISE
1860 8A84      01702         bsf             LED_BRAKE
1862 ECF6 F00C 01703         call    SEN_INTER_RETURN
1866 0012      01704         return  
               01705 ;Apagado de led de freno
1868 01706 LED_BRAKE_OFF   
1868 ECEE F00C 01707         call    SEN_INTER_CALL
186C 010F      01708         banksel TRISE
186E 9A84      01709         bcf             LED_BRAKE
1870 ECF6 F00C 01710         call    SEN_INTER_RETURN
1874 0012      01711         return  
               01712 
               01713 ;Parpadeo de led de freno
1876 01714 LED_BRAKE_ON_OFF
1876 ECEE F00C 01715         call    SEN_INTER_CALL
187A 010F      01716         banksel TRISE
187C 8A84      01717         bsf             LED_BRAKE
187E EC05 F00D 01718         call    Delay_50ms
1882 9A84      01719         bcf             LED_BRAKE
1884 EC05 F00D 01720         call    Delay_50ms
1888 ECF6 F00C 01721         call    SEN_INTER_RETURN
188C 0012      01722         return  
               01723 ;Encendido de led delantero 
188E 01724 LED_FRONT_ON    
188E ECEE F00C 01725         call    SEN_INTER_CALL
1892 010F      01726         banksel TRISE
1894 9E82      01727         bcf             LED_FRONT
1896 ECF6 F00C 01728         call    SEN_INTER_RETURN
189A 0012      01729         return  
               01730 
               01731 ;Apagado de led delantero 
189C 01732 LED_FRONT_OFF
189C ECEE F00C 01733         call    SEN_INTER_CALL
18A0 010F      01734         banksel TRISE
18A2 8E82      01735         bsf             LED_FRONT
18A4 ECF6 F00C 01736         call    SEN_INTER_RETURN
18A8 0012      01737         return  
               01738 ;Parpadeo de led delantero izquierdo
18AA 01739 LED_FRONT_ON_OFF
18AA ECEE F00C 01740         call    SEN_INTER_CALL
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 34


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01741          
18AE 010F      01742         banksel TRISE
18B0 9E82      01743         bcf             LED_FRONT
18B2 EC05 F00D 01744         call    Delay_50ms
18B6 8E82      01745         bsf             LED_FRONT
18B8 EC05 F00D 01746         call    Delay_50ms
18BC ECF6 F00C 01747         call    SEN_INTER_RETURN
18C0 0012      01748         return  
               01749 
               01750 ;Encendido de led superior rojo
18C2 01751 LED_TOP_RED_ON  
18C2 ECEE F00C 01752         call    SEN_INTER_CALL
18C6 010F      01753         banksel TRISB
18C8 9A81      01754         bcf             LED_TOP_RED
18CA ECF6 F00C 01755         call    SEN_INTER_RETURN
18CE 0012      01756         return  
               01757 
               01758 ;Apagado de led superior rojo
18D0 01759 LED_TOP_RED_OFF
18D0 ECEE F00C 01760         call    SEN_INTER_CALL
18D4 010F      01761         banksel TRISB
18D6 8A81      01762         bsf             LED_TOP_RED
18D8 ECF6 F00C 01763         call    SEN_INTER_RETURN
18DC 0012      01764         return  
               01765 
               01766 ;Parpadeo de led superior rojo
18DE 01767 LED_TOP_RED_ON_OFF
18DE ECEE F00C 01768         call    SEN_INTER_CALL
               01769          
18E2 010F      01770         banksel TRISB
18E4 9A81      01771         bcf             LED_TOP_RED
18E6 EC05 F00D 01772         call    Delay_50ms
18EA 8A81      01773         bsf             LED_TOP_RED
18EC EC05 F00D 01774         call    Delay_50ms
18F0 ECF6 F00C 01775         call    SEN_INTER_RETURN
18F4 0012      01776         return  
               01777 
               01778 ;Encendido de led superior verde
18F6 01779 LED_TOP_GREEN_ON        
18F6 ECEE F00C 01780         call    SEN_INTER_CALL
18FA 010F      01781         banksel TRISB
18FC 9C81      01782         bcf             LED_TOP_GREEN
18FE ECF6 F00C 01783         call    SEN_INTER_RETURN
1902 0012      01784         return  
               01785 
               01786 ;Apagado de led superior verde
1904 01787 LED_TOP_GREEN_OFF
1904 ECEE F00C 01788         call    SEN_INTER_CALL  
1908 010F      01789         banksel TRISB
190A 8C81      01790         bsf             LED_TOP_GREEN
190C ECF6 F00C 01791         call    SEN_INTER_RETURN
1910 0012      01792         return  
               01793 
               01794 ;Parpadeo de led superior verde
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 35


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1912 01795 LED_TOP_GREEN_ON_OFF
1912 ECEE F00C 01796         call    SEN_INTER_CALL
               01797          
1916 010F      01798         banksel TRISB
1918 9C81      01799         bcf             LED_TOP_GREEN
191A EC05 F00D 01800         call    Delay_50ms
191E 8C81      01801         bsf             LED_TOP_GREEN
1920 EC05 F00D 01802         call    Delay_50ms
1924 ECF6 F00C 01803         call    SEN_INTER_RETURN
1928 0012      01804         return  
               01805 
               01806 ;Encendido de led superior verde
192A 01807 LED_IR_ON       
192A ECEE F00C 01808         call    SEN_INTER_CALL
192E 010F      01809         banksel TRISJ
1930 8E88      01810         bsf             LED_IR
1932 ECF6 F00C 01811         call    SEN_INTER_RETURN
1936 0012      01812         return  
               01813 
               01814 ;Apagado de led superior verde
1938 01815 LED_IR_OFF
1938 ECEE F00C 01816         call    SEN_INTER_CALL  
193C 010F      01817         banksel TRISJ
193E 9E88      01818         bcf             LED_IR
1940 ECF6 F00C 01819         call    SEN_INTER_RETURN
1944 0012      01820         return  
               01821 
               01822 ;Parpadeo de led superior verde
1946 01823 LED_IR_ON_OFF
1946 ECEE F00C 01824         call    SEN_INTER_CALL
               01825          
194A 010F      01826         banksel TRISJ
194C 9E88      01827         bcf             LED_IR
194E EC05 F00D 01828         call    Delay_50ms
1952 8E88      01829         bsf             LED_IR
1954 EC05 F00D 01830         call    Delay_50ms
1958 ECF6 F00C 01831         call    SEN_INTER_RETURN
195C 0012      01832         return  
               01833 
               01834 ;*****************************************************
               01835 
               01836 
               01837 
               01838 
               01839 
               01840 ;*****************************
               01841 ;*****************************
               01842 ;**     FUNCIONES AUXILIARES    **
               01843 ;*****************************
               01844 ;*****************************
               01845 
195E 01846 ACCE_WRITE
195E 010F      01847         banksel PORTD
1960 9E83      01848         bcf             ACCE_CSN
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 36


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1962 EC39 F00D 01849         call    Delay_900us
1966 0100      01850         banksel ACCE_ADRESS
1968 35D7      01851         rlcf    ACCE_ADRESS,W
196A 0100      01852         banksel SEN_ACCE_BYTE_OUT_1
196C 6FCE      01853         movwf   SEN_ACCE_BYTE_OUT_1
196E 8FCE      01854         bsf             SEN_ACCE_BYTE_OUT_1,7
1970 0100      01855         banksel ACCE_DATA_OUT
1972 51D8      01856         movf    ACCE_DATA_OUT,W
1974 0100      01857         banksel SEN_ACCE_BYTE_OUT_2
1976 6FCF      01858         movwf   SEN_ACCE_BYTE_OUT_2
1978 ECD5 F00C 01859         call    SEN_ACCE_SPI_OUT
197C 010F      01860         banksel PORTD
197E 8E83      01861         bsf             ACCE_CSN
1980 0012      01862         return  
               01863 
1982 01864 ACCE_READ
1982 010F      01865         banksel PORTD
1984 9E83      01866         bcf             ACCE_CSN
1986 EC39 F00D 01867         call    Delay_900us
198A 0100      01868         banksel ACCE_ADRESS
198C 35D7      01869         rlcf    ACCE_ADRESS,W
198E 0100      01870         banksel SEN_ACCE_BYTE_OUT_1
1990 6FCE      01871         movwf   SEN_ACCE_BYTE_OUT_1
1992 9FCE      01872         bcf             SEN_ACCE_BYTE_OUT_1,7
1994 0E00      01873         movlw   0x00
1996 0100      01874         banksel SEN_ACCE_BYTE_OUT_2
1998 6FCF      01875         movwf   SEN_ACCE_BYTE_OUT_2
199A ECD5 F00C 01876         call    SEN_ACCE_SPI_OUT
199E 51D1      01877         movf    SEN_ACCE_BYTE_IN_2,W
19A0 0100      01878         banksel ACCE_DATA_IN
19A2 6FD9      01879         movwf   ACCE_DATA_IN
19A4 010F      01880         banksel PORTD
19A6 8E83      01881         bsf             ACCE_CSN
19A8 0012      01882         return  
               01883 
               01884 
               01885 
               01886 
19AA 01887 SEN_ACCE_SPI_OUT
19AA 0100      01888         banksel SEN_ACCE_BYTE_OUT_1
19AC 51CE      01889         movf    SEN_ACCE_BYTE_OUT_1,w
19AE 010F      01890         banksel SSP2BUF
19B0 6E6F      01891         movwf   SSP2BUF                 ;Load send data
19B2 010F      01892         banksel SSP2STAT
19B4 01893 SPI_continuar_1
19B4 A06D      01894         btfss   SSP2STAT,BF
19B6 EFDA F00C 01895         goto    SPI_continuar_1 ;Wait
               01896 
19BA 010F      01897         banksel SSP2BUF
19BC 506F      01898         movf    SSP2BUF,w
19BE 0100      01899         banksel SEN_ACCE_BYTE_IN_1      
19C0 6FD0      01900         movwf   SEN_ACCE_BYTE_IN_1              ;Store received data
               01901 
               01902 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 37


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
19C2 0100      01903         banksel SEN_ACCE_BYTE_OUT_2
19C4 51CF      01904         movf    SEN_ACCE_BYTE_OUT_2,w
19C6 010F      01905         banksel SSP2BUF
19C8 6E6F      01906         movwf   SSP2BUF                 ;Load send data
19CA 010F      01907         banksel SSP2STAT
19CC 01908 SPI_continuar_2
19CC A06D      01909         btfss   SSP2STAT,BF
19CE EFE6 F00C 01910         goto    SPI_continuar_2 ;Wait
               01911 
               01912 
19D2 010F      01913         banksel SSP2BUF
19D4 506F      01914         movf    SSP2BUF,w
19D6 0100      01915         banksel SEN_ACCE_BYTE_IN_2      
19D8 6FD1      01916         movwf   SEN_ACCE_BYTE_IN_2              ;Store received data
19DA 0012      01917         return
               01918 
               01919 
               01920 ;************************************************
               01921 ;*SEN_INTER_CALL:Checkea si las interrupciones  *
               01922 ;*                           estan habilitadas. Si lo estan     *
               01923 ;*                               las inhabilita                                 *
               01924 ;************************************************
               01925 
19DC 01926 SEN_INTER_CALL
               01927          
19DC 010F      01928         banksel INTCON
19DE 50F2      01929         movf    INTCON,W
19E0 0100      01930         banksel INTER_SEN
19E2 6FDE      01931         movwf   INTER_SEN
19E4 010F      01932         banksel INTCON
19E6 9EF2      01933         bcf             INTCON,GIE
19E8 0100      01934         banksel INTER_SEN
19EA 0012      01935         return
               01936 ;************************************************
               01937 
               01938         
               01939 
               01940 
               01941 
               01942 ;*************************************************
               01943 ;*SEN_INTER_RETURN:Checkea si las interrupciones *
               01944 ;*                             estan habilitadas. Si lo estan*
               01945 ;*                                 las inhabilita                                *
               01946 ;*************************************************
               01947 
19EC 01948 SEN_INTER_RETURN
               01949          
19EC 0100      01950         banksel INTER_SEN
19EE 51DE      01951         movf    INTER_SEN,W
19F0 BFDE      01952         btfsc   INTER_SEN,7     
19F2 EFFD F00C 01953         goto    SEN_GIE_UNO
19F6 EF01 F00D 01954         goto    SEN_GIE_CERO
               01955 
19FA 01956 SEN_GIE_UNO
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 38


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
19FA 010F      01957         banksel INTCON
19FC 8EF2      01958         bsf             INTCON,GIE
19FE 0100      01959         banksel INTER_SEN
1A00 0012      01960         return
1A02 01961 SEN_GIE_CERO
1A02 010F      01962         banksel INTCON
1A04 9EF2      01963         bcf             INTCON,GIE
1A06 0100      01964         banksel INTER_SEN
1A08 0012      01965         return
               01966 ;************************************************
               01967 
               01968 
               01969 
               01970 
               01971 ;*************************************************
               01972 ;*Delay_xxxx:Temporizaciones necesarias para la  * 
               01973 ;*                       correcta captura de datos                       *
               01974 ;*************************************************
               01975 
1A0A 01976 Delay_50ms
1A0A 0100      01977         banksel DELAY_1
1A0C 0E0E      01978         movlw   0x0E
1A0E 6FDF      01979         movwf   DELAY_1
1A10 0E28      01980         movlw   0x28
1A12 6FE0      01981         movwf   DELAY_1_1
1A14 01982 Delay_50ms_0
1A14 2FDF      01983         decfsz  DELAY_1, f
1A16 EF0E F00D 01984         goto    Delay_50ms_1
1A1A 2FE0      01985         decfsz  DELAY_1_1, f
1A1C 01986 Delay_50ms_1
1A1C EF0A F00D 01987         goto    Delay_50ms_0
1A20 EF12 F00D 01988         goto    Delay_50ms_2
1A24 01989 Delay_50ms_2
1A24 0000      01990         nop
1A26 0012      01991         return
               01992 
               01993 
1A28 01994 Delay_50ms_mOwayGUI
1A28 0100      01995         banksel DELAY_1
1A2A 0E0E      01996         movlw   0x0E
1A2C 6FDF      01997         movwf   DELAY_1
1A2E 0E28      01998         movlw   0x28
1A30 6FE0      01999         movwf   DELAY_1_1
1A32 02000 Delay_50ms_mOwayGUI_0
1A32 2FDF      02001         decfsz  DELAY_1, f
1A34 EF1D F00D 02002         goto    Delay_50ms_mOwayGUI_1
1A38 2FE0      02003         decfsz  DELAY_1_1, f
1A3A 02004 Delay_50ms_mOwayGUI_1
1A3A EF19 F00D 02005         goto    Delay_50ms_mOwayGUI_0
1A3E EF21 F00D 02006         goto    Delay_50ms_mOwayGUI_2
1A42 02007 Delay_50ms_mOwayGUI_2
1A42 0000      02008         nop
1A44 0100      02009         banksel AUX_00
Message [305] : Using default destination of 1 (file).
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 39


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1A46 4FDC      02010         dcfsnz  AUX_00
1A48 0012      02011         return
1A4A EF14 F00D 02012         goto    Delay_50ms_mOwayGUI
               02013 
               02014 
               02015 
               02016 ;************************************************
1A4E 02017 Delay_100us
1A4E 0100      02018         banksel DELAY_1
1A50 0E1F      02019         movlw   0x1F
1A52 6FDF      02020         movwf   DELAY_1
1A54 02021 Delay_100us_0
1A54 2FDF      02022         decfsz  DELAY_1, f
1A56 EF2A F00D 02023         goto    Delay_100us_0
1A5A EF2F F00D 02024         goto    Delay_100us_1
1A5E 02025 Delay_100us_1
1A5E 0012      02026         return
               02027         ;************************************************
1A60 02028 Delay_120us
1A60 0100      02029         banksel DELAY_1
1A62 0E26      02030         movlw   0x26
1A64 6FDF      02031         movwf   DELAY_1
1A66 02032 Delay_120us_0
1A66 2FDF      02033         decfsz  DELAY_1, f
1A68 EF33 F00D 02034         goto    Delay_120us_0
1A6C EF38 F00D 02035         goto    Delay_120us_1
1A70 02036 Delay_120us_1
1A70 0012      02037         return
               02038 ;************************************************
1A72 02039 Delay_900us
1A72 0100      02040         banksel DELAY_1
1A74 0EB2      02041         movlw   0xB2
1A76 6FDF      02042         movwf   DELAY_1
1A78 0E01      02043         movlw   0x01
1A7A 6FE0      02044         movwf   DELAY_1_1
1A7C 02045 Delay_900us_0
1A7C 2FDF      02046         decfsz  DELAY_1, f
1A7E EF42 F00D 02047         goto    Delay_900us_1
1A82 2FE0      02048         decfsz  DELAY_1_1, f
1A84 02049 Delay_900us_1
1A84 EF3E F00D 02050         goto    Delay_900us_0
1A88 EF46 F00D 02051         goto    Delay_900us_2
1A8C 02052 Delay_900us_2
1A8C 0000      02053         nop
1A8E 0100      02054         banksel DELAY_1
1A90 0012      02055         return
               02056 ;************************************************
1A92 02057 Delay_500us
1A92 0100      02058         banksel DELAY_1
1A94 0EA6      02059         movlw   0xA6
1A96 6FDF      02060         movwf   DELAY_1
1A98 02061 Delay_500us_0
1A98 2FDF      02062         decfsz  DELAY_1, f
1A9A EF4C F00D 02063         goto    Delay_500us_0
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 40


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1A9E 0012      02064         return
               02065 ;************************************************
1AA0 02066 Delay_65us
1AA0 0100      02067         banksel DELAY_1
1AA2 0E14      02068         movlw   0x14
1AA4 6FDF      02069         movwf   DELAY_1
1AA6 02070 Delay_65us_0
1AA6 2FDF      02071         decfsz  DELAY_1, f
1AA8 EF53 F00D 02072         goto    Delay_65us_0
1AAC 0012      02073         return
               02074 ;************************************************
1AAE 02075 Delay_30us
1AAE 0100      02076         banksel DELAY_1
1AB0 0E08      02077         movlw   0x08
1AB2 6FDF      02078         movwf   DELAY_1
1AB4 02079 Delay_30us_0
1AB4 2FDF      02080         decfsz  DELAY_1, f
1AB6 EF5A F00D 02081         goto    Delay_30us_0
1ABA 0000      02082         nop
1ABC 0012      02083         return
               02084 ;************************************************
1ABE 02085 Delay_1500us
1ABE 0100      02086         banksel DELAY_1
1AC0 0E2A      02087         movlw   0x2A
1AC2 6FDF      02088         movwf   DELAY_1
1AC4 0E02      02089         movlw   0x02
1AC6 6FE0      02090         movwf   DELAY_1_1
1AC8 02091 Delay_1500us_0
1AC8 2FDF      02092         decfsz  DELAY_1, f
1ACA EF68 F00D 02093         goto    Delay_1500us_1
1ACE 2FE0      02094         decfsz  DELAY_1_1, f
1AD0 02095 Delay_1500us_1
1AD0 EF64 F00D 02096         goto    Delay_1500us_0
1AD4 EF6C F00D 02097         goto    Delay_1500us_2
1AD8 02098 Delay_1500us_2
1AD8 0000      02099         nop
1ADA 0012      02100         return
               02101 ;************************************************
               02102 
               02103 ;************************************************
1ADC 02104 Delay_100ms
1ADC 0100      02105         banksel DELAY_1
1ADE 0E1F      02106         movlw   0x1F
1AE0 6FDF      02107         movwf   DELAY_1
1AE2 0E4F      02108         movlw   0x4F
1AE4 6FE0      02109         movwf   DELAY_1_1
1AE6 02110 Delay_1000us_0
1AE6 2FDF      02111         decfsz  DELAY_1, f
1AE8 EF77 F00D 02112         goto    Delay_1000us_1
1AEC 2FE0      02113         decfsz  DELAY_1_1, f
1AEE 02114 Delay_1000us_1
1AEE EF73 F00D 02115         goto    Delay_1000us_0
1AF2 EF7B F00D 02116         goto    Delay_1000us_2
1AF6 02117 Delay_1000us_2
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 41


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1AF6 0000      02118         nop
1AF8 0012      02119         return
               02120 ;************************************************
               02121 
               02122 
               02123 
               00027   #include "inc\lib_rf2gh4_GUI.inc"
               00001 ;********************************************************************************
               00002 ;*    lib_rf2gh4.inc                                                                                                                    *
               00003 ;*        version: 2.0                                                                                                                          *
               00004 ;*        This library written in assembler and contains the functions to manage the* 
               00005 ;*    RF2GH4 module.    
               00006 ;*    Copyright (C) 2007  Bizintek Innova S.L.                                                                  *
               00007 ;********************************************************************************
               00008 ;*    This program is free software; you can redistribute it and/or modify              *
               00009 ;*    it under the terms of the GNU General Public License as published by              *
               00010 ;*    the Free Software Foundation; either version 2 of the License, or                 *
               00011 ;*    (at your option) any later version.                                                                               *
               00012 ;*                                                                                                                                                              *
               00013 ;*    This program is distributed in the hope that it will be useful,                   *
               00014 ;*    but WITHOUT ANY WARRANTY; without even the implied warranty of                    *
               00015 ;*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                             *
               00016 ;*    GNU General Public License for more details.                                                              *
               00017 ;*                                                                                                                                                              *
               00018 ;*    You should have received a copy of the GNU General Public License along   *
               00019 ;*    with this program; if not, write to the Free Software Foundation, Inc.,   *
               00020 ;*    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.                               *
               00021 ;********************************************************************************
               00022 
               00023 ;Delete BANK changed warning
               00024  ERRORLEVEL -302 
               00025 
               00026 ;********************
               00027 ;*      DEFINICIONES    *
               00028 ;********************
               00029 
               00030 ;*      Pinout definition
               00031 
               00032         ;PORTB
1AFA 00033 #define IRQ_PIN                 PORTB,0
1AFA 00034 #define CSN_PIN                 PORTF,2 
               00035         ;PORTC
1AFA 00036 #define CE_PIN                  PORTH,4 
1AFA 00037 #define SCK_PIN                 PORTC,3
1AFA 00038 #define SDI_PIN                 PORTC,4
1AFA 00039 #define SDO_PIN                 PORTC,5
               00040 
               00041         ;TRISB
1AFA 00042 #define IRQ_TRIS                TRISB,0
1AFA 00043 #define CSN_TRIS                TRISF,2 
               00044         ;TRISC
1AFA 00045 #define CE_TRIS                 TRISH,4 
1AFA 00046 #define SCK_TRIS                TRISC,3
1AFA 00047 #define SDI_TRIS                TRISC,4
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 42


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1AFA 00048 #define SDO_TRIS                TRISC,5
               00049 
               00050 
               00051 ;****************
               00052 ;*      VARIABLES       *
               00053 ;****************
               00054 
               00055 ;*      SPI variables (BANK0)
               00056         cblock  0x00
               00057 
               00058         BYTE_IN                 
               00059         BYTE_OUT                
               00060 
               00061         ;*      RF variables
               00062         RF_ESTADO               
               00063         DIR_REG                 
               00064         DATO_REG                
               00065         RF_NO_HIGH              
               00066         RF_NO_LOW       
               00067         INTER_RF                
               00068         RF_STATUS               
               00069         DATO_DIR        
               00070         DATA_N_SND              
               00071         DATA_N_RCV      
               00072 
               00073         ;*       Configurable RF variables
               00074         RF_CHN          
               00075         RF_DIR                  
               00076 
               00077         RF_DIR_OUT      
               00078         RF_DATA_OUT_0
               00079         RF_DATA_OUT_1
               00080         RF_DATA_OUT_2
               00081         RF_DATA_OUT_3   
               00082         RF_DATA_OUT_4
               00083         RF_DATA_OUT_5   
               00084         RF_DATA_OUT_6
               00085         RF_DATA_OUT_7
               00086 
               00087         RF_DIR_IN       
               00088         RF_DATA_IN_0
               00089         RF_DATA_IN_1    
               00090         RF_DATA_IN_2
               00091         RF_DATA_IN_3
               00092         RF_DATA_IN_4    
               00093         RF_DATA_IN_5
               00094         RF_DATA_IN_6
               00095         RF_DATA_IN_7    
               00096 
               00097         ;*      Delay Variables 
               00098         PDel0                   
               00099         PDel1                   
               00100         PDel2   
               00101         endc
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 43


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00102 
               00103 ;*      RF_STATUS Variable
1AFA 00104 #define SNDOK                           0
1AFA 00105 #define ACK                                     1
1AFA 00106 #define RCVOK                           2
1AFA 00107 #define RCVNW                           3
1AFA 00108 #define ONOK                            4
1AFA 00109 #define OFFOK                           5
1AFA 00110 #define CONFIGOK                        6
               00111 
               00112 
               00113 ;************
               00114 ;*      CODE    *
               00115 ;************
               00116 
               00117 
               00118 ;*****************************************************
               00119 ;*                      RF_CONFIG_SPI                        *
               00120 ;*****************************************************
               00121 ;*Description: This function configures                          * 
               00122 ;*microcontroller´s SPI module.                          *
               00123 ;*****************************************************
               00124 ;*Input:                                                             *
               00125 ;*Output:                                                        *
               00126 ;*****************************************************
               00127 
               00128 
1AFA 00129 RF_CONFIG_SPI
               00130 
               00131         ;I/O Configuration
1AFA 010F      00132         banksel TRISC   
1AFC 8894      00133         bsf             SDI_TRIS
1AFE 9A94      00134         bcf             SDO_TRIS
1B00 9694      00135         bcf             SCK_TRIS
1B02 9899      00136         bcf             CE_TRIS 
               00137         ;I/Os are configured 
1B04 010F      00138         banksel TRISB
1B06 9497      00139         bcf             CSN_TRIS
1B08 8093      00140         bsf             IRQ_TRIS
               00141 
               00142         ;Configuration of SPI module
1B0A 010F      00143         banksel SSP1STAT
1B0C 0EC0      00144         movlw   b'11000000'
1B0E 6EC7      00145         movwf   SSP1STAT
1B10 010F      00146         banksel SSPCON2
1B12 6AC5      00147         clrf    SSPCON2
               00148 
1B14 010F      00149         banksel SSPCON1
1B16 0E20      00150         movlw   b'00100000'
1B18 6EC6      00151         movwf   SSPCON1
1B1A 0012      00152         return
               00153 
               00154 ;*****************************************************
               00155 ;*                    RF_INT_EN                      *
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 44


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00156 ;*****************************************************
               00157 ;*Descripción:Enables external interrupt used by the *
               00158 ;*RF module (in this microcontroller RB0)                        *
               00159 ;*****************************************************
               00160 ;*Input:                                                             *
               00161 ;*Output:                                                        *
               00162 ;*****************************************************
1B1C 00163 RF_INT_EN
               00164 
               00165         ;Enables external interrupt HIGH to LOW. 
1B1C 010F      00166         banksel INTCON
1B1E 9EF2      00167         bcf             INTCON,GIE
1B20 010F      00168         banksel INTCON2
1B22 9CF1      00169         bcf             INTCON2,INTEDG0
1B24 010F      00170         banksel PORTC   
1B26 8081      00171         bsf             IRQ_PIN
1B28 010F      00172         banksel INTCON
1B2A 88F2      00173         bsf             INTCON,INT0E
1B2C 8EF2      00174         bsf             INTCON,GIE
1B2E 0100      00175         banksel INTER_RF
1B30 0012      00176         return
               00177 
               00178 
               00179 ;*****************************************************
               00180 ;*                                RF_CONFIG                                      *
               00181 ;*****************************************************
               00182 ;*Description:Configures the RF module´s different       *
               00183 ;*parameters:channel, direction, etc.                            *
               00184 ;*****************************************************
               00185 ;*Input:                           - RF_CHN                      *
               00186 ;*                     - RF_DIR                          *
               00187 ;*Output:                          - RF_STATUS,CONFIGOK          *
               00188 ;*****************************************************
1B32 00189 RF_CONFIG
               00190         
               00191         ;I/Os are configured 
1B32 010F      00192         banksel TRISA
1B34 9485      00193         bcf             CSN_PIN
1B36 8081      00194         bsf             IRQ_PIN
1B38 9887      00195         bcf             CE_PIN  
               00196 
               00197         ;Interrupts disabled to avoid reentrancy
1B3A EC7C F010 00198         call    RF_INTER_CALL
               00199 
1B3E 0100      00200         banksel DATA_N_SND
               00201         ;Clear nº of data sent
1B40 6A0A      00202         clrf    DATA_N_SND
1B42 0100      00203         banksel DATA_N_RCV
1B44 6A0B      00204         clrf    DATA_N_RCV
               00205 
1B46 010F      00206         banksel TRISA
1B48 9887      00207         bcf             CE_PIN
               00208 
               00209         ;TX_ADDR (0xFF)
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 45


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00210         ;Configuration of a random direction of the receiver.
               00211         ;RF_SEND configures the final receivers direction.
1B4A 0100      00212         banksel DIR_REG 
1B4C 0E10      00213         movlw   0x10                    
1B4E 6E03      00214         movwf   DIR_REG
1B50 0EFF      00215         movlw   b'11111111'     
1B52 6E04      00216         movwf   DATO_REG
1B54 ECAF F00F 00217         call    W_REGISTER_5
               00218 
               00219         ;RX_ADDR_P0 (0xFF) ACK
               00220         ;Configuration of pipe0 to receive the ACK
1B58 0E0A      00221         movlw   0x0A                    
1B5A 6E03      00222         movwf   DIR_REG
1B5C 0EFF      00223         movlw   b'11111111'
1B5E 6E04      00224         movwf   DATO_REG
1B60 ECAF F00F 00225         call    W_REGISTER_5
               00226         
               00227         
               00228         ;RX_ADDR_P1 (dir)
               00229         ;Configuration of pipe1 to receive data 
1B64 0E0B      00230         movlw   0x0B                    
1B66 6E03      00231         movwf   DIR_REG
1B68 500D      00232         movf    RF_DIR,w
1B6A 6E04      00233         movwf   DATO_REG
1B6C ECAF F00F 00234         call    W_REGISTER_5
               00235 
               00236         ;RX_ADDR_P2 (0x00) BROADCAST
               00237     ;Configuration of pipe2 to receive broadcasted data
1B70 0E0C      00238         movlw   0x0C                    
1B72 6E03      00239         movwf   DIR_REG
1B74 0E00      00240         movlw   b'00000000'
1B76 6E04      00241         movwf   DATO_REG
1B78 EC99 F00F 00242         call    W_REGISTER_1
               00243 
               00244 
               00245         ;EN_AA
               00246         ;Enable AutoAck in Pipe0,Pipe1 and Pipe2.
1B7C 0E01      00247         movlw   0x01                    
1B7E 6E03      00248         movwf   DIR_REG
1B80 0E07      00249         movlw   b'00000111'
1B82 6E04      00250         movwf   DATO_REG
1B84 EC99 F00F 00251         call    W_REGISTER_1
               00252 
               00253         ;EN_RXADDR
               00254         ;Enable Pipe0,Pipe1 and Pipe2.
1B88 0E02      00255         movlw   0x02                    
1B8A 6E03      00256         movwf   DIR_REG
1B8C 0E07      00257         movlw   b'00000111'
1B8E 6E04      00258         movwf   DATO_REG
1B90 EC99 F00F 00259         call    W_REGISTER_1
               00260 
               00261 
               00262         ;SETUP_AW
               00263         ;Configuration of direction lenght.
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 46


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00264         ;Direction lenght: 5 byte.
1B94 0E03      00265         movlw   0x03                    
1B96 6E03      00266         movwf   DIR_REG
1B98 0E03      00267         movlw   b'00000011'
1B9A 6E04      00268         movwf   DATO_REG
1B9C EC99 F00F 00269         call    W_REGISTER_1
               00270 
               00271 
               00272         ;SETUP_RETR
               00273         ;Configuration of retransmission
               00274         ;10 retransmissions every 336us.
1BA0 0E04      00275         movlw   0x04                    
1BA2 6E03      00276         movwf   DIR_REG
1BA4 0E0A      00277         movlw   b'00001010'
1BA6 6E04      00278         movwf   DATO_REG
1BA8 EC99 F00F 00279         call    W_REGISTER_1
               00280 
               00281 
               00282         ;RF_SETUP
               00283         ;Configuration of some aspects of RF module.
               00284         ;LNA maximun gain, 0dBm output power y 2Mbps transmission air speed.
1BAC 0E06      00285         movlw   0x06            
1BAE 6E03      00286         movwf   DIR_REG
1BB0 0E0F      00287         movlw   b'00001111'
1BB2 6E04      00288         movwf   DATO_REG
1BB4 EC99 F00F 00289         call    W_REGISTER_1
               00290         
               00291         
               00292         ;STATUS
               00293         ;Status register clear
1BB8 0E07      00294         movlw   0x07                    
1BBA 6E03      00295         movwf   DIR_REG
1BBC 0E70      00296         movlw   b'01110000'
1BBE 6E04      00297         movwf   DATO_REG
1BC0 EC99 F00F 00298         call    W_REGISTER_1
               00299         
               00300         ;RX_PW_P0
               00301         ;Byte number in pipe0
1BC4 0E11      00302         movlw   0x11                    
1BC6 6E03      00303         movwf   DIR_REG
1BC8 0E01      00304         movlw   .1
1BCA 6E04      00305         movwf   DATO_REG
1BCC EC99 F00F 00306         call    W_REGISTER_1
               00307         
               00308         
               00309         ;RX_PW_P1
               00310         ;Byte number in pipe1
               00311         ;10 byte (Nº of the data, direction of the transsmisor and data).
1BD0 0E12      00312         movlw   0x12                    
1BD2 6E03      00313         movwf   DIR_REG
1BD4 0E0A      00314         movlw   .10
1BD6 6E04      00315         movwf   DATO_REG
1BD8 EC99 F00F 00316         call    W_REGISTER_1
               00317 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 47


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00318         ;RX_PW_P2
               00319         ;Byte number in pipe2
               00320         ;10 byte (Nº of the data, direction of the transsmisor and data).
1BDC 0E13      00321         movlw   0x13                    
1BDE 6E03      00322         movwf   DIR_REG
1BE0 0E0A      00323         movlw   .10
1BE2 6E04      00324         movwf   DATO_REG
1BE4 EC99 F00F 00325         call    W_REGISTER_1
               00326 
               00327 
               00328         ;RF_CH
               00329         ;Channel configuration
               00330         ;Channel chosen by the user (0x01 - 0x7F).
1BE8 0E05      00331         movlw   0x05                    
1BEA 6E03      00332         movwf   DIR_REG
1BEC 500C      00333         movf    RF_CHN,w
1BEE 0B7F      00334         andlw   b'01111111'
1BF0 6E04      00335         movwf   DATO_REG
1BF2 EC99 F00F 00336         call    W_REGISTER_1
               00337 
               00338         ; RF_CH
               00339         ;Check if the module is correcty initilized.
1BF6 0E05      00340         movlw   0x05                    
1BF8 6E03      00341         movwf   DIR_REG
1BFA EC6B F00F 00342         call    R_REGISTER_1
1BFE 9C08      00343         bcf             RF_STATUS,CONFIGOK
1C00 5004      00344         movf    DATO_REG,w
1C02 5C0C      00345         subwf   RF_CHN,W
1C04 010F      00346         banksel STATUS
1C06 A4D8      00347         btfss   STATUS,Z
1C08 EF08 F00E 00348         goto    BAD_CONFIG
1C0C 0100      00349         banksel RF_STATUS
1C0E 8C08      00350         bsf             RF_STATUS,CONFIGOK
1C10 00351 BAD_CONFIG
               00352 
               00353         ;If the interrupts were active, this function activates then. 
1C10 EC84 F010 00354         call    RF_INTER_RETURN
1C14 0100      00355         banksel INTER_RF
1C16 0012      00356         return
               00357 
               00358 ;*****************************************************
               00359 ;*                    RF_ON                              *
               00360 ;*****************************************************
               00361 ;*Descripción:Activate the module to send and receive*
               00362 ;*data.                                                                                          *
               00363 ;*****************************************************
               00364 ;*Input:                                                         *
               00365 ;*Output:                               - RF_STATUS,ONOK                         *
               00366 ;*****************************************************
1C18 00367 RF_ON
               00368         ;Interrupts disabled to avoid reentrancy
1C18 EC7C F010 00369         call    RF_INTER_CALL
               00370 
               00371         ;Clear RF_STATUS
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 48


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1C1C 0100      00372         banksel RF_STATUS
1C1E 6A08      00373         clrf    RF_STATUS
1C20 010F      00374         banksel PORTC
1C22 9887      00375         bcf             CE_PIN
               00376 
               00377         ; CONFIG
               00378         ;Activate RF module and put it into reception
               00379         ;The CRC is activated to use 2 bytes.
1C24 0100      00380         banksel DIR_REG
1C26 0E00      00381         movlw   0x00                    
1C28 6E03      00382         movwf   DIR_REG
1C2A 0E0F      00383         movlw   b'00001111'
1C2C 6E04      00384         movwf   DATO_REG
1C2E EC99 F00F 00385         call    W_REGISTER_1
               00386 
               00387         ; CONFIG
               00388         ;Check if the module is configured correctly.
1C32 0100      00389         banksel DIR_REG
1C34 0E00      00390         movlw   0x00                    
1C36 6E03      00391         movwf   DIR_REG
1C38 EC6B F00F 00392         call    R_REGISTER_1
1C3C 0100      00393         banksel RF_STATUS
1C3E 9808      00394         bcf             RF_STATUS,ONOK
1C40 5004      00395         movf    DATO_REG,w
1C42 080F      00396         sublw   b'00001111'
1C44 010F      00397         banksel STATUS
1C46 A4D8      00398         btfss   STATUS,Z
1C48 EF28 F00E 00399         goto    BAD_ON
1C4C 0100      00400         banksel RF_STATUS
1C4E 8808      00401         bsf             RF_STATUS,ONOK
1C50 00402 BAD_ON
1C50 ECA8 F010 00403         call    DELAY_2ms
1C54 010F      00404         banksel PORTC
1C56 8887      00405         bsf             CE_PIN
               00406 
1C58 ECB7 F010 00407         call    DELAY_150us
               00408 
               00409         ;If the interrupts were active, this function activates then. 
1C5C EC84 F010 00410         call    RF_INTER_RETURN
1C60 0100      00411         banksel INTER_RF
1C62 0012      00412         return
               00413 
               00414 ;*****************************************************
               00415 ;*                         RF_OFF                            *
               00416 ;*****************************************************
               00417 ;*Description: Switch off the RF module.
               00418 ;*****************************************************
               00419 ;*Input:                                                         *      
               00420 ;*Output: - RF_STATUS,OFFOK                                              *
               00421 ;*****************************************************
1C64 00422 RF_OFF
               00423         ;Interrupts disabled to avoid reentrancy
1C64 EC7C F010 00424         call    RF_INTER_CALL
1C68 010F      00425         banksel PORTC
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 49


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1C6A 9887      00426         bcf             CE_PIN
               00427 
               00428 
               00429         ;CONFIG
               00430         ;Switch off the module
1C6C 0E00      00431         movlw   0x00
1C6E 0100      00432         banksel DIR_REG                 
1C70 6E03      00433         movwf   DIR_REG
1C72 0E0C      00434         movlw   b'00001100'
1C74 6E04      00435         movwf   DATO_REG
1C76 EC99 F00F 00436         call    W_REGISTER_1
               00437 
               00438 
               00439         ; CONFIG
               00440         ;Check if everything is correct
1C7A 0E00      00441         movlw   0x00
1C7C 0100      00442         banksel DIR_REG                 
1C7E 6E03      00443         movwf   DIR_REG
1C80 EC6B F00F 00444         call    R_REGISTER_1
1C84 0100      00445         banksel RF_STATUS
1C86 9A08      00446         bcf             RF_STATUS,OFFOK
1C88 5004      00447         movf    DATO_REG,w
1C8A 080C      00448         sublw   b'00001100'
1C8C 010F      00449         banksel STATUS
1C8E A4D8      00450         btfss   STATUS,Z
1C90 EF4C F00E 00451         goto    BAD_OFF
1C94 0100      00452         banksel RF_STATUS
1C96 8A08      00453         bsf             RF_STATUS,OFFOK
1C98 00454 BAD_OFF
               00455 
               00456 
               00457         ;If the interrupts were active, this function activates then. 
1C98 EC84 F010 00458         call    RF_INTER_RETURN
1C9C 0100      00459         banksel RF_STATUS
1C9E 0012      00460         return
               00461 
               00462 ;*****************************************************
               00463 ;*                       RF_SEND                                 *
               00464 ;*****************************************************
               00465 ;*Description: This function sends 8 bytes of data   *
               00466 ;*to the user defined direction and inform if the    *
               00467 ;*data have been sent or not.                                            *
               00468 ;*****************************************************
               00469 ;*Input:                           - RF_DATA_OUT_0-RF_DATA_OUT_7 *
               00470 ;*                                         - RF_DIR_OUT                          *
               00471 ;*Output:                          - RF_STATUS,SNDOK                     *
               00472 ;*                     - RF_STATUS,ACK                           *
               00473 ;*****************************************************
1CA0 00474 RF_SEND
               00475 
               00476 
               00477         ;Start
1CA0 010F      00478         banksel PORTC
1CA2 9887      00479         bcf             CE_PIN
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 50


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00480 
               00481         ;STATUS
               00482         ;STATUS register clear
1CA4 0100      00483         banksel DIR_REG
1CA6 0E07      00484         movlw   0x07                    
1CA8 6E03      00485         movwf   DIR_REG
1CAA 0E70      00486         movlw   b'01110000'
1CAC 6E04      00487         movwf   DATO_REG
1CAE EC99 F00F 00488         call    W_REGISTER_1
               00489 
               00490 
               00491         ;EN_RXADDR
               00492         ;Pipe0 enable to receive the ACK
1CB2 0E02      00493         movlw   0x02                    
1CB4 6E03      00494         movwf   DIR_REG
1CB6 0E01      00495         movlw   b'00000001'
1CB8 6E04      00496         movwf   DATO_REG
1CBA EC99 F00F 00497         call    W_REGISTER_1
               00498         
               00499         
               00500         ;TX_ADDR
               00501         ;Configuration of the direction of the receiver:RF_DIR (User defined)
1CBE 0E10      00502         movlw   0x10                    
1CC0 6E03      00503         movwf   DIR_REG
1CC2 500E      00504         movf    RF_DIR_OUT,w
1CC4 6E04      00505         movwf   DATO_REG
1CC6 ECAF F00F 00506         call    W_REGISTER_5
               00507         
               00508 
               00509         ;RX_ADDR_P0
               00510         ;To receive the ACK the direction of the pipe0 has to be the equal to 
               00511         ;transmission direction.
1CCA 0E0A      00512         movlw   0x0A                    
1CCC 6E03      00513         movwf   DIR_REG
1CCE 500E      00514         movf    RF_DIR_OUT,w
1CD0 6E04      00515         movwf   DATO_REG
1CD2 ECAF F00F 00516         call    W_REGISTER_5
               00517         
               00518 
               00519         ;RX_ADDR_P1
               00520         ;The owun direction is packaged in the data string and this way
               00521         ;the receiver knows the direction of the transmiter.
1CD6 0E0B      00522         movlw   0x0B                    
1CD8 6E03      00523         movwf   DIR_REG
1CDA EC80 F00F 00524         call    R_REGISTER_5
               00525 
1CDE 5004      00526         movf    DATO_REG,w
1CE0 6E09      00527         movwf   DATO_DIR
               00528         
               00529         
               00530         ;W_TX_PAYLOAD
               00531         ;The data is sent to the output payload
1CE2 EC03 F010 00532         call    W_TX_PAYLOAD_10
               00533 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 51


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00534         ;Interrupts disabled to avoid reentrancy
1CE6 EC7C F010 00535         call    RF_INTER_CALL
               00536 
               00537         ;CONFIG
               00538         ;Transmission mode
1CEA 0E00      00539         movlw   0x00                    
1CEC 6E03      00540         movwf   DIR_REG
1CEE 0E0E      00541         movlw   b'00001110'
1CF0 6E04      00542         movwf   DATO_REG
1CF2 EC99 F00F 00543         call    W_REGISTER_1
               00544 
               00545 
               00546         ;Start sending signal
1CF6 010F      00547         banksel PORTC
1CF8 8887      00548         bsf             CE_PIN
1CFA ECC0 F010 00549         call    DELAY_15us
1CFE 010F      00550         banksel PORTC
1D00 9887      00551         bcf             CE_PIN
               00552         
1D02 0100      00553         banksel RF_NO_LOW
1D04 6A06      00554         clrf    RF_NO_LOW
1D06 6A05      00555         clrf    RF_NO_HIGH
               00556 
               00557 
               00558         ;If the module doesnt interrupt in 7ms the data wasnt sent.
1D08 00559 RF_SEND_loop
1D08 0100      00560         banksel RF_NO_LOW
1D0A 2A06      00561         incf    RF_NO_LOW,F
1D0C 010F      00562         banksel STATUS
1D0E B4D8      00563         btfsc   STATUS,Z
1D10 EF90 F00E 00564         goto    RF_SEND_cont
1D14 00565 RF_SEND_check_irq
1D14 010F      00566         banksel PORTB   
1D16 B081      00567         btfsc   IRQ_PIN
1D18 EF84 F00E 00568         goto    RF_SEND_loop
1D1C EF9A F00E 00569         goto    RF_SEND_seguir  
1D20 00570 RF_SEND_cont
1D20 0100      00571         banksel RF_NO_HIGH
1D22 2A05      00572         incf    RF_NO_HIGH,F
1D24 0E04      00573         movlw   .4
1D26 5C05      00574         subwf   RF_NO_HIGH,W
1D28 010F      00575         banksel STATUS
1D2A B0D8      00576         btfsc   STATUS,C
1D2C EFC1 F00E 00577         goto    RF_SEND_NO
1D30 EF8A F00E 00578         goto    RF_SEND_check_irq
               00579 
               00580 
1D34 00581 RF_SEND_seguir
               00582 
               00583         ;STATUS
               00584         ;Reading the status register to check the status.
1D34 0100      00585         banksel RF_STATUS
1D36 8008      00586         bsf             RF_STATUS,SNDOK
1D38 0E07      00587         movlw   0x07                    
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 52


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1D3A 6E03      00588         movwf   DIR_REG
1D3C 0E70      00589         movlw   b'01110000'
1D3E 6E04      00590         movwf   DATO_REG
1D40 EC99 F00F 00591         call    W_REGISTER_1
               00592 
1D44 B802      00593         btfsc   RF_ESTADO,4
1D46 EFC6 F00E 00594         goto    RF_SEND_NO_ACK
               00595 
1D4A BA02      00596         btfsc   RF_ESTADO,5
1D4C EFCA F00E 00597         goto    RF_SEND_ACK
               00598 
1D50 9208      00599         bcf             RF_STATUS,ACK
               00600 
1D52 00601 RF_SEND_fin
               00602 
               00603     ;TX_FLUSH
               00604         ;Flush output payload
1D52 EC3A F010 00605         call    FLUSH_TX        
               00606         
               00607         ;EN_RXADDR
               00608         ;Enable Pipe0,Pipe1 and Pipe2.
1D56 0E02      00609         movlw   0x02                    
1D58 6E03      00610         movwf   DIR_REG
1D5A 0E07      00611         movlw   b'00000111'
1D5C 6E04      00612         movwf   DATO_REG
1D5E EC99 F00F 00613         call    W_REGISTER_1
               00614 
               00615         ;CONFIG
               00616         ;Reception mode
1D62 0E00      00617         movlw   0x00                    
1D64 6E03      00618         movwf   DIR_REG
1D66 0E0F      00619         movlw   b'00001111'
1D68 6E04      00620         movwf   DATO_REG
1D6A EC99 F00F 00621         call    W_REGISTER_1
               00622 
               00623         ;End
1D6E 010F      00624         banksel PORTB
1D70 8887      00625         bsf             CE_PIN
               00626 
1D72 ECB7 F010 00627         call    DELAY_150us
1D76 010F      00628         banksel INTCON
1D78 92F2      00629         bcf             INTCON,INT0F
               00630         ;If the interrupts were active, this function activates then. 
1D7A EC84 F010 00631         call    RF_INTER_RETURN
1D7E 0100      00632         banksel RF_STATUS
1D80 0012      00633         return
               00634 
               00635         
               00636         ;If the module doesnt interrupt in 7ms the data wasnt sent.
1D82 00637 RF_SEND_NO
1D82 0100      00638         banksel RF_STATUS
1D84 9008      00639         bcf             RF_STATUS,SNDOK
1D86 9208      00640         bcf             RF_STATUS,ACK
1D88 EFA9 F00E 00641         goto    RF_SEND_fin
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 53


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00642         
               00643         ;estado
               00644         ;Check the status register to check if the data have been sent or not.
1D8C 00645 RF_SEND_NO_ACK
1D8C 0100      00646         banksel RF_STATUS
1D8E 9208      00647         bcf             RF_STATUS,ACK
1D90 EFA9 F00E 00648         goto    RF_SEND_fin
               00649 
1D94 00650 RF_SEND_ACK
1D94 0100      00651         banksel RF_STATUS
1D96 8208      00652         bsf             RF_STATUS,ACK
1D98 EFA9 F00E 00653         goto    RF_SEND_fin
               00654 
               00655 ;*****************************************************
               00656 ;*                     RF_RECEIVE                    *
               00657 ;*****************************************************
               00658 ;*Descripción: This routine checks if a data have    * 
               00659 ;*been received.                                                                 *
               00660 ;*****************************************************
               00661 ;*Input:                           -                             *
               00662 ;*Output:                          - RF_DATA_IN_0-RF_DATA_IN_7   *
               00663 ;*                         - RF_DIR_IN                                   *
               00664 ;*                         - RF_STATUS,RCVOK                     *
               00665 ;*                         - RF_STATUS,RCVNW                     *
               00666 ;*****************************************************
1D9C 00667 RF_RECEIVE
               00668 
               00669         ;Interrupts disabled to avoid reentrancy
1D9C EC7C F010 00670         call    RF_INTER_CALL
1DA0 010F      00671         banksel PORTB
1DA2 A081      00672         btfss   IRQ_PIN
1DA4 EFE6 F00E 00673         goto    RF_RECEIVE_DATA
               00674 
               00675         
               00676         ;FIFO_STATUS
               00677         ;Check the input FIFO
1DA8 0100      00678         banksel DIR_REG
1DAA 0E17      00679         movlw   0x17                    
1DAC 6E03      00680         movwf   DIR_REG
1DAE EC6B F00F 00681         call    R_REGISTER_1
               00682 
1DB2 B004      00683         btfsc   DATO_REG,0
1DB4 9608      00684         bcf             RF_STATUS,RCVNW
1DB6 A004      00685         btfss   DATO_REG,0      
1DB8 8608      00686         bsf             RF_STATUS,RCVNW
               00687 
1DBA B608      00688         btfsc   RF_STATUS,RCVNW
1DBC EFF1 F00E 00689         goto    RF_READ
1DC0 9408      00690         bcf             RF_STATUS,RCVOK
1DC2 9608      00691         bcf             RF_STATUS,RCVNW
               00692 
               00693         ;Interrupts disabled to avoid reentrancy
1DC4 EC84 F010 00694         call    RF_INTER_RETURN
1DC8 0100      00695         banksel RF_STATUS
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 54


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1DCA 0012      00696         return
               00697 
               00698 
1DCC 00699 RF_RECEIVE_DATA
1DCC 9408      00700         bcf             RF_STATUS,RCVOK
1DCE 9608      00701         bcf             RF_STATUS,RCVNW
               00702 
               00703         ;STATUS
               00704     ;Reading STATUS
1DD0 0E07      00705         movlw   0x07                    
1DD2 6E03      00706         movwf   DIR_REG
1DD4 EC6B F00F 00707         call    R_REGISTER_1
1DD8 5004      00708         movf    DATO_REG,w
1DDA 6E02      00709         movwf   RF_ESTADO
               00710 
               00711         ;estado
               00712         ;Check the receive interrupt.
1DDC AC02      00713         btfss   RF_ESTADO,6
1DDE EFF7 F00E 00714         goto    RF_RECEIVE_mal
               00715         
1DE2 00716 RF_READ
               00717      ;R_RX_PAYLOAD
               00718         ;Reading the received data.
1DE2 ECCE F00F 00719         call    R_RX_PAYLOAD_10
1DE6 5009      00720         movf    DATO_DIR,w
1DE8 6E17      00721         movwf   RF_DIR_IN
               00722         
1DEA EF0C F00F 00723         goto    RF_RECEIVE_bien
               00724 
1DEE 00725 RF_RECEIVE_mal
               00726 
               00727         ;STATUS
               00728     ;Reset and read STATUS
1DEE 0E07      00729         movlw   0x07            
1DF0 6E03      00730         movwf   DIR_REG
1DF2 0E70      00731         movlw   b'01110000'
1DF4 6E04      00732         movwf   DATO_REG
1DF6 EC99 F00F 00733         call    W_REGISTER_1
               00734 
               00735         ;FIFO_STATUS
               00736         ;Check the reception FIFO to see if more data have been received during this function
1DFA 0E17      00737         movlw   0x17                    
1DFC 6E03      00738         movwf   DIR_REG
1DFE EC6B F00F 00739         call    R_REGISTER_1
1E02 B004      00740         btfsc   DATO_REG,0
1E04 9608      00741         bcf             RF_STATUS,RCVNW
1E06 A004      00742         btfss   DATO_REG,0
1E08 8608      00743         bsf             RF_STATUS,RCVNW
1E0A 9408      00744         bcf             RF_STATUS,RCVOK
1E0C 010F      00745         banksel INTCON
1E0E 92F2      00746         bcf             INTCON,INT0F
               00747 
               00748         ;If the interrupts were active, this function activates then. 
1E10 EC84 F010 00749         call    RF_INTER_RETURN
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 55


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1E14 0100      00750         banksel RF_STATUS
1E16 0012      00751         return
               00752 
1E18 00753 RF_RECEIVE_bien
               00754 
               00755         ;STATUS
               00756     ;Read and check STATUS
1E18 0E07      00757         movlw   0x07            
1E1A 6E03      00758         movwf   DIR_REG
1E1C 0E70      00759         movlw   b'01110000'
1E1E 6E04      00760         movwf   DATO_REG
1E20 EC99 F00F 00761         call    W_REGISTER_1
               00762 
               00763         ;FIFO_STATUS
               00764         ;Check the reception FIFO to see if more data have been received during this function
1E24 0E17      00765         movlw   0x17                    
1E26 6E03      00766         movwf   DIR_REG
1E28 EC6B F00F 00767         call    R_REGISTER_1
               00768 
1E2C B004      00769         btfsc   DATO_REG,0
1E2E 9608      00770         bcf             RF_STATUS,RCVNW
1E30 A004      00771         btfss   DATO_REG,0
1E32 8608      00772         bsf             RF_STATUS,RCVNW
1E34 8408      00773         bsf             RF_STATUS,RCVOK
1E36 010F      00774         banksel INTCON
1E38 92F2      00775         bcf             INTCON,INT0F
               00776 
               00777         ;If the interrupts were active, this function activates then. 
1E3A EC84 F010 00778         call    RF_INTER_RETURN
1E3E 0100      00779         banksel RF_STATUS
1E40 0012      00780         return
               00781 
               00782 ;*****************************************************
               00783 ;*                   RF_RECEIVE_INT                  *
               00784 ;*****************************************************
               00785 ;*Descripción: This routine checks if a data have    * 
               00786 ;*been received in the interrupt routine                 *
               00787 ;*****************************************************
               00788 ;*Input:                           -                             *
               00789 ;*Output:                          - RF_DATA_IN_0-RF_DATA_IN_7   *
               00790 ;*                         - RF_DIR_IN                                   *
               00791 ;*                         - RF_STATUS,RCVOK                     *
               00792 ;*                         - RF_STATUS,RCVNW                     *
               00793 ;*****************************************************
1E42 00794 RF_RECEIVE_INT  
               00795         
1E42 010F      00796         banksel INTCON
1E44 B2F2      00797         btfsc   INTCON,INT0F
1E46 EF35 F00F 00798         goto    RF_RECEIVE_DATA_INT
               00799 
               00800 
               00801         ;FIFO_STATUS
               00802         ;Check the input FIFO
1E4A 0100      00803         banksel DIR_REG
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 56


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1E4C 0E17      00804         movlw   0x17                    
1E4E 6E03      00805         movwf   DIR_REG
1E50 EC6B F00F 00806         call    R_REGISTER_1
               00807 
1E54 B004      00808         btfsc   DATO_REG,0
1E56 9608      00809         bcf             RF_STATUS,RCVNW
1E58 A004      00810         btfss   DATO_REG,0
1E5A 8608      00811         bsf             RF_STATUS,RCVNW
               00812 
               00813 
1E5C B608      00814         btfsc   RF_STATUS,RCVNW
1E5E EF43 F00F 00815         goto    RF_READ_INT
1E62 9408      00816         bcf             RF_STATUS,RCVOK
1E64 9608      00817         bcf             RF_STATUS,RCVNW
1E66 0100      00818         banksel RF_STATUS
1E68 0012      00819         return
               00820 
1E6A 00821 RF_RECEIVE_DATA_INT
1E6A 9408      00822         bcf             RF_STATUS,RCVOK
1E6C 9608      00823         bcf             RF_STATUS,RCVNW
1E6E 010F      00824         banksel INTCON
1E70 92F2      00825         bcf             INTCON,INT0F
               00826 
               00827         ;STATUS
               00828     ;Read STATUS
1E72 0100      00829         banksel DIR_REG
1E74 0E07      00830         movlw   0x07                    
1E76 6E03      00831         movwf   DIR_REG
1E78 EC6B F00F 00832         call    R_REGISTER_1
1E7C 5004      00833         movf    DATO_REG,w
1E7E 6E02      00834         movwf   RF_ESTADO
               00835 
               00836         ;estado
               00837         ;Check interrupt
1E80 AC02      00838         btfss   RF_ESTADO,6
1E82 EF49 F00F 00839         goto    RF_RECEIVE_INT_mal      
               00840 
1E86 00841 RF_READ_INT
               00842     ;R_RX_PAYLOAD
               00843         ;Read received data.
1E86 ECCE F00F 00844         call    R_RX_PAYLOAD_10
1E8A 5009      00845         movf    DATO_DIR,w
1E8C 6E17      00846         movwf   RF_DIR_IN
               00847 
1E8E EF5A F00F 00848         goto    RF_RECEIVE_INT_bien
               00849 
1E92 00850 RF_RECEIVE_INT_mal
               00851 
               00852 
               00853         ;STATUS
               00854     ;Read and reset STATUS
1E92 0E07      00855         movlw   0x07            
1E94 6E03      00856         movwf   DIR_REG
1E96 0E70      00857         movlw   b'01110000'
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 57


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1E98 6E04      00858         movwf   DATO_REG
1E9A EC99 F00F 00859         call    W_REGISTER_1
               00860 
               00861         ;FIFO_STATUS
               00862         ;Check the reception FIFO to see if more data have been received during this function
1E9E 0E17      00863         movlw   0x17                    
1EA0 6E03      00864         movwf   DIR_REG
1EA2 EC6B F00F 00865         call    R_REGISTER_1
               00866 
1EA6 B004      00867         btfsc   DATO_REG,0
1EA8 9608      00868         bcf             RF_STATUS,RCVNW
1EAA A004      00869         btfss   DATO_REG,0
1EAC 8608      00870         bsf             RF_STATUS,RCVNW
1EAE 9408      00871         bcf             RF_STATUS,RCVOK
1EB0 0100      00872         banksel RF_STATUS
1EB2 0012      00873         return
               00874 
1EB4 00875 RF_RECEIVE_INT_bien
               00876 
               00877         ;STATUS
               00878     ;Read and reset STATUS
1EB4 0E07      00879         movlw   0x07            
1EB6 6E03      00880         movwf   DIR_REG
1EB8 0E70      00881         movlw   b'01110000'
1EBA 6E04      00882         movwf   DATO_REG
1EBC EC99 F00F 00883         call    W_REGISTER_1
               00884 
               00885 
               00886         ;FIFO_STATUS
               00887         ;Check the reception FIFO to see if more data have been received during this function
1EC0 0E17      00888         movlw   0x17                    
1EC2 6E03      00889         movwf   DIR_REG
1EC4 EC6B F00F 00890         call    R_REGISTER_1
               00891 
1EC8 B004      00892         btfsc   DATO_REG,0
1ECA 9608      00893         bcf             RF_STATUS,RCVNW
1ECC A004      00894         btfss   DATO_REG,0
1ECE 8608      00895         bsf             RF_STATUS,RCVNW
1ED0 8408      00896         bsf             RF_STATUS,RCVOK
1ED2 0100      00897         banksel RF_STATUS
1ED4 0012      00898         return
               00899 
               00900 
               00901 ;*********************************
               00902 ;*********************************
               00903 ;**     MODULE RF INSTRUCTIONS    **
               00904 ;*********************************
               00905 ;*********************************
               00906 
               00907 ;
               00908 ;*      Read 1 byte register
1ED6 00909 R_REGISTER_1
1ED6 0E00      00910         movlw   b'00000000'
1ED8 0100      00911         banksel DIR_REG
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 58


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1EDA 2403      00912         addwf   DIR_REG,W
1EDC 0100      00913         banksel BYTE_OUT
1EDE 6E01      00914         movwf   BYTE_OUT
1EE0 010F      00915         banksel PORTB
1EE2 9485      00916         bcf             CSN_PIN
1EE4 EC6E F010 00917         call    BYTE_SPI
1EE8 0100      00918         banksel BYTE_IN
1EEA 5000      00919         movf    BYTE_IN,w
1EEC 6E02      00920         movwf   RF_ESTADO
               00921 
1EEE EC6E F010 00922         call    BYTE_SPI        
1EF2 0100      00923         banksel BYTE_IN
1EF4 5000      00924         movf    BYTE_IN,w
1EF6 6E04      00925         movwf   DATO_REG
1EF8 010F      00926         banksel PORTB
1EFA 8485      00927         bsf             CSN_PIN
1EFC 0100      00928         banksel INTER_RF
1EFE 0012      00929         return
               00930 
               00931 
               00932 ;*      Read 5 byte register
1F00 00933 R_REGISTER_5
1F00 0E00      00934         movlw   b'00000000'
1F02 0100      00935         banksel DIR_REG
1F04 2403      00936         addwf   DIR_REG,W
1F06 6E01      00937         movwf   BYTE_OUT
1F08 010F      00938         banksel PORTB
1F0A 9485      00939         bcf             CSN_PIN
1F0C EC6E F010 00940         call    BYTE_SPI
1F10 5000      00941         movf    BYTE_IN,w
1F12 6E02      00942         movwf   RF_ESTADO
               00943 
1F14 EC6E F010 00944         call    BYTE_SPI
1F18 5000      00945         movf    BYTE_IN,w
1F1A 6E04      00946         movwf   DATO_REG
               00947 
1F1C EC6E F010 00948         call    BYTE_SPI
1F20 EC6E F010 00949         call    BYTE_SPI
1F24 EC6E F010 00950         call    BYTE_SPI
1F28 EC6E F010 00951         call    BYTE_SPI        
1F2C 010F      00952         banksel PORTB
1F2E 8485      00953         bsf             CSN_PIN
               00954 
1F30 0012      00955         return  
               00956 
               00957 
               00958 ;*      Write 1 byte register
1F32 00959 W_REGISTER_1
1F32 0E20      00960         movlw   b'00100000'
1F34 0100      00961         banksel DIR_REG
1F36 2403      00962         addwf   DIR_REG,W
1F38 0100      00963         banksel BYTE_OUT
1F3A 6E01      00964         movwf   BYTE_OUT
               00965 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 59


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1F3C 010F      00966         banksel PORTB
1F3E 9485      00967         bcf             CSN_PIN
1F40 EC6E F010 00968         call    BYTE_SPI
1F44 0100      00969         banksel BYTE_IN
1F46 5000      00970         movf    BYTE_IN,w
1F48 6E02      00971         movwf   RF_ESTADO
1F4A 0100      00972         banksel DATO_REG
1F4C 5004      00973         movf    DATO_REG,w
1F4E 0100      00974         banksel BYTE_OUT
1F50 6E01      00975         movwf   BYTE_OUT
1F52 EC6E F010 00976         call    BYTE_SPI
1F56 010F      00977         banksel PORTB
1F58 8485      00978         bsf             CSN_PIN
1F5A 0100      00979         banksel INTER_RF
1F5C 0012      00980         return
               00981 
               00982 ;*      Write 5 byte register
1F5E 00983 W_REGISTER_5
1F5E 0E20      00984         movlw   b'00100000'
1F60 0100      00985         banksel DIR_REG
1F62 2403      00986         addwf   DIR_REG,W
1F64 0100      00987         banksel BYTE_OUT
1F66 6E01      00988         movwf   BYTE_OUT
1F68 010F      00989         banksel PORTB
1F6A 9485      00990         bcf             CSN_PIN
               00991 
1F6C EC6E F010 00992         call    BYTE_SPI
1F70 0100      00993         banksel BYTE_IN
1F72 5000      00994         movf    BYTE_IN,w
1F74 6E02      00995         movwf   RF_ESTADO
               00996 
1F76 5004      00997         movf    DATO_REG,w
1F78 6E01      00998         movwf   BYTE_OUT
1F7A EC6E F010 00999         call    BYTE_SPI
               01000 
1F7E 0EC2      01001         movlw   0xC2
1F80 0100      01002         banksel BYTE_OUT
1F82 6E01      01003         movwf   BYTE_OUT
1F84 EC6E F010 01004         call    BYTE_SPI        
1F88 EC6E F010 01005         call    BYTE_SPI        
1F8C EC6E F010 01006         call    BYTE_SPI
1F90 EC6E F010 01007         call    BYTE_SPI
1F94 010F      01008         banksel PORTB
1F96 8485      01009         bsf             CSN_PIN
1F98 0100      01010         banksel INTER_RF
1F9A 0012      01011         return
               01012 
               01013 ;*      Read 10byte payload
1F9C 01014 R_RX_PAYLOAD_10
1F9C 0100      01015         banksel BYTE_OUT
1F9E 0E61      01016         movlw   b'01100001'
1FA0 6E01      01017         movwf   BYTE_OUT
               01018 
1FA2 010F      01019         banksel PORTB
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 60


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
1FA4 9485      01020         bcf             CSN_PIN
1FA6 EC6E F010 01021         call    BYTE_SPI
1FAA 5000      01022         movf    BYTE_IN,w
1FAC 6E02      01023         movwf   RF_ESTADO
               01024 
1FAE EC6E F010 01025         call    BYTE_SPI
1FB2 5000      01026         movf    BYTE_IN,w
1FB4 6E0B      01027         movwf   DATA_N_RCV
               01028 
1FB6 EC6E F010 01029         call    BYTE_SPI
1FBA 5000      01030         movf    BYTE_IN,w
1FBC 6E09      01031         movwf   DATO_DIR
               01032 
1FBE EC6E F010 01033         call    BYTE_SPI
1FC2 5000      01034         movf    BYTE_IN,w
1FC4 6E18      01035         movwf   RF_DATA_IN_0
               01036 
1FC6 EC6E F010 01037         call    BYTE_SPI
1FCA 5000      01038         movf    BYTE_IN,w
1FCC 6E19      01039         movwf   RF_DATA_IN_1
               01040 
1FCE EC6E F010 01041         call    BYTE_SPI
1FD2 5000      01042         movf    BYTE_IN,w
1FD4 6E1A      01043         movwf   RF_DATA_IN_2
               01044 
1FD6 EC6E F010 01045         call    BYTE_SPI
1FDA 5000      01046         movf    BYTE_IN,w
1FDC 6E1B      01047         movwf   RF_DATA_IN_3
               01048 
1FDE EC6E F010 01049         call    BYTE_SPI
1FE2 5000      01050         movf    BYTE_IN,w
1FE4 6E1C      01051         movwf   RF_DATA_IN_4
               01052 
1FE6 EC6E F010 01053         call    BYTE_SPI
1FEA 5000      01054         movf    BYTE_IN,w
1FEC 6E1D      01055         movwf   RF_DATA_IN_5
               01056 
1FEE EC6E F010 01057         call    BYTE_SPI
1FF2 5000      01058         movf    BYTE_IN,w
1FF4 6E1E      01059         movwf   RF_DATA_IN_6
               01060 
1FF6 EC6E F010 01061         call    BYTE_SPI
1FFA 5000      01062         movf    BYTE_IN,w
1FFC 6E1F      01063         movwf   RF_DATA_IN_7
1FFE 010F      01064         banksel PORTB
2000 8485      01065         bsf             CSN_PIN
2002 0100      01066         banksel INTER_RF
2004 0012      01067         return
               01068 ;*      Write 10byte payload
2006 01069 W_TX_PAYLOAD_10
2006 0100      01070         banksel BYTE_OUT
2008 0EA0      01071         movlw   b'10100000'
200A 6E01      01072         movwf   BYTE_OUT
               01073         
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 61


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
200C 010F      01074         banksel PORTB
200E 9485      01075         bcf             CSN_PIN
2010 0100      01076         banksel BYTE_OUT
2012 EC6E F010 01077         call    BYTE_SPI
2016 5000      01078         movf    BYTE_IN,w
2018 6E02      01079         movwf   RF_ESTADO
               01080 
201A 2A0A      01081         incf    DATA_N_SND,F
201C 500A      01082         movf    DATA_N_SND,w
201E 6E01      01083         movwf   BYTE_OUT
2020 EC6E F010 01084         call    BYTE_SPI
               01085 
2024 5009      01086         movf    DATO_DIR,w
2026 6E01      01087         movwf   BYTE_OUT
2028 EC6E F010 01088         call    BYTE_SPI
               01089 
202C 500F      01090         movf    RF_DATA_OUT_0,w
202E 6E01      01091         movwf   BYTE_OUT
2030 EC6E F010 01092         call    BYTE_SPI
               01093 
2034 5010      01094         movf    RF_DATA_OUT_1,w
2036 6E01      01095         movwf   BYTE_OUT
2038 EC6E F010 01096         call    BYTE_SPI
               01097 
203C 5011      01098         movf    RF_DATA_OUT_2,w
203E 6E01      01099         movwf   BYTE_OUT
2040 EC6E F010 01100         call    BYTE_SPI
               01101 
2044 5012      01102         movf    RF_DATA_OUT_3,w
2046 6E01      01103         movwf   BYTE_OUT
2048 EC6E F010 01104         call    BYTE_SPI
               01105 
204C 5013      01106         movf    RF_DATA_OUT_4,w
204E 6E01      01107         movwf   BYTE_OUT
2050 EC6E F010 01108         call    BYTE_SPI
               01109 
2054 5014      01110         movf    RF_DATA_OUT_5,w
2056 6E01      01111         movwf   BYTE_OUT
2058 EC6E F010 01112         call    BYTE_SPI
               01113 
205C 5015      01114         movf    RF_DATA_OUT_6,w
205E 6E01      01115         movwf   BYTE_OUT
2060 EC6E F010 01116         call    BYTE_SPI
               01117 
2064 5016      01118         movf    RF_DATA_OUT_7,w
2066 6E01      01119         movwf   BYTE_OUT
2068 EC6E F010 01120         call    BYTE_SPI
206C 010F      01121         banksel PORTB
206E 8485      01122         bsf             CSN_PIN
2070 0100      01123         banksel INTER_RF
2072 0012      01124         return
               01125 
               01126 ;*      Flush tx payload
2074 01127 FLUSH_TX
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 62


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
2074 0EE1      01128         movlw   b'11100001'
2076 0100      01129         banksel BYTE_OUT
2078 6E01      01130         movwf   BYTE_OUT
207A 010F      01131         banksel PORTB
207C 9485      01132         bcf             CSN_PIN
207E EC6E F010 01133         call    BYTE_SPI
2082 5000      01134         movf    BYTE_IN,w
2084 6E02      01135         movwf   RF_ESTADO
2086 010F      01136         banksel PORTB
2088 8485      01137         bsf             CSN_PIN
208A 0100      01138         banksel INTER_RF
208C 0012      01139         return
               01140 
               01141 ;*      Flush rx payload
208E 01142 FLUSH_RX
208E 0EE2      01143         movlw   b'11100010'
2090 0100      01144         banksel BYTE_OUT
2092 6E01      01145         movwf   BYTE_OUT
               01146 
2094 010F      01147         banksel PORTB
2096 9485      01148         bcf             CSN_PIN
2098 EC6E F010 01149         call    BYTE_SPI
209C 5000      01150         movf    BYTE_IN,w
209E 6E02      01151         movwf   RF_ESTADO
20A0 010F      01152         banksel PORTB
20A2 8485      01153         bsf             CSN_PIN
20A4 0100      01154         banksel INTER_RF
20A6 0012      01155         return
               01156 
               01157 ;*      Reuse tx payload
20A8 01158 REUSE_TX_PL
20A8 0EE3      01159         movlw   b'11100011'
20AA 0100      01160         banksel BYTE_OUT
20AC 6E01      01161         movwf   BYTE_OUT
20AE 010F      01162         banksel PORTB
20B0 9485      01163         bcf             CSN_PIN
20B2 EC6E F010 01164         call    BYTE_SPI
20B6 5000      01165         movf    BYTE_IN,w
20B8 6E02      01166         movwf   RF_ESTADO
20BA 010F      01167         banksel PORTB
20BC 8485      01168         bsf             CSN_PIN
20BE 0100      01169         banksel INTER_RF
20C0 0012      01170         return
               01171 
               01172 ;*      Lee el registro STATUS (nop)
20C2 01173 R_STATUS
20C2 0EFF      01174         movlw   b'11111111'
20C4 0100      01175         banksel BYTE_OUT
20C6 6E01      01176         movwf   BYTE_OUT
20C8 010F      01177         banksel PORTB
20CA 9485      01178         bcf             CSN_PIN
20CC EC6E F010 01179         call    BYTE_SPI
20D0 5000      01180         movf    BYTE_IN,w
20D2 6E02      01181         movwf   RF_ESTADO
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 63


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
20D4 010F      01182         banksel PORTB
20D6 8485      01183         bsf             CSN_PIN
20D8 0100      01184         banksel INTER_RF
20DA 0012      01185         return
               01186 
               01187 
               01188 ;*********************
               01189 ;*********************
               01190 ;**     FUNCIONES SPI   **
               01191 ;*********************
               01192 ;*********************
               01193 
20DC 01194 BYTE_SPI
20DC 0100      01195         banksel BYTE_OUT
20DE 5001      01196         movf    BYTE_OUT,w
20E0 010F      01197         banksel SSP1BUF
20E2 6EC9      01198         movwf   SSP1BUF                 ;Load send data
20E4 010F      01199         banksel SSP1STAT
20E6 01200 SPI_continuar
20E6 A0C7      01201         btfss   SSP1STAT,BF
20E8 EF73 F010 01202         goto    SPI_continuar   ;Wait
20EC 010F      01203         banksel SSP1BUF
20EE 50C9      01204         movf    SSP1BUF,w
20F0 0100      01205         banksel BYTE_IN 
20F2 6E00      01206         movwf   BYTE_IN                 ;Store received data
20F4 0100      01207         banksel INTER_RF
20F6 0012      01208         return
               01209 
               01210 ;************************************************
               01211 ;*RF_INTER_CALL:Check if the interrupts are active
               01212 ;* or not. 
               01213 ;************************************************
               01214 
20F8 01215 RF_INTER_CALL
               01216 
20F8 010F      01217         banksel INTCON
20FA 50F2      01218         movf    INTCON,w
20FC 0100      01219         banksel INTER_RF
20FE 6E07      01220         movwf   INTER_RF
2100 010F      01221         banksel INTCON
2102 9EF2      01222         bcf             INTCON,GIE
2104 0100      01223         banksel INTER_RF
2106 0012      01224         return
               01225         
               01226 
               01227 ;*************************************************
               01228 ;*RF_INTER_RETURN:Check if the interrupts were active
               01229 ;* or not and restore the situation.
               01230 ;*************************************************
               01231 
2108 01232 RF_INTER_RETURN
2108 0100      01233         banksel INTER_RF
210A 5007      01234         movf    INTER_RF,w
210C BE07      01235         btfsc   INTER_RF,7      
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 64


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
210E EF8B F010 01236         goto    RF_GIE_UNO
2112 EF8F F010 01237         goto    RF_GIE_CERO
               01238 
2116 01239 RF_GIE_UNO
2116 010F      01240         banksel INTCON
2118 8EF2      01241         bsf             INTCON,GIE
211A 0100      01242         banksel INTER_RF
211C 0012      01243         return
211E 01244 RF_GIE_CERO
211E 010F      01245         banksel INTCON
2120 9EF2      01246         bcf             INTCON,GIE
2122 0100      01247         banksel INTER_RF
2124 0012      01248         return
               01249 
               01250 ;*****************************
               01251 ;*****************************
               01252 ;**     AUXILIAR FUNCTIONS              **
               01253 ;*****************************
               01254 ;*****************************
               01255 
               01256 ;*      Temporizaciones varias
2126 01257 DELAY_1s        
2126 0100      01258                         banksel         PDel0   
2128 0E0E      01259                         movlw           .14       
212A 6E20      01260                 movwf           PDel0     
212C 0E48      01261 PLoop0          movlw           .72       
212E 6E21      01262                 movwf           PDel1     
2130 0EF7      01263 PLoop1          movlw           .247      
2132 6E22      01264                 movwf           PDel2     
2134 0000      01265 PLoop2          nop                       
2136 2E22      01266                 decfsz          PDel2, 1  
2138 EF9A F010 01267                 goto            PLoop2    
213C 2E21      01268                 decfsz          PDel1, 1  
213E EF98 F010 01269                 goto            PLoop1    
2142 2E20      01270                 decfsz          PDel0, 1  
2144 EF96 F010 01271                 goto            PLoop0    
2148 EFA6 F010 01272 PDelL1          goto            PDelL2    
214C 0000      01273 PDelL2          nop                
214E 0012      01274                 return                
               01275 
               01276 
2150 01277 DELAY_2ms       
2150 0100      01278                         banksel         PDel0           
2152 0EF9      01279                         movlw           .249      
2154 6E20      01280                 movwf           PDel0     
2156 0000      01281 PLoop0_         nop                
2158 EFAE F010 01282 PDelL1_         goto            PDelL2_   
215C EFB0 F010 01283 PDelL2_         goto            PDelL3_   
2160 01284 PDelL3_  
2160 2E20      01285                 decfsz          PDel0, 1  
2162 EFAB F010 01286                 goto            PLoop0_   
2166 EFB5 F010 01287 PDelL4_         goto            PDelL5_   
216A 0000      01288 PDelL5_         nop               
216C 0012      01289                 return                
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 65


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01290 
               01291 
216E 01292 DELAY_150us 
216E 0100      01293                         banksel         PDel0           
2170 0E24      01294                         movlw     .36       
2172 6E20      01295                 movwf     PDel0     
2174 0000      01296 PLoop0__        nop              
2176 2E20      01297                 decfsz    PDel0, 1  
2178 EFBA F010 01298                 goto      PLoop0__  
217C 0000      01299                 nop              
217E 0012      01300                 return              
               01301 
               01302 
2180 01303 DELAY_15us  
2180 0100      01304                         banksel         PDel0   
2182 0E02      01305                         movlw     .2        
2184 6E20      01306                 movwf     PDel0         
2186 0000      01307 PLoop0___       nop                     
2188 2E20      01308                 decfsz    PDel0, 1  
218A EFC3 F010 01309                 goto      PLoop0___
218E EFC9 F010 01310 PDelL1___       goto      PDelL2___ 
2192 01311 PDelL2___  
2192 0012      01312                 return             
               00028   #include "inc\lib_mot_moway_GUI.inc"
               00001 ;********************************************************************************
               00002 ;*    lib_mot_moway.inc                                                         *
               00003 ;*    version: 2.0                                                              *
               00004 ;*    Esta librería contiene las funciones necesarias para gestionar el módulo  *
               00005 ;*    motor del robot Moway con programas en ensamblado                         *
               00006 ;*    Copyright (C) 2007  Bizintek Innova S.L.                                  *
               00007 ;********************************************************************************
               00008 ;*    This program is free software; you can redistribute it and/or modify      *
               00009 ;*    it under the terms of the GNU General Public License as published by      *
               00010 ;*    the Free Software Foundation; either version 2 of the License, or         *
               00011 ;*    (at your option) any later version.                                       *
               00012 ;*                                                                              *
               00013 ;*    This program is distributed in the hope that it will be useful,           *
               00014 ;*    but WITHOUT ANY WARRANTY; without even the implied warranty of            *
               00015 ;*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the             *
               00016 ;*    GNU General Public License for more details.                              *
               00017 ;*                                                                              *
               00018 ;*    You should have received a copy of the GNU General Public License along   *
               00019 ;*    with this program; if not, write to the Free Software Foundation, Inc.,   *
               00020 ;*    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.               *
               00021 ;********************************************************************************
               00022 
               00023 ;Elimina los warning de cambio de banco
               00024  ERRORLEVEL -302 
               00025 
               00026 ;********************
               00027 ;*      DEFINICIONES    *
               00028 ;********************
               00029 
               00030 ;*****************************
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 66


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00031 ;*Configuracion del patillaje*
               00032 ;*****************************
               00033 
               00034         ;PORTC
2194 00035 #define         SDA_SOFT                PORTE,1
2194 00036 #define         SCL_SOFT                PORTE,0 
               00037 
               00038         ;PORTE
2194 00039 #define         MOT_END_TRIS    TRISE,7
               00040 
               00041         ;TRISC
2194 00042 #define         SDA_TRIS                TRISE,1 
2194 00043 #define         SCL_TRIS                TRISE,0
               00044 
               00045 
               00046         ;TRISE
2194 00047 #define         MOT_END                 PORTE,7
               00048 
               00049 ;*****************
               00050 ;*Variables fijas*
               00051 ;*****************
               00052 
               00053 ;Dirección del motor
2194 00054 #define   MOT_DIR_M               0x10
               00055 
               00056 
               00057 
               00058 
               00059 ;Comandos
               00060 ;Byte MOT_COMAND                nºbit     7   6   5   4   3   2   1   0
               00061 ;                                       --------------------------------
               00062 ;Comandos movimientos
2194 00063 #define   COM_STR         0x00   ;       "0   0   0   0   0   0   CT  RL"
2194 00064 #define   COM_CHA_VEL     0x01   ;       "0   0   0   0   0   1   CT  RL"
2194 00065 #define   COM_ROT         0x02   ;       "0   0   0   0   1   0   CT  RL"
2194 00066 #define   COM_CUR         0x03   ;       "0   0   0   0   1   1   CT  RL"
2194 00067 #define   COM_STOP        0x04   ;       "0   0   0   1   0   0   CT  RL"
               00068 
               00069 ;Comandos información
2194 00070 #define   STATUS_T        0x00   ;       "1   0   0   0   0   0   0   0 "
2194 00071 #define   STATUS_A        0x01   ;       "1   0   0   0   0   0   0   1 "
2194 00072 #define   STATUS_V_R      0x02   ;       "1   0   0   0   0   0   1   0 "
2194 00073 #define   STATUS_V_L      0x03   ;       "1   0   0   0   0   0   1   1 "
2194 00074 #define   STATUS_D_R      0x04   ;       "1   0   0   0   0   1   0   0 "
2194 00075 #define   STATUS_D_L      0x05   ;       "1   0   0   0   0   1   0   1 "
2194 00076 #define   STATUS_KM       0x06   ;       "1   0   0   0   0   1   1   0 "
               00077 
               00078 ;Comandos reset
2194 00079 #define   RST_T           0x00   ;       "1   1   1   1   0   0   0   0 "
2194 00080 #define   RST_D           0x01   ;       "1   1   1   1   0   0   0   1 "
2194 00081 #define   RST_KM          0x02   ;       "1   1   1   1   0   0   1   0 "
               00082 
               00083 
               00084 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 67


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00085 
               00086 
               00087 
               00088 
               00089 ;* Variable MOT_STATUS                                  ;Estado del comando
2194 00090 #define   COMOK                         0                       ;Comando correcto (1) o incorrecto (0)
2194 00091 #define   DWRONG                        1               ;Datos incorrectos (1) o correctos (0)          
               00092 
               00093 ;  Variable MOT_CON                                     ;Registro de control de motores
2194 00094 #define   FWDBACK                       0                       ;Comando hacia adelante (1) o hacia atras (0)           
2194 00095 #define   RL                            1                       ;Comando derecha (1) o izquierda (0)
2194 00096 #define   COMTYPE                   2                   ;Comando de tiempo (1) o, de distancia o angulo (0)
               00097 
               00098 ;* Variable FLAGS_MOT                                   ;Registro interno
2194 00099 #define   DIR_M                         0                       
2194 00100 #define   COM                           1       
2194 00101 #define   DAT1                          2
2194 00102 #define   DAT2                          3
2194 00103 #define   DAT3                          4
2194 00104 #define   NO_ACK_INTENTO        5
               00105 
               00106 
               00107 ;****************
               00108 ;*      VARIABLES       *
               00109 ;****************
               00110 
               00111 ;* Variables usuario
               00112         cblock  
               00113         MOT_STATUS                                              ;Estado del comando
               00114         MOT_VEL                                                 ;Velocidad deseada
               00115         MOT_T_DIST_ANG                                  ;Tiempo-Distancia-Angulo dependiendo de COMTYPE y la función 
               00116         MOT_CENWHEEL                                    ;Rotar sobre el centro o una de las ruedas
               00117         MOT_RAD                                                 ;Radio de curvatura
               00118         MOT_CON                                         ;Registro de control de motores
               00119         MOT_RST_COM                                             ;Comando reset
               00120         MOT_STATUS_COM                                  ;Comando status
               00121         MOT_STATUS_DATA_1                               ;Segundo dato leido por el comando MOT_STAT (Valido cuando se lee el cuentakilometros, sino 0xFF)
               00122         MOT_STATUS_DATA_0                               ;Primer dato leido por el comando MOT_STAT
               00123 
               00124         ;Variable MOT internas
               00125         MOT_COMAND                              
               00126         FLAGS_MOT                               
               00127         INTENTOS                        
               00128         INTER_MOT                               
               00129         MOT_DATA_0                              
               00130         MOT_DATA_1                              
               00131         MOT_DATA_2                              
               00132         MOT_DATA_3                      
               00133 
               00134         ;* Variables de las funciones de bajo nivel
               00135         I_BYTE                                          
               00136         O_BYTE                                          
               00137         _N      
               00138         CAL_TEMP0
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 68


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00139         CAL_TEMP1       
               00140         endc    
               00141 
               00142 
               00143 ;************
               00144 ;*      CÓDIGO  *
               00145 ;************
               00146 
               00147 
               00148 ;*****************************************************
               00149 ;*                   MOT_CONFIG                      *
               00150 ;*****************************************************
               00151 ;*Descripción:Esta función se encarga de configurar  *
               00152 ;*el PIC para que puede comunicarse con el módulo    *
               00153 ;*motor                                              *
               00154 ;*****************************************************
               00155 ;*Variables de entrada:                              *
               00156 ;*Variables de salida:                               *
               00157 ;*****************************************************
               00158 
2194 00159 MOT_CONFIG
2194 EC0E F013 00160         call    MOT_INIT
2198 010F      00161         banksel TRISC
219A 8296      00162         bsf             SDA_TRIS
219C 8096      00163         bsf             SCL_TRIS
219E 010F      00164         banksel TRISE
21A0 8E96      00165         bsf             MOT_END_TRIS
21A2 010F      00166         banksel PORTH
21A4 9284      00167         bcf             SDA_SOFT
21A6 9084      00168         bcf             SCL_SOFT
               00169         
21A8 0100      00170         banksel MOT_STATUS
               00171 ;Inicialización de variables
21AA 6A24      00172         clrf    MOT_VEL                                 
21AC 6A25      00173         clrf    MOT_T_DIST_ANG                  
21AE 6A26      00174         clrf    MOT_CENWHEEL            
21B0 6A27      00175         clrf    MOT_RAD                         
21B2 6A28      00176         clrf    MOT_CON                           
21B4 6A29      00177         clrf    MOT_RST_COM                     
21B6 6A2A      00178         clrf    MOT_STATUS_COM                  
21B8 6A2B      00179         clrf    MOT_STATUS_DATA_1               
21BA 6A2C      00180         clrf    MOT_STATUS_DATA_0               
21BC 6A2D      00181         clrf    MOT_COMAND                      
21BE 6A2E      00182         clrf    FLAGS_MOT                               
21C0 6A2F      00183         clrf    INTENTOS                                
21C2 6A30      00184         clrf    INTER_MOT                               
21C4 6A31      00185         clrf    MOT_DATA_0                              
21C6 6A32      00186         clrf    MOT_DATA_1                              
21C8 6A33      00187         clrf    MOT_DATA_2                                      
21CA 6A34      00188         clrf    MOT_DATA_3                              
21CC 6A35      00189         clrf    I_BYTE                                                  
21CE 6A36      00190         clrf    O_BYTE                                                  
21D0 6A37      00191         clrf    _N                      
21D2 EF17 F013 00192         goto    MOT_FIN
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 69


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00193 ;*****************************************************  
               00194 
               00195 
               00196 
               00197 
               00198 
               00199 
               00200 ;*****************************************************
               00201 ;*                                       MOT_STR                              *
               00202 ;*****************************************************
               00203 ;*Descripción: Comando para ir recto. Hay que        *
               00204 ;*especificar velocidad, sentido, tipo de comando y  *
               00205 ;*el tiempo o la distancia a recorrer                *
               00206 ;*****************************************************
               00207 ;*Variables de entrada:- MOT_VEL   : 0  - 100        *
               00208 ;*                                         - MOT_CON:                                    *
               00209 ;*                       - FWDBACK : Adelante   (1)  * 
               00210 ;*                                                                       Atras      (0)  *
               00211 ;*                       - COMTYPE : Tiempo         (1)  *
               00212 ;*                                                                       Distancia  (0)  *   
               00213 ;*                     - MOT_T_DIST_ANG: 0  - 255        *
               00214 ;*Variables de salida:                               *
               00215 ;*Salida:              - MOT_STATUS:                     *
               00216 ;*                       - COMOK   : Enviado    (1)      *
               00217 ;*                                                                       No enviado (0)  *
               00218 ;*                       - DWRONG  : Datos no OK(1)  *
               00219 ;*                                                                   Datos OK   (0)  *
               00220 ;*****************************************************
               00221 
21D6 00222 MOT_STR
21D6 EC0E F013 00223         call    MOT_INIT
               00224 
               00225     ;Comprobación de datos correctos
               00226 
               00227     ;Velocidad debe estar entre 0 y 100
21DA 5024      00228         movf    MOT_VEL,W
21DC 0F9B      00229         addlw   .155                                                    
21DE 0F65      00230         addlw   .101
21E0 010F      00231         banksel STATUS
21E2 B0D8      00232         btfsc   STATUS,C
21E4 EFF8 F010 00233         goto    MOT_STR_CONT_01
21E8 0100      00234         banksel MOT_STATUS
21EA 8223      00235         bsf             MOT_STATUS,DWRONG
21EC EF17 F013 00236         goto    MOT_FIN
               00237 
21F0 00238 MOT_STR_CONT_01
               00239         ;Preparación de datos para ser mandados por I2C
21F0 0100      00240         banksel MOT_STATUS
               00241     ;El comando a mandar es COM_STR (0x00)
21F2 0E00      00242         movlw   COM_STR
21F4 6E2D      00243         movwf   MOT_COMAND
               00244 
               00245         ;Se mandan COMTYPE en el mismo byte de MOT_COMAND
21F6 010F      00246         banksel STATUS
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 70


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
21F8 90D8      00247         bcf             STATUS,C
21FA 0100      00248         banksel MOT_CON
21FC A428      00249         btfss   MOT_CON,COMTYPE
21FE EF03 F011 00250         goto    MOT_STR_CONT_02
2202 010F      00251         banksel STATUS
2204 80D8      00252         bsf             STATUS,C
2206 00253 MOT_STR_CONT_02
2206 0100      00254         banksel MOT_COMAND
2208 362D      00255         rlcf    MOT_COMAND,F
               00256 
               00257         ;Se mandan RL en el mismo byte de MOT_COMAND
220A 010F      00258         banksel STATUS
220C 90D8      00259         bcf             STATUS,C        
220E 0100      00260         banksel MOT_COMAND
2210 362D      00261         rlcf    MOT_COMAND,F
2212 502D      00262         movf    MOT_COMAND,W
2214 6E31      00263         movwf   MOT_DATA_0
               00264 
               00265         ;En LSB de velocidad se empaquetara el sentido
2216 010F      00266         banksel STATUS
2218 90D8      00267         bcf             STATUS,C
221A 0100      00268         banksel MOT_CON
221C A028      00269         btfss   MOT_CON,FWDBACK 
221E EF13 F011 00270         goto    MOT_STR_CONT_03
2222 010F      00271         banksel STATUS
2224 80D8      00272         bsf             STATUS,C
2226 00273 MOT_STR_CONT_03
2226 0100      00274         banksel MOT_VEL
2228 3424      00275         rlcf    MOT_VEL,W
222A 6E32      00276         movwf   MOT_DATA_1      
               00277 
222C 5025      00278         movf    MOT_T_DIST_ANG,W
222E 6E33      00279         movwf   MOT_DATA_2
               00280 
               00281         ;Se mandan los datos (MOT_DATA) por I2C que 
               00282         ;anteriormente han sido actualizados
2230 ECB5 F012 00283         call    MOT_SND_I2C_3D
2234 ECE1 F013 00284         call    STOP
               00285 
2238 010F      00286         banksel STATUS
223A B4D8      00287         btfsc   STATUS,Z
223C EF17 F013 00288         goto    MOT_FIN
2240 0100      00289         banksel MOT_STATUS
2242 9023      00290         bcf             MOT_STATUS,COMOK
2244 EF17 F013 00291         goto    MOT_FIN 
               00292 
               00293         
               00294 ;*****************************************************
               00295 
               00296 
               00297 
               00298 
               00299 
               00300 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 71


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00301 ;*****************************************************
               00302 ;*                           MOT_CHA_VEL                         *
               00303 ;*****************************************************
               00304 ;*Descripción: Comando para cambiar la velocidad de  *
               00305 ;*uno de los motores. Para ello hay que especificar  *
               00306 ;*velocidad, sentido, motor izquierdo o derecho,tipo *
               00307 ;*de comando y el tiempo o la distancia a recorrer.  *
               00308 ;*****************************************************
               00309 ;*Variables de entrada:- MOT_VEL   : 0  - 100        *
               00310 ;*                                         - MOT_CON:                                    *
               00311 ;*                       - FWDBACK : Adelante   (1)  * 
               00312 ;*                                                                       Atras      (0)  *
               00313 ;*                                               - RL      : Derecha    (1)      *
               00314 ;*                                                                 : Izquierda  (0)  *
               00315 ;*                       - COMTYPE : Tiempo         (1)  *
               00316 ;*                                                                       Distancia  (0)  *   
               00317 ;*                     - MOT_T_DIST_ANG: 0  - 255        *
               00318 ;*Variables de salida:                               *
               00319 ;*Salida:              - MOT_STATUS:                 *
               00320 ;*                       - COMOK   : Enviado    (1)      *
               00321 ;*                                                                       No enviado (0)  *
               00322 ;*                       - DWRONG  : Datos no OK(1)  *
               00323 ;*                                                                   Datos OK   (0)  *
               00324 ;*****************************************************
               00325 
2248 00326 MOT_CHA_VEL
2248 EC0E F013 00327         call    MOT_INIT
               00328 
               00329     ;Comprobación de datos correctos
               00330 
               00331     ;Velocidad debe estar entre 0 y 100
224C 5024      00332         movf    MOT_VEL,W
224E 0F9B      00333         addlw   .155                                                    
2250 0F65      00334         addlw   .101
2252 010F      00335         banksel STATUS
2254 B0D8      00336         btfsc   STATUS,C
2256 EF31 F011 00337         goto    MOT_CHA_VEL_CONT_01
225A 0100      00338         banksel MOT_STATUS
225C 8223      00339         bsf             MOT_STATUS,DWRONG
225E EF17 F013 00340         goto    MOT_FIN
2262 00341 MOT_CHA_VEL_CONT_01
               00342         ;Preparación de datos para ser mandados por I2C
               00343 
               00344     ;El comando a mandar es COM_CHA_VEL (0x01)
2262 0100      00345         banksel MOT_COMAND
2264 0E01      00346         movlw   COM_CHA_VEL
2266 6E2D      00347         movwf   MOT_COMAND
               00348 
               00349         ;Se mandan COMTYPE en el mismo byte de MOT_COMAND
2268 010F      00350         banksel STATUS
226A 90D8      00351         bcf             STATUS,C
226C 0100      00352         banksel MOT_CON
226E A428      00353         btfss   MOT_CON,COMTYPE
2270 EF3C F011 00354         goto    MOT_CHA_VEL_CONT_02
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 72


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
2274 010F      00355         banksel STATUS
2276 80D8      00356         bsf             STATUS,C
2278 00357 MOT_CHA_VEL_CONT_02
2278 0100      00358         banksel MOT_COMAND
227A 362D      00359         rlcf    MOT_COMAND,F
227C 010F      00360         banksel STATUS
               00361         ;Se mandan RL en el mismo byte de MOT_COMAND
227E 90D8      00362         bcf             STATUS,C
2280 0100      00363         banksel MOT_CON 
2282 A228      00364         btfss   MOT_CON,RL
2284 EF46 F011 00365         goto    MOT_CHA_VEL_CONT_03     
2288 010F      00366         banksel STATUS
228A 80D8      00367         bsf             STATUS,C
228C 00368 MOT_CHA_VEL_CONT_03
228C 0100      00369         banksel MOT_COMAND      
228E 362D      00370         rlcf    MOT_COMAND,F
2290 502D      00371         movf    MOT_COMAND,W
2292 6E31      00372         movwf   MOT_DATA_0
               00373 
               00374         ;En LSB de velocidad se empaquetara el sentido
2294 010F      00375         banksel STATUS
2296 90D8      00376         bcf             STATUS,C
2298 0100      00377         banksel MOT_CON
229A A028      00378         btfss   MOT_CON,FWDBACK 
229C EF52 F011 00379         goto    MOT_CHA_VEL_CONT_04
22A0 010F      00380         banksel STATUS
22A2 80D8      00381         bsf             STATUS,C
22A4 00382 MOT_CHA_VEL_CONT_04
22A4 0100      00383         banksel MOT_VEL
22A6 3424      00384         rlcf    MOT_VEL,W
22A8 6E32      00385         movwf   MOT_DATA_1
               00386 
22AA 5025      00387         movf    MOT_T_DIST_ANG,W
22AC 6E33      00388         movwf   MOT_DATA_2
               00389 
               00390         ;Se mandan los datos (MOT_DATA) por I2C que 
               00391         ;anteriormente han sido actualizados
22AE ECB5 F012 00392         call    MOT_SND_I2C_3D
22B2 ECE1 F013 00393         call    STOP
               00394 
22B6 010F      00395         banksel STATUS
22B8 B4D8      00396         btfsc   STATUS,Z
22BA EF17 F013 00397         goto    MOT_FIN
22BE 0100      00398         banksel MOT_STATUS
22C0 9023      00399         bcf             MOT_STATUS,COMOK
22C2 EF17 F013 00400         goto    MOT_FIN 
               00401 ;*****************************************************
               00402 
               00403 
               00404 
               00405 
               00406 
               00407 
               00408 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 73


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00409 ;*****************************************************
               00410 ;*                             MOT_ROT                           *
               00411 ;*****************************************************
               00412 ;*Descripción: Comando para rotar. Para ello hay que *
               00413 ;*especificar velocidad, sentido, rotación           *
               00414 ;*respecto al centro o a la rueda,tipo de comando y  *
               00415 ;*el tiempo o el angulo a recorrer                   *
               00416 ;*****************************************************
               00417 ;*Variables de entrada:- MOT_VEL   : 0  - 100        *
               00418 ;*                                         - MOT_CON:                                    *
               00419 ;*                       - FWDBACK : Adelante   (1)  * 
               00420 ;*                                                                       Atras      (0)  *
               00421 ;*                                               - RL      : Derecha    (1)      *
               00422 ;*                                                                 : Izquierda  (0)  *
               00423 ;*                       - COMTYPE : Tiempo         (1)  *
               00424 ;*                                                                       Distancia  (0)  *
               00425 ;*                                         - MOT_CENWHEEL: Centro  (0x01)*
               00426 ;*                                                                         Rueda   (0x00)*
               00427 ;*                     - MOT_T_DIST_ANG: 0  - 255        *
               00428 ;*Variables de salida:                               *
               00429 ;*Salida:              - MOT_STATUS:                 *
               00430 ;*                       - COMOK   : Enviado    (1)      *
               00431 ;*                                                                       No enviado (0)  *
               00432 ;*                       - DWRONG  : Datos no OK(1)  *
               00433 ;*                                                                   Datos OK   (0)  *
               00434 ;*****************************************************
               00435 
22C6 00436 MOT_ROT
22C6 EC0E F013 00437         call    MOT_INIT
               00438         
               00439     ;Comprobación de datos correctos
               00440 
               00441     ;Velocidad debe estar entre 0 y 100
22CA 5024      00442         movf    MOT_VEL,W
22CC 0F9B      00443         addlw   .155                                                    
22CE 0F65      00444         addlw   .101
22D0 010F      00445         banksel STATUS
22D2 B0D8      00446         btfsc   STATUS,C
22D4 EF70 F011 00447         goto    MOT_ROT_CONT_01
22D8 0100      00448         banksel MOT_STATUS
22DA 8223      00449         bsf             MOT_STATUS,DWRONG
22DC EF17 F013 00450         goto    MOT_FIN
22E0 00451 MOT_ROT_CONT_01
               00452         ;El angulo debe estar entre 0 y 100
22E0 0100      00453         banksel MOT_CON
22E2 B428      00454         btfsc   MOT_CON,COMTYPE
22E4 EF7F F011 00455         goto    MOT_ROT_CONT_02
22E8 5025      00456         movf    MOT_T_DIST_ANG,W
22EA 0F9B      00457         addlw   .155                                                    
22EC 0F65      00458         addlw   .101
22EE 010F      00459         banksel STATUS
22F0 B0D8      00460         btfsc   STATUS,C
22F2 EF7F F011 00461         goto    MOT_ROT_CONT_02
22F6 0100      00462         banksel MOT_STATUS
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 74


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
22F8 8223      00463         bsf             MOT_STATUS,DWRONG
22FA EF17 F013 00464         goto    MOT_FIN
22FE 00465 MOT_ROT_CONT_02
               00466         ;Preparación de datos para ser mandados por I2C
               00467 
               00468     ;El comando a mandar es COM_ROT (0x02)
22FE 0100      00469         banksel MOT_COMAND
2300 0E02      00470         movlw   COM_ROT
2302 6E2D      00471         movwf   MOT_COMAND
               00472 
               00473         ;Se mandan COMTYPE en el mismo byte de MOT_COMAND
2304 010F      00474         banksel STATUS
2306 90D8      00475         bcf             STATUS,C
2308 0100      00476         banksel MOT_CON
230A A428      00477         btfss   MOT_CON,COMTYPE
230C EF8A F011 00478         goto    MOT_ROT_CONT_03
2310 010F      00479         banksel STATUS  
2312 80D8      00480         bsf             STATUS,C
2314 00481 MOT_ROT_CONT_03
2314 0100      00482         banksel MOT_COMAND
2316 362D      00483         rlcf    MOT_COMAND,F
               00484 
               00485         ;Se mandan RL en el mismo byte de MOT_COMAND
2318 010F      00486         banksel STATUS
231A 90D8      00487         bcf             STATUS,C
231C 0100      00488         banksel MOT_CON 
231E A228      00489         btfss   MOT_CON,RL      
2320 EF94 F011 00490         goto    MOT_ROT_CONT_04
2324 010F      00491         banksel STATUS
2326 80D8      00492         bsf             STATUS,C
2328 00493 MOT_ROT_CONT_04
2328 0100      00494         banksel MOT_COMAND
232A 362D      00495         rlcf    MOT_COMAND,F
               00496 
               00497 
232C 502D      00498         movf    MOT_COMAND,W
232E 6E31      00499         movwf   MOT_DATA_0
               00500 
               00501         ;En LSB de velocidad se empaquetara el sentido
2330 010F      00502         banksel STATUS
2332 90D8      00503         bcf             STATUS,C
2334 0100      00504         banksel MOT_CON
2336 A028      00505         btfss   MOT_CON,FWDBACK
2338 EFA0 F011 00506         goto    MOT_ROT_CONT_05
233C 010F      00507         banksel STATUS  
233E 80D8      00508         bsf             STATUS,C
2340 00509 MOT_ROT_CONT_05
2340 0100      00510         banksel MOT_VEL
2342 3424      00511         rlcf    MOT_VEL,W
2344 6E32      00512         movwf   MOT_DATA_1
               00513 
2346 5026      00514         movf    MOT_CENWHEEL,W
2348 6E33      00515         movwf   MOT_DATA_2
234A 5025      00516         movf    MOT_T_DIST_ANG,W
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 75


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
234C 6E34      00517         movwf   MOT_DATA_3
               00518 
               00519         ;Se mandan los datos (MOT_DATA) por I2C que 
               00520         ;anteriormente han sido actualizados
234E ECDD F012 00521         call    MOT_SND_I2C_4D
2352 ECE1 F013 00522         call    STOP
               00523 
2356 010F      00524         banksel STATUS
2358 B4D8      00525         btfsc   STATUS,Z
235A EF17 F013 00526         goto    MOT_FIN
235E 0100      00527         banksel MOT_STATUS
2360 9023      00528         bcf             MOT_STATUS,COMOK
2362 EF17 F013 00529         goto    MOT_FIN 
               00530 ;*****************************************************
               00531 
               00532 
               00533 
               00534 
               00535 
               00536 
               00537 ;*****************************************************
               00538 ;*                             MOT_CUR                           *
               00539 ;*****************************************************
               00540 ;*Descripción: Comando para dar curvas. Para ello hay*
               00541 ;*que especificar velocidad, sentido, radio,         *
               00542 ;*izquierda o derecha, tipo de comando y el tiempo o *
               00543 ;*la distancia a recorrer.                           *
               00544 ;*****************************************************
               00545 ;*Variables de entrada:- MOT_VEL   : 0  - 100        *
               00546 ;*                                         - MOT_CON:                                    *
               00547 ;*                       - FWDBACK : Adelante   (1)  * 
               00548 ;*                                                                       Atras      (0)  *
               00549 ;*                                               - RL      : Derecha    (1)      *
               00550 ;*                                                                 : Izquierda  (0)  *
               00551 ;*                       - COMTYPE : Tiempo         (1)  *
               00552 ;*                                                                       Distancia  (0)  *  
               00553 ;*                                         - MOT_RAD   : 0  - 100                *
               00554 ;*                     - MOT_T_DIST_ANG: 0  - 255        *
               00555 ;*Variables de salida:                               *
               00556 ;*Salida:              - MOT_STATUS:                 *
               00557 ;*                       - COMOK   : Enviado    (1)      *
               00558 ;*                                                                       No enviado (0)  *
               00559 ;*                       - DWRONG  : Datos no OK(1)  *
               00560 ;*                                                                   Datos OK   (0)  *
               00561 ;*****************************************************
2366 00562 MOT_CUR
2366 EC0E F013 00563         call    MOT_INIT
               00564 
               00565     ;Comprobación de datos correctos
               00566 
               00567     ;Velocidad debe estar entre 0 y 100
236A 5024      00568         movf    MOT_VEL,W
236C 0F9B      00569         addlw   .155                                                    
236E 0F65      00570         addlw   .101
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 76


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
2370 010F      00571         banksel STATUS
2372 B0D8      00572         btfsc   STATUS,C
2374 EFC0 F011 00573         goto    MOT_CUR_CONT_01
2378 0100      00574         banksel MOT_STATUS
237A 8223      00575         bsf             MOT_STATUS,DWRONG
237C EF17 F013 00576         goto    MOT_FIN
2380 00577 MOT_CUR_CONT_01
               00578         ;Comprobación si el radio es correcto
2380 0100      00579         banksel MOT_RAD
2382 5027      00580         movf    MOT_RAD,W
2384 5C24      00581         subwf   MOT_VEL,W
2386 0F9B      00582         addlw   .155                                                    
2388 0F65      00583         addlw   .101
238A 010F      00584         banksel STATUS
238C B0D8      00585         btfsc   STATUS,C
238E EFCD F011 00586         goto    MOT_CUR_CONT_02
2392 0100      00587         banksel MOT_STATUS
2394 8223      00588         bsf             MOT_STATUS,DWRONG
2396 EF17 F013 00589         goto    MOT_FIN
239A 00590 MOT_CUR_CONT_02
239A 0100      00591         banksel MOT_RAD
239C 5027      00592         movf    MOT_RAD,W
239E 2424      00593         addwf   MOT_VEL,W
23A0 0F9B      00594         addlw   .155                                                    
23A2 0F65      00595         addlw   .101
23A4 010F      00596         banksel STATUS
23A6 B0D8      00597         btfsc   STATUS,C
23A8 EFDA F011 00598         goto    MOT_CUR_CONT_03
23AC 0100      00599         banksel MOT_STATUS
23AE 8223      00600         bsf             MOT_STATUS,DWRONG
23B0 EF17 F013 00601         goto    MOT_FIN
23B4 00602 MOT_CUR_CONT_03
23B4 9223      00603         bcf             MOT_STATUS,DWRONG
               00604         
               00605 
               00606         ;Preparación de datos para ser mandados por I2C
               00607 
               00608     ;El comando a mandar es COM_CHA_VEL (0x03)  
23B6 0E03      00609         movlw   COM_CUR
23B8 6E2D      00610         movwf   MOT_COMAND
               00611 
               00612         ;Se mandan COMTYPE en el mismo byte de MOT_COMAND
23BA 010F      00613         banksel STATUS
23BC 90D8      00614         bcf             STATUS,C
23BE 0100      00615         banksel MOT_CON
23C0 A428      00616         btfss   MOT_CON,COMTYPE 
23C2 EFE5 F011 00617         goto    MOT_CUR_CONT_04
23C6 010F      00618         banksel STATUS
23C8 80D8      00619         bsf             STATUS,C
23CA 00620 MOT_CUR_CONT_04
23CA 0100      00621         banksel MOT_COMAND
23CC 362D      00622         rlcf    MOT_COMAND,F
               00623 
               00624         ;Se mandan RL en el mismo byte de MOT_COMAND
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 77


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
23CE 010F      00625         banksel STATUS
23D0 90D8      00626         bcf             STATUS,C
23D2 0100      00627         banksel MOT_CON 
23D4 A228      00628         btfss   MOT_CON,RL
23D6 EFEF F011 00629         goto    MOT_CUR_CONT_05 
23DA 010F      00630         banksel STATUS
23DC 80D8      00631         bsf             STATUS,C
23DE 00632 MOT_CUR_CONT_05 
23DE 0100      00633         banksel MOT_COMAND
23E0 362D      00634         rlcf    MOT_COMAND,F
               00635 
23E2 502D      00636         movf    MOT_COMAND,W
23E4 6E31      00637         movwf   MOT_DATA_0
               00638 
               00639         ;En LSB de velocidad se empaquetara el sentido
23E6 010F      00640         banksel STATUS
23E8 90D8      00641         bcf             STATUS,C
23EA 0100      00642         banksel MOT_CON
23EC A028      00643         btfss   MOT_CON,FWDBACK 
23EE EFFB F011 00644         goto    MOT_CUR_CONT_06 
23F2 010F      00645         banksel STATUS
23F4 80D8      00646         bsf             STATUS,C
23F6 00647 MOT_CUR_CONT_06 
23F6 0100      00648         banksel MOT_VEL
23F8 3424      00649         rlcf    MOT_VEL,W
23FA 6E32      00650         movwf   MOT_DATA_1
               00651 
23FC 5027      00652         movf    MOT_RAD,W
23FE 6E33      00653         movwf   MOT_DATA_2
               00654 
2400 5025      00655         movf    MOT_T_DIST_ANG,W
2402 6E34      00656         movwf   MOT_DATA_3
               00657 
               00658         ;Se mandan los datos (MOT_DATA) por I2C que 
               00659         ;anteriormente han sido actualizados
2404 ECDD F012 00660         call    MOT_SND_I2C_4D
2408 ECE1 F013 00661         call    STOP
               00662 
240C 010F      00663         banksel STATUS
240E B4D8      00664         btfsc   STATUS,Z
2410 EF17 F013 00665         goto    MOT_FIN
2414 0100      00666         banksel MOT_STATUS
2416 9023      00667         bcf             MOT_STATUS,COMOK
2418 EF17 F013 00668         goto    MOT_FIN 
               00669 ;*****************************************************
               00670 
               00671 
               00672 
               00673 
               00674 
               00675 
               00676 ;*****************************************************
               00677 ;*                     MOT_STOP                      *
               00678 ;*****************************************************
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 78


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00679 ;*Descripción: Comando para parar.                   *
               00680 ;*****************************************************
               00681 ;*Variables de entrada:                              *
               00682 ;*Variables de salida:                               *
               00683 ;*Salida:              - MOT_STATUS:                 *
               00684 ;*                       - COMOK   : Enviado    (1)      *
               00685 ;*                                                                       No enviado (0)  *
               00686 ;*****************************************************
241C 00687 MOT_STOP
241C EC0E F013 00688         call    MOT_INIT
               00689 
               00690         ;Se prepara el comando STOP
2420 0E04      00691         movlw   COM_STOP
2422 6E2D      00692         movwf   MOT_COMAND
               00693 
               00694         ;No se manda COMTYPE ni RL
2424 010F      00695         banksel STATUS
2426 90D8      00696         bcf             STATUS,C
2428 0100      00697         banksel MOT_COMAND      
242A 362D      00698         rlcf    MOT_COMAND,F
242C 010F      00699         banksel STATUS
242E 80D8      00700         bsf             STATUS,C        
2430 0100      00701         banksel MOT_COMAND
2432 362D      00702         rlcf    MOT_COMAND,F
               00703 
2434 502D      00704         movf    MOT_COMAND,W
2436 6E31      00705         movwf   MOT_DATA_0
               00706 
               00707         ;Se mandan los datos (MOT_DATA) por I2C que 
               00708         ;anteriormente han sido actualizados
2438 EC9E F012 00709         call    MOT_SND_I2C_1D
243C ECE1 F013 00710         call    STOP
               00711 
2440 010F      00712         banksel STATUS
2442 B4D8      00713         btfsc   STATUS,Z
2444 EF17 F013 00714         goto    MOT_FIN
2448 0100      00715         banksel MOT_STATUS
244A 9023      00716         bcf             MOT_STATUS,COMOK
244C EF17 F013 00717         goto    MOT_FIN 
               00718 ;*****************************************************
               00719 
               00720 
               00721 
               00722 
               00723 
               00724 ;*****************************************************
               00725 ;*                       MOT_RST                     *
               00726 ;*****************************************************
               00727 ;*Descripción: Comando para resetear tiempo,         *
               00728 ;*distancia o el cuentakilometros.                   *
               00729 ;*****************************************************
               00730 ;*Variables de entrada:- MOT_RST_COM:                *
               00731 ;*                         -RST_T                    *
               00732 ;*                         -RST_D                    *
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 79


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00733 ;*                         -RST_KM                   *
               00734 ;*Variables de salida:                               *
               00735 ;*Salida:              - MOT_STATUS:                 *
               00736 ;*                       - COMOK   : Enviado    (1)      *
               00737 ;*                                                                       No enviado (0)  *
               00738 ;*****************************************************
2450 00739 MOT_RST
2450 EC0E F013 00740         call    MOT_INIT
               00741 
               00742         ;Se prepara el comando reset
2454 5029      00743         movf    MOT_RST_COM,W
2456 09F0      00744         iorlw   0xF0
2458 6E29      00745         movwf   MOT_RST_COM
245A 5029      00746         movf    MOT_RST_COM,W
245C 6E31      00747         movwf   MOT_DATA_0
               00748         
               00749         ;Se mandan los datos (MOT_DATA) por I2C que 
               00750         ;anteriormente han sido actualizados
245E EC9E F012 00751         call    MOT_SND_I2C_1D
2462 ECE1 F013 00752         call    STOP
               00753 
2466 010F      00754         banksel STATUS
2468 B4D8      00755         btfsc   STATUS,Z
246A EF17 F013 00756         goto    MOT_FIN
246E 0100      00757         banksel MOT_STATUS
2470 9023      00758         bcf             MOT_STATUS,COMOK
2472 EF17 F013 00759         goto    MOT_FIN 
               00760 ;*****************************************************
               00761 
               00762 
               00763 
               00764 
               00765 
               00766 ;*****************************************************
               00767 ;*                     MOT_FDBCK                         *
               00768 ;*****************************************************
               00769 ;*Descripción: Comando para conocer varios parámetros*
               00770 ;*del módulo motor: tiempo, angulo recorrido,        *
               00771 ;*velocidad de los dos motores, distancia recorrida  *
               00772 ;*por los dos motores y valor del cuentakilometros   *
               00773 ;*(2 variables de salida).                           *
               00774 ;*****************************************************
               00775 ;*Variables de entrada:- MOT_STATUS_COM:             *
               00776 ;*                         -STATUS_T                 *
               00777 ;*                         -STATUS_A                 *
               00778 ;*                         -STATUS_V_R               *
               00779 ;*                         -STATUS_V_L               *
               00780 ;*                         -STATUS_D_R               *
               00781 ;*                         -STATUS_D_L               *
               00782 ;*                         -STATUS_KM                *
               00783 ;*Variables de salida: - MOT_STATUS_DATA_0           *
               00784 ;*                     - MOT_STATUS_DATA_1           *
               00785 ;*Salida:              - MOT_STATUS:                     *
               00786 ;*                       - COMOK   : Enviado    (1)      *
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 80


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00787 ;*                                                                       No enviado (0)  *
               00788 ;*****************************************************
2476 00789 MOT_FDBCK
2476 EC0E F013 00790         call    MOT_INIT
               00791 
247A 0100      00792         banksel MOT_STATUS_COM
247C 8E2A      00793         bsf             MOT_STATUS_COM,7 
247E 502A      00794         movf    MOT_STATUS_COM,W
2480 6E31      00795         movwf   MOT_DATA_0
               00796 
               00797 
               00798         ;Se mandan los datos (MOT_DATA) por I2C que 
               00799         ;anteriormente han sido actualizados
               00800 
2482 EC9E F012 00801         call    MOT_SND_I2C_1D
2486 ECE1 F013 00802         call    STOP
248A 010F      00803         banksel STATUS
248C A4D8      00804         btfss   STATUS,Z
248E EF17 F013 00805         goto    MOT_FIN
               00806         ;Lectura de los datos
               00807 
2492 ECD3 F013 00808         call    I2CSTART                ;Comenzar envío i2c
2496 00809 SND_I2C_NO_ACK_READ
2496 0E11      00810         movlw   0x11
2498 EC31 F013 00811         call    MANDAR_I2C
249C BA2E      00812         btfsc   FLAGS_MOT,NO_ACK_INTENTO
249E EF4B F012 00813         goto    SND_I2C_NO_ACK_READ
24A2 A023      00814         btfss   MOT_STATUS,COMOK
24A4 EFB4 F012 00815         goto    MOT_TIME_OUT_1D
24A8 802E      00816         bsf             FLAGS_MOT,DIR_M
               00817 
24AA EC9A F013 00818         call    IN_BYTE                 ;Recibe el primer byte
24AE ECC3 F013 00819         call    OUT_ACK                 ;Manda ACK
24B2 5035      00820         movf    I_BYTE,W
24B4 6E2C      00821         movwf   MOT_STATUS_DATA_0
               00822 
24B6 EC9A F013 00823         call    IN_BYTE                 ;Recibe el primer byte
24BA ECCB F013 00824         call    OUT_NACK                ;Manda NACK: Terminación de envio
24BE 5035      00825         movf    I_BYTE,W
24C0 6E2B      00826         movwf   MOT_STATUS_DATA_1
               00827 
24C2 ECE1 F013 00828         call    STOP
               00829 
               00830 
24C6 502A      00831         movf    MOT_STATUS_COM,W        
24C8 0886      00832         sublw   0x86
24CA A4D8      00833         btfss   STATUS,Z
24CC EF17 F013 00834         goto    MOT_FIN 
               00835         
               00836         
24D0 502B      00837         movf    MOT_STATUS_DATA_1, W
24D2 6E39      00838         movwf   CAL_TEMP1
24D4 502C      00839         movf    MOT_STATUS_DATA_0, W
24D6 6E38      00840         movwf   CAL_TEMP0
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 81


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
24D8 90D8      00841         bcf             STATUS,C
24DA 322B      00842         rrcf    MOT_STATUS_DATA_1, F
24DC 322C      00843         rrcf    MOT_STATUS_DATA_0, F
24DE 262C      00844         addwf   MOT_STATUS_DATA_0, F
24E0 5039      00845         movf    CAL_TEMP1, W
24E2 B0D8      00846         btfsc   STATUS, C     
24E4 3C39      00847         incfsz  CAL_TEMP1, W
24E6 262B      00848         addwf   MOT_STATUS_DATA_1, F
24E8 322B      00849         rrcf    MOT_STATUS_DATA_1, F
24EA 322C      00850         rrcf    MOT_STATUS_DATA_0, F
24EC 90D8      00851         bcf             STATUS,C
24EE 322B      00852         rrcf    MOT_STATUS_DATA_1, F
24F0 322C      00853         rrcf    MOT_STATUS_DATA_0, F
24F2 90D8      00854         bcf             STATUS,C
24F4 322B      00855         rrcf    MOT_STATUS_DATA_1, F
24F6 322C      00856         rrcf    MOT_STATUS_DATA_0, F
24F8 5038      00857         movf    CAL_TEMP0, W
24FA 262C      00858         addwf   MOT_STATUS_DATA_0, F
24FC 5039      00859         movf    CAL_TEMP1, W
24FE B0D8      00860         btfsc   STATUS, C  
2500 3C39      00861         incfsz  CAL_TEMP1, W
2502 262B      00862         addwf   MOT_STATUS_DATA_1, F
2504 322B      00863         rrcf    MOT_STATUS_DATA_1, F
2506 322C      00864         rrcf    MOT_STATUS_DATA_0, F
2508 5038      00865         movf    CAL_TEMP0, W
250A 262C      00866         addwf   MOT_STATUS_DATA_0, F
250C 5039      00867         movf    CAL_TEMP1, W
250E B0D8      00868         btfsc   STATUS, C  
2510 3C39      00869         incfsz  CAL_TEMP1, W
2512 262B      00870         addwf   MOT_STATUS_DATA_1, F
2514 382C      00871         swapf   MOT_STATUS_DATA_0, W
2516 0B0F      00872         andlw   0x0F
2518 6E2C      00873         movwf   MOT_STATUS_DATA_0
251A 382B      00874         swapf   MOT_STATUS_DATA_1, W
251C 6E2B      00875         movwf   MOT_STATUS_DATA_1
251E 0BF0      00876         andlw   0xF0
2520 1A2B      00877         xorwf   MOT_STATUS_DATA_1, F
2522 122C      00878         iorwf   MOT_STATUS_DATA_0, F
2524 B0D8      00879         btfsc   STATUS, C  
2526 882B      00880         bsf             MOT_STATUS_DATA_1, 4
               00881         
2528 502B      00882         movf    MOT_STATUS_DATA_1,W
252A B4D8      00883         btfsc   STATUS,Z
252C EF17 F013 00884         goto    MOT_FIN
               00885 ;       movlw   .255
               00886 ;       movwf   MOT_STATUS_DATA_0 
               00887 
               00888 
               00889         
               00890 
2530 EF17 F013 00891         goto    MOT_FIN 
               00892 ;*****************************************************
               00893 
               00894 ;*****************************************************
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 82


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00895 ;*                              MOT_CHECK_END                            *
               00896 ;*****************************************************
               00897 ;*Descripción:La función termina al terminar el      *
               00898 ;* que se está ejecutando actualmente                    *
               00899 ;*****************************************************
               00900 ;*Variables de entrada:                                          *
               00901 ;*Variables de salida:                               *
               00902 ;*Salida:                                                            *
               00903 ;*****************************************************
2534 00904 MOT_CHECK_END
               00905 
2534 00906 MOT_CHECK_END_TAG_00    
2534 AE84      00907         btfss           MOT_END
2536 EF9A F012 00908         goto            MOT_CHECK_END_TAG_00
253A 0012      00909         return       
               00910 
               00911 
               00912 
               00913 
               00914 
               00915 
               00916 
               00917 ;*****************************************************
               00918 ;*                       MOT_SND_I2C_1D                  *
               00919 ;*****************************************************
               00920 ;*Descripción:Función de comunicación por I2C de bajo*
               00921 ;*nivel encargado de mandar un solo dato.            *
               00922 ;*****************************************************
               00923 ;*Variables de entrada:- MOT_DATA_0                  *
               00924 ;*Variables de salida:                               *
               00925 ;*Salida:              - 0: Envío correcto           *
               00926 ;*                     - 1: Envio incorrecto         *
               00927 ;*****************************************************
253C 00928 MOT_SND_I2C_1D
               00929 
253C 00930 SND_I2C_NO_ACK_1D
               00931 
253C ECD3 F013 00932         call    I2CSTART                ;Comenzar envío i2c
               00933 
2540 0E10      00934         movlw   MOT_DIR_M
2542 EC31 F013 00935         call    MANDAR_I2C
2546 BA2E      00936         btfsc   FLAGS_MOT,NO_ACK_INTENTO
2548 EF9E F012 00937         goto    SND_I2C_NO_ACK_1D
254C A023      00938         btfss   MOT_STATUS,COMOK
254E EFB4 F012 00939         goto    MOT_TIME_OUT_1D
               00940         
2552 0100      00941         banksel MOT_DATA_0
2554 5031      00942         movf    MOT_DATA_0,W
2556 EC31 F013 00943         call    MANDAR_I2C
255A BA2E      00944         btfsc   FLAGS_MOT,NO_ACK_INTENTO
255C EF9E F012 00945         goto    SND_I2C_NO_ACK_1D
2560 A023      00946         btfss   MOT_STATUS,COMOK
2562 EFB4 F012 00947         goto    MOT_TIME_OUT_1D
               00948         
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 83


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00949         
2566 0C00      00950         retlw   .0
2568 00951 MOT_TIME_OUT_1D
               00952         
2568 0C01      00953         retlw   .1
               00954 ;*****************************************************
               00955 
               00956 
               00957 
               00958 
               00959 
               00960 ;*****************************************************
               00961 ;*                              MOT_SND_I2C_3D                   *
               00962 ;*****************************************************
               00963 ;*Descripción:Función de comunicación por I2C de bajo*
               00964 ;*nivel encargado de mandar tres datos.              *
               00965 ;*****************************************************
               00966 ;*Variables de entrada:- MOT_DATA_0-3                *
               00967 ;*Variables de salida:                               *
               00968 ;*Salida:              - 0: Envío correcto           *
               00969 ;*                     - 1: Envio incorrecto         *
               00970 ;*****************************************************
256A 00971 MOT_SND_I2C_3D
               00972 
256A 00973 SND_I2C_NO_ACK_3D
               00974 
256A ECD3 F013 00975         call    I2CSTART        ;Comenzar envío i2c
               00976 
256E 0E10      00977         movlw   MOT_DIR_M
2570 EC31 F013 00978         call    MANDAR_I2C
2574 BA2E      00979         btfsc   FLAGS_MOT,NO_ACK_INTENTO
2576 EFB5 F012 00980         goto    SND_I2C_NO_ACK_3D
257A A023      00981         btfss   MOT_STATUS,COMOK
257C EFDC F012 00982         goto    MOT_TIME_OUT_3D
               00983 
               00984         
2580 5031      00985         movf    MOT_DATA_0,W
2582 EC31 F013 00986         call    MANDAR_I2C
2586 BA2E      00987         btfsc   FLAGS_MOT,NO_ACK_INTENTO
2588 EFB5 F012 00988         goto    SND_I2C_NO_ACK_3D
258C A023      00989         btfss   MOT_STATUS,COMOK
258E EFDC F012 00990         goto    MOT_TIME_OUT_3D
               00991 
               00992         
2592 5032      00993         movf    MOT_DATA_1,W
2594 EC31 F013 00994         call    MANDAR_I2C
2598 BA2E      00995         btfsc   FLAGS_MOT,NO_ACK_INTENTO
259A EFB5 F012 00996         goto    SND_I2C_NO_ACK_3D
259E A023      00997         btfss   MOT_STATUS,COMOK
25A0 EFDC F012 00998         goto    MOT_TIME_OUT_3D
               00999 
               01000         
25A4 5033      01001         movf    MOT_DATA_2,W
25A6 EC31 F013 01002         call    MANDAR_I2C
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 84


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
25AA BA2E      01003         btfsc   FLAGS_MOT,NO_ACK_INTENTO
25AC EFB5 F012 01004         goto    SND_I2C_NO_ACK_3D
25B0 A023      01005         btfss   MOT_STATUS,COMOK
25B2 EFDC F012 01006         goto    MOT_TIME_OUT_3D
               01007 
               01008 
25B6 0C00      01009         retlw   .0
25B8 01010 MOT_TIME_OUT_3D
               01011         
25B8 0C01      01012         retlw   .1
               01013 ;*****************************************************
               01014 
               01015 
               01016 
               01017 
               01018 
               01019 ;*****************************************************
               01020 ;*                              MOT_SND_I2C_4D                           *
               01021 ;*****************************************************
               01022 ;*Descripción:Función de comunicación por I2C de bajo*
               01023 ;*nivel encargado de mandar cuatro datos.            *
               01024 ;*****************************************************
               01025 ;*Variables de entrada:- MOT_DATA_0-4                *
               01026 ;*Variables de salida:                               *
               01027 ;*Salida:              - 0: Envío correcto           *
               01028 ;*                     - 1: Envio incorrecto         *
               01029 ;*****************************************************
25BA 01030 MOT_SND_I2C_4D
               01031 
25BA 01032 SND_I2C_NO_ACK_4D
               01033 
25BA ECD3 F013 01034         call    I2CSTART        ;Comenzar envío i2c
               01035 
25BE 0E10      01036         movlw   MOT_DIR_M
25C0 EC31 F013 01037         call    MANDAR_I2C
25C4 BA2E      01038         btfsc   FLAGS_MOT,NO_ACK_INTENTO
25C6 EFDD F012 01039         goto    SND_I2C_NO_ACK_4D
25CA A023      01040         btfss   MOT_STATUS,COMOK
25CC EF0D F013 01041         goto    MOT_TIME_OUT_4D
               01042 
               01043         
25D0 5031      01044         movf    MOT_DATA_0,W
25D2 EC31 F013 01045         call    MANDAR_I2C
25D6 BA2E      01046         btfsc   FLAGS_MOT,NO_ACK_INTENTO
25D8 EFDD F012 01047         goto    SND_I2C_NO_ACK_4D
25DC A023      01048         btfss   MOT_STATUS,COMOK
25DE EF0D F013 01049         goto    MOT_TIME_OUT_4D
               01050 
               01051         
25E2 5032      01052         movf    MOT_DATA_1,W
25E4 EC31 F013 01053         call    MANDAR_I2C
25E8 BA2E      01054         btfsc   FLAGS_MOT,NO_ACK_INTENTO
25EA EFDD F012 01055         goto    SND_I2C_NO_ACK_4D
25EE A023      01056         btfss   MOT_STATUS,COMOK
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 85


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
25F0 EF0D F013 01057         goto    MOT_TIME_OUT_4D
               01058 
               01059         
25F4 5033      01060         movf    MOT_DATA_2,W
25F6 EC31 F013 01061         call    MANDAR_I2C
25FA BA2E      01062         btfsc   FLAGS_MOT,NO_ACK_INTENTO
25FC EFDD F012 01063         goto    SND_I2C_NO_ACK_4D
2600 A023      01064         btfss   MOT_STATUS,COMOK
2602 EF0D F013 01065         goto    MOT_TIME_OUT_4D
               01066 
               01067 
2606 5034      01068         movf    MOT_DATA_3,W
2608 EC31 F013 01069         call    MANDAR_I2C
260C BA2E      01070         btfsc   FLAGS_MOT,NO_ACK_INTENTO
260E EFDD F012 01071         goto    SND_I2C_NO_ACK_4D
2612 A023      01072         btfss   MOT_STATUS,COMOK
2614 EF0D F013 01073         goto    MOT_TIME_OUT_4D
               01074 
               01075         
2618 0C00      01076         retlw   .0
               01077 
261A 01078 MOT_TIME_OUT_4D
               01079 
261A 0C01      01080         retlw   .1
               01081 ;*****************************************************
               01082 
               01083 
               01084 
               01085 
               01086 
               01087 
               01088 
               01089 
               01090 ;*********************************
               01091 ;*********************************
               01092 ;**     INSTRUCCIONES DE BAJO NIVEL     **
               01093 ;*********************************
               01094 ;*********************************
               01095 
               01096 ;************************************************
               01097 ;*MOT_INIT      :Inicializa funciones                           *
               01098 ;************************************************
261C 01099 MOT_INIT
               01100         
               01101          
261C 0100      01102         banksel MOT_STATUS
261E 6A2E      01103         clrf    FLAGS_MOT
2620 EC1A F013 01104         call    MOT_INTER_CALL
2624 0100      01105         banksel MOT_STATUS
2626 6A23      01106         clrf    MOT_STATUS
2628 0E0A      01107         movlw   .10
262A 6E2F      01108         movwf   INTENTOS
262C 0012      01109         return
               01110 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 86


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01111 ;************************************************
               01112 ;* MOT_FIN      :Finaliza las funciones                         *
               01113 ;************************************************
262E 01114 MOT_FIN
262E EC22 F013 01115         call    MOT_INTER_RETURN
2632 0012      01116         return
               01117 
               01118 ;************************************************
               01119 ;*MOT_INTER_CALL:Checkea si las interrupciones  *
               01120 ;*                           estan habilitadas. Si lo estan     *
               01121 ;*                               las inhabilita                                 *
               01122 ;************************************************
               01123 
2634 01124 MOT_INTER_CALL
               01125 
               01126          
2634 010F      01127         banksel INTCON
2636 50F2      01128         movf    INTCON,W
2638 0100      01129         banksel INTER_MOT
263A 6E30      01130         movwf   INTER_MOT
263C 010F      01131         banksel INTCON
263E 9EF2      01132         bcf             INTCON,GIE
2640 0100      01133         banksel MOT_STATUS
2642 0012      01134         return
               01135         
               01136 
               01137 ;*************************************************
               01138 ;*MOT_INTER_RETURN:Checkea si las interrupciones *
               01139 ;*                             estan habilitadas. Si lo estan*
               01140 ;*                               las inhabilita                                  *
               01141 ;*************************************************
               01142 
2644 01143 MOT_INTER_RETURN
               01144          
2644 0100      01145         banksel INTER_MOT       
2646 5030      01146         movf    INTER_MOT,W
2648 BE30      01147         btfsc   INTER_MOT,7     
264A EF29 F013 01148         goto    MOT_GIE_UNO
264E EF2D F013 01149         goto    MOT_GIE_CERO
2652 01150 MOT_GIE_UNO
2652 010F      01151         banksel INTCON
2654 8EF2      01152         bsf             INTCON,GIE
2656 0100      01153         banksel MOT_STATUS
2658 0012      01154         return
265A 01155 MOT_GIE_CERO
265A 010F      01156         banksel INTCON
265C 9EF2      01157         bcf             INTCON,GIE      
265E 0100      01158         banksel MOT_STATUS
2660 0012      01159         return
               01160         
               01161 
               01162 
               01163 ;************************************************
               01164 ;* MANDAR_I2C           :Manda lo que esta en el        *
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 87


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01165 ;*                                       acumulador por I2C                     *
               01166 ;************************************************
               01167 ;*      W                               ->      Acumulador                              *
               01168 ;************************************************
               01169 ;*      FLAGS_MOT                       ->      Flag de control         *
               01170 ;*      FLAGS_MOT(NO_ENVIADO)-> Comando no enviado      *
               01171 ;*      FLAGS_MOT(NO_ACK_INTENTO)->     No ACK                  *
               01172 ;************************************************
               01173 
2662 01174 MANDAR_I2C
2662 0100      01175         banksel O_BYTE
2664 6E36      01176         movwf   O_BYTE
2666 EC61 F013 01177         call    OUT_BYTE        ;Enviar 
266A EC4D F013 01178         call    IN_ACK          ;Comprueba ACK
266E 0AFF      01179         xorlw   0xFF
2670 010F      01180         banksel STATUS
2672 A4D8      01181         btfss   STATUS,Z
2674 EF40 F013 01182         goto    NO_ACK
2678 0100      01183         banksel MOT_STATUS
267A 8023      01184         bsf             MOT_STATUS,COMOK
267C 9A2E      01185         bcf             FLAGS_MOT,NO_ACK_INTENTO
267E 0012      01186         return
               01187 
2680 01188 NO_ACK
2680 0100      01189         banksel MOT_STATUS      
2682 ECE1 F013 01190         call    STOP
Message [305] : Using default destination of 1 (file).
2686 2E2F      01191         decfsz  INTENTOS
2688 EF4A F013 01192         goto    NO_ACK_INTENTOS
268C 9A2E      01193         bcf             FLAGS_MOT,NO_ACK_INTENTO
268E 0100      01194         banksel MOT_STATUS
2690 9023      01195         bcf             MOT_STATUS,COMOK
2692 0012      01196         return
               01197 
2694 01198 NO_ACK_INTENTOS
2694 8A2E      01199         bsf             FLAGS_MOT,NO_ACK_INTENTO
2696 0100      01200         banksel MOT_STATUS
2698 0012      01201         return  
               01202 
               01203 
               01204 ;************************************************
               01205 ;* IN_ACK                       :Lee el ACK o el NACK del       *
               01206 ;*                                   SLAVE. No hace falta               *
               01207 ;*                                       configurar SDA_SOFT como entrada*
               01208 ;*                                       (esta rutina lo hace           *
               01209 ;*                                       automaticamente)               *
               01210 ;************************************************
               01211 ;*      ACK                             ->      Devuelve 0xFF                   *
               01212 ;*      NACK                    ->      Devuelve 0x00                   *
               01213 ;************************************************
269A 01214 IN_ACK                  
               01215 
269A 010F      01216         banksel TRISC
269C 8296      01217         bsf             SDA_TRIS
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 88


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01218                 
269E 010F      01219         banksel TRISC
26A0 8096      01220         bsf     SCL_TRIS                        
               01221 
26A2 010F      01222         banksel PORTC
26A4 A284      01223         btfss   SDA_SOFT        
26A6 EF5B F013 01224         goto    IN_ACK_RET
26AA 01225 IN_NACK_RET
26AA 010F      01226         banksel TRISC
26AC 9296      01227         bcf     SDA_TRIS                
               01228 
26AE 010F      01229         banksel TRISC
26B0 9096      01230         bcf     SCL_TRIS                
26B2 0100      01231         banksel MOT_STATUS
26B4 0C00      01232         retlw   0x00
26B6 01233 IN_ACK_RET
26B6 010F      01234         banksel TRISC
26B8 9296      01235         bcf     SDA_TRIS                
               01236 
26BA 010F      01237         banksel TRISC
26BC 9096      01238         bcf     SCL_TRIS                
26BE 0100      01239         banksel MOT_STATUS
26C0 0CFF      01240         retlw   0xFF
               01241 
               01242 ;************************************************
               01243 ;* OUT_BYTE:            :Manda byte creando a su vez* 
               01244 ;*                                       el reloj en SCL_SOFT                   *
               01245 ;************************************************
               01246 ;*      O_BYTE                  ->      Byte a mandar                   *
               01247 ;************************************************
               01248 
26C2 01249 OUT_BYTE:
26C2 0100      01250         banksel _N      
26C4 0E08      01251         movlw   .8
26C6 6E37      01252         movwf   _N
26C8 01253 OUT_BIT:
26C8 010F      01254         banksel STATUS
26CA 90D8      01255         bcf     STATUS,C
26CC 0100      01256         banksel O_BYTE          
26CE 3636      01257         rlcf    O_BYTE, F
26D0 010F      01258         banksel STATUS          
26D2 A0D8      01259         btfss   STATUS, C               
26D4 EF6E F013 01260         goto    OUT_ZERO
26D8 EF82 F013 01261         goto    OUT_ONE
26DC 01262 OUT_ZERO:
               01263 
26DC 010F      01264         banksel TRISH
26DE 9284      01265         bcf             SDA_SOFT
26E0 9296      01266         bcf     SDA_TRIS                ;Hacemos SDA_SOFT como salida. 
               01267                         ;Nivel lógico 0.        
26E2 010F      01268         banksel TRISH
26E4 8096      01269         bsf     SCL_TRIS                ;Hacemos SCL_SOFT como entrada.         
               01270                         ;Nivel lógico 1.
26E6 0000      01271         nop
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 89


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
26E8 0000      01272         nop
26EA 0000      01273         nop
26EC 0000      01274         nop
26EE 0000      01275         nop
26F0 0000      01276         nop     
26F2 9096      01277         bcf     SCL_TRIS                ;Hacemos SCL_SOFT como salida. 
               01278                         ;Nivel lógico 0.        
26F4 0000      01279         nop
26F6 0000      01280         nop
26F8 0000      01281         nop
26FA 0000      01282         nop
26FC 0000      01283         nop
26FE 0000      01284         nop     
               01285         
2700 EF94 F013 01286         goto    OUT_CONT
2704 01287 OUT_ONE:
               01288 
2704 010F      01289         banksel TRISH
2706 8296      01290         bsf     SDA_TRIS                ;Hacemos SDA_SOFT como entrada. 
               01291                         ;Nivel lógico 1.                
2708 8096      01292         bsf     SCL_TRIS                ;Hacemos SCL_SOFT como entrada. 
               01293                         ;Nivel lógico 1.
270A 0000      01294         nop
270C 0000      01295         nop
270E 0000      01296         nop
2710 0000      01297         nop
2712 0000      01298         nop
2714 0000      01299         nop     
2716 9096      01300         bcf     SCL_TRIS                ;Hacemos SCL_SOFT como salida. 
               01301                         ;Nivel lógico 0.        
2718 0000      01302         nop
271A 0000      01303         nop
271C 0000      01304         nop
271E 0000      01305         nop
2720 0000      01306         nop
2722 0000      01307         nop     
2724 EF94 F013 01308         goto    OUT_CONT
2728 01309 OUT_CONT:
2728 0100      01310         banksel _N
272A 2E37      01311         decfsz  _N, F                   ; decrementa el índice
272C EF64 F013 01312         goto    OUT_BIT
2730 0100      01313         banksel MOT_STATUS
2732 0C00      01314         retlw   0       
               01315 
               01316 ;************************************************
               01317 ;* IN_BYTE:             :        Recibe byte creando a su vez* 
               01318 ;*                                       el reloj en SCL_SOFT                   *
               01319 ;************************************************
               01320 ;*      I_BYTE                  ->      Byte a recibir                  *
               01321 ;************************************************
               01322 
2734 01323 IN_BYTE                 
2734 0100      01324         banksel I_BYTE                  
2736 6A35      01325         clrf    I_BYTE
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 90


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
2738 0E08      01326         movlw   .8
273A 6E37      01327         movwf   _N                              ; pone el índice a 8    
273C ECED F013 01328         call    HIGH_SDA                
2740 01329 IN_BIT
2740 ECF6 F013 01330         call    HIGH_SCL
2744 01331 IN_BIT_CONT
2744 010F      01332         banksel PORTH
2746 A084      01333         btfss   SCL_SOFT                                ; Espera hasta que el slave deje el clock libre 
2748 EFA2 F013 01334         goto    IN_BIT_CONT                     ; Hasta que el reloj no este "stretch"
274C 010F      01335         banksel PORTH
274E A284      01336         btfss   SDA_SOFT                                ; comprueba SDA_SOFT
2750 EFAC F013 01337         goto    IN_ZERO
2754 EFB2 F013 01338         goto    IN_ONE
2758 01339 IN_ZERO
2758 010F      01340         banksel STATUS
275A 90D8      01341         bcf     STATUS, C               ; borra el carry existente
275C 0100      01342         banksel I_BYTE
275E 3635      01343         rlcf    I_BYTE, F               ; i_byte = (i_byte << 1) | 0
2760 EFB9 F013 01344         goto    CONT_IN
2764 01345 IN_ONE
2764 010F      01346         banksel STATUS
2766 90D8      01347         bcf     STATUS, C               ; borra el carry existente
2768 0100      01348         banksel I_BYTE
276A 3635      01349         rlcf    I_BYTE, F               
276C 2A35      01350         incf    I_BYTE, F               ; i_byte = (i_byte << 1) | 1
276E EFB9 F013 01351         goto    CONT_IN
2772 01352 CONT_IN
2772 ECFA F013 01353         call    LOW_SCL 
2776 0100      01354         banksel _N      
2778 2E37      01355         decfsz  _N, F
277A EFA0 F013 01356         goto    IN_BIT
277E ECF1 F013 01357         call    LOW_SDA 
2782 0100      01358         banksel MOT_STATUS
2784 0C00      01359         retlw   0
               01360 
               01361 ;************************************************
               01362 ;* OUT_ACK:             :        Saca una señal de ACK          *        
               01363 ;************************************************
               01364 
2786 01365 OUT_ACK
2786 ECF1 F013 01366         call    LOW_SDA
278A ECE7 F013 01367         call    CLOCK_PULSE
278E ECED F013 01368         call    HIGH_SDA
2792 0100      01369         banksel MOT_STATUS
2794 0C00      01370         retlw   0
               01371 
               01372 ;************************************************
               01373 ;* OUT_NACK:            :        Saca una señal de ACK          *        
               01374 ;************************************************
               01375 
2796 01376 OUT_NACK
2796 ECED F013 01377         call    HIGH_SDA
279A ECE7 F013 01378         call    CLOCK_PULSE
279E ECED F013 01379         call    HIGH_SDA
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 91


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
27A2 0100      01380         banksel MOT_STATUS
27A4 0C00      01381         retlw   0
               01382 
               01383 ;************************************************
               01384 ;* I2CSTART                     :Condicion de START para        *
               01385 ;*                                       empezar la comunicacion por*
               01386 ;*                               I2C                                            *
               01387 ;************************************************
               01388 ;*                                                                                              *
               01389 ;*                                                                                              *
               01390 ;************************************************
               01391 
27A6 01392 I2CSTART:       
27A6 010F      01393         banksel PORTC
27A8 5082      01394         movf    PORTC,W
27AA 0BFC      01395         andlw   b'11111100'
27AC 6E82      01396         movwf   PORTC
               01397 
27AE ECED F013 01398         call    HIGH_SDA
27B2 ECF6 F013 01399         call    HIGH_SCL
27B6 ECF1 F013 01400         call    LOW_SDA                 ;Hacemos 0 SDA_SOFT 
27BA ECFA F013 01401         call    LOW_SCL                 ;mientras SLC esta en alto.
27BE 0100      01402         banksel MOT_STATUS      
27C0 0012      01403         return
               01404 
               01405 ;************************************************
               01406 ;* STOP                         :Condicion de STOP para         *
               01407 ;*                                       terminar la comunicacion       *
               01408 ;*                                       por I2C                                        *
               01409 ;************************************************
               01410 ;*                                                                                              *
               01411 ;*                                                                                              *
               01412 ;************************************************
27C2 01413 STOP:
27C2 010F      01414         banksel TRISC
27C4 8096      01415         bsf     SCL_TRIS                ;Hacemos SCL_SOFT como entrada. 
               01416                         ;Nivel lógico 1.        
27C6 010F      01417         banksel TRISC
27C8 8296      01418         bsf     SDA_TRIS                ;Hacemos SDA_SOFT como entrada. 
               01419                         ;Nivel lógico 1.
27CA 0100      01420         banksel MOT_STATUS      
27CC 0012      01421         return
               01422 
               01423 
               01424 
               01425 ;************************************************
               01426 ;* Rutinas de bajo nivel                                                *
               01427 ;*                                                                                              *
               01428 ;*                                                                                              *
               01429 ;************************************************
               01430 ;*                                                                                              *
               01431 ;*                                                                                              *
               01432 ;************************************************
               01433 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 92


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               01434 
27CE 01435 CLOCK_PULSE:                    
27CE 010F      01436         banksel TRISC
27D0 8096      01437         bsf     SCL_TRIS                ;Hacemos SCL_SOFT como entrada.
               01438                         ;Nivel lógico 1.        
               01439 
27D2 010F      01440         banksel TRISC
27D4 9096      01441         bcf     SCL_TRIS                ;Hacemos SDL como salida. 
               01442                         ;Nivel lógico 0.        
27D6 0100      01443         banksel MOT_STATUS
27D8 0C00      01444         retlw   0
               01445 
27DA 01446 HIGH_SDA:                               
27DA 010F      01447         banksel TRISC
27DC 8296      01448         bsf     SDA_TRIS                ;Hacemos SDA_SOFT como entrada. 
               01449                         ;Nivel lógico 1.
27DE 0100      01450         banksel MOT_STATUS      
27E0 0C00      01451         retlw   0
               01452 
27E2 01453 LOW_SDA:                
27E2 010F      01454         banksel TRISC
27E4 9284      01455         bcf             SDA_SOFT
27E6 9296      01456         bcf     SDA_TRIS                ;Hacemos SDA_SOFT como salida. 
               01457                         ;Nivel lógico 0.
27E8 0100      01458         banksel MOT_STATUS      
27EA 0C00      01459         retlw   0
               01460 
27EC 01461 HIGH_SCL:
27EC 010F      01462         banksel TRISC
27EE 8096      01463         bsf     SCL_TRIS                ;Hacemos SCL_SOFT como entrada. 
               01464                         ;Nivel lógico 1.
27F0 0100      01465         banksel MOT_STATUS      
27F2 0C00      01466         retlw   0
               01467 
27F4 01468 LOW_SCL:        
27F4 010F      01469         banksel TRISC
27F6 9084      01470         bcf             SCL_SOFT
27F8 9096      01471         bcf     SCL_TRIS                ;Hacemos SCL_SOFT como salida. 
               01472                         ;Nivel lógico 0.
27FA 0100      01473         banksel MOT_STATUS      
27FC 0C00      01474         retlw   0
               01475 
               01476 
               01477 
               01478 
               00029   #include "inc\lib_cam_moway_GUI.inc"
               00001 ;********************************************************************************
               00002 ;*    lib_cam_moway.inc                                                                                                                 *
               00003 ;*        version: 1.0                                                                                                                          *
               00004 ;*        Esta librería contiene las funciones necesarias para gestionar el módulo      *
               00005 ;*    Moway Camera Board                                                                                                                *       
               00006 ;*    Copyright (C) 2011  Bizintek Innova S.L.                                                                  *
               00007 ;********************************************************************************
               00008 ;*    This program is free software; you can redistribute it and/or modify              *
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 93


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00009 ;*    it under the terms of the GNU General Public License as published by              *
               00010 ;*    the Free Software Foundation; either version 2 of the License, or                 *
               00011 ;*    (at your option) any later version.                                                                               *
               00012 ;*                                                                                                                                                              *
               00013 ;*    This program is distributed in the hope that it will be useful,                   *
               00014 ;*    but WITHOUT ANY WARRANTY; without even the implied warranty of                    *
               00015 ;*    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the                             *
               00016 ;*    GNU General Public License for more details.                                                              *
               00017 ;*                                                                                                                                                              *
               00018 ;*    You should have received a copy of the GNU General Public License along   *
               00019 ;*    with this program; if not, write to the Free Software Foundation, Inc.,   *
               00020 ;*    51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.                               *
               00021 ;********************************************************************************
               00022 
               00023 ;Elimina los warning de cambio de banco
               00024  ERRORLEVEL -302 
               00025 
               00026 ;********************
               00027 ;*      DEFINICIONES    *
               00028 ;********************
               00029 
               00030 ;*      Definición del patillaje
               00031 
               00032         ;PORTC
27FE 00033 #define CAM_SCK_PIN             PORTC,3
27FE 00034 #define CAM_SDI_PIN             PORTC,4
27FE 00035 #define CAM_SDO_PIN             PORTC,5
               00036         ;PORTF
27FE 00037 #define CAM_CSN_PIN             PORTF,2 
               00038 
               00039         ;TRISC
27FE 00040 #define CAM_SCK_TRIS    TRISC,3
27FE 00041 #define CAM_SDI_TRIS    TRISC,4
27FE 00042 #define CAM_SDO_TRIS    TRISC,5
               00043         ;TRISF
27FE 00044 #define CAM_CSN_TRIS    TRISF,2 
               00045 
               00046 
               00047 
               00048 ; Write opcode
27FE 00049 #define COM_WR                  0x40
27FE 00050 #define COM_RD                  0x41
               00051 
               00052 ; Registro IODIR
27FE 00053 #define IODIR_ADD               0x00
               00054 
               00055 ; Registro OLAT
27FE 00056 #define OLAT_ADD                0x0A
               00057 
               00058 
               00059 
               00060 ;****************
               00061 ;*      VARIABLES       *
               00062 ;****************
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 94


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00063 
               00064 ;*      Variables SPI
               00065 
               00066 cblock
               00067         COMMAND_CAM
               00068         ADDRESS_CAM
               00069         DATA_CAM
               00070         CAM_STAT
               00071         CAM_CHANNEL
               00072 
               00073         DELAY_1_CAM
               00074         DELAY_1_1_CAM
               00075 
               00076         AUX_CAM
               00077 endc
               00078 
               00079 ;************
               00080 ;*      CÓDIGO  *
               00081 ;************
               00082 
               00083 
               00084 ;*****************************************************
               00085 ;*                      CAM_CONFIG                           *
               00086 ;*****************************************************
               00087 ;*Descripción: La función configura el módulo SPI del*
               00088 ;*microcontrolador.En ella se especifica como salida *
               00089 ;*SDO y como entrada SDI entre otros parámetros del  *
               00090 ;*protocolo SPI.                                     *
               00091 ;*****************************************************
               00092 ;*Variables de entrada:                              *
               00093 ;*Variables de salida:                               *
               00094 ;*****************************************************
               00095 
               00096 
27FE 00097 CAM_CONFIG
               00098 
               00099         ;Configuración I/O.
27FE 010F      00100         banksel TRISC   
2800 8894      00101         bsf             CAM_SDI_TRIS
2802 9A94      00102         bcf             CAM_SDO_TRIS
2804 9694      00103         bcf             CAM_SCK_TRIS
2806 010F      00104         banksel TRISH
2808 9497      00105         bcf             CAM_CSN_TRIS
               00106 
               00107 
               00108         ;Configuración módulo SPI.
280A 010F      00109         banksel SSP1STAT
280C 0EC0      00110         movlw   b'11000000'
280E 6EC7      00111         movwf   SSP1STAT
2810 010F      00112         banksel SSPCON2
2812 6AC5      00113         clrf    SSPCON2
               00114 
2814 010F      00115         banksel SSPCON1
2816 0E20      00116         movlw   b'00100000'
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 95


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
2818 6EC6      00117         movwf   SSPCON1
               00118 
               00119         ;Configuración de la cámara
               00120 
281A 0100      00121         banksel COMMAND_CAM
281C 0E40      00122         movlw   COM_WR
281E 6E3A      00123         movwf   COMMAND_CAM
2820 0E00      00124         movlw   IODIR_ADD
2822 6E3B      00125         movwf   ADDRESS_CAM
2824 0EC0      00126         movlw   0xC0
2826 6E3C      00127         movwf   DATA_CAM
2828 EC78 F014 00128         call    CAM_SEND_COM
               00129 
282C 0100      00130         banksel COMMAND_CAM
282E 0E40      00131         movlw   COM_WR
2830 6E3A      00132         movwf   COMMAND_CAM
2832 0E0A      00133         movlw   OLAT_ADD
2834 6E3B      00134         movwf   ADDRESS_CAM
2836 0E00      00135         movlw   0x00
2838 6E3C      00136         movwf   DATA_CAM
283A EC78 F014 00137         call    CAM_SEND_COM
               00138 
283E 0012      00139         return
               00140 
               00141 
               00142 
               00143 
               00144 ;*****************************************************
               00145 ;*                      CAM_ON                                       *
               00146 ;*****************************************************
               00147 ;*Descripción: Encender cámara                       *
               00148 ;*****************************************************
               00149 ;*Variables de entrada:                              *
               00150 ;*Variables de salida:                               *
               00151 ;*****************************************************
               00152 
2840 00153 CAM_ON
               00154         
2840 0100      00155         banksel CAM_STAT
2842 0E01      00156         movlw   .1
2844 6E3D      00157         movwf   CAM_STAT
               00158         
2846 0E04      00159         movlw   .4
2848 6E41      00160         movwf   AUX_CAM
               00161 
284A 00162 PARPA
284A EC9E F014 00163         call    Delay_cam_50ms
284E 0E40      00164         movlw   COM_WR
2850 6E3A      00165         movwf   COMMAND_CAM
2852 0E0A      00166         movlw   OLAT_ADD
2854 6E3B      00167         movwf   ADDRESS_CAM
2856 0E02      00168         movlw   0x02
2858 6E3C      00169         movwf   DATA_CAM
285A EC78 F014 00170         call    CAM_SEND_COM
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 96


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00171         
285E EC9E F014 00172         call    Delay_cam_50ms
2862 0E40      00173         movlw   COM_WR
2864 6E3A      00174         movwf   COMMAND_CAM
2866 0E0A      00175         movlw   OLAT_ADD
2868 6E3B      00176         movwf   ADDRESS_CAM
286A 0E22      00177         movlw   0x22
286C 6E3C      00178         movwf   DATA_CAM
286E EC78 F014 00179         call    CAM_SEND_COM
               00180         
2872 2E41      00181         decfsz  AUX_CAM, f
2874 EF25 F014 00182         goto    PARPA
               00183 
2878 0012      00184         return
               00185 
               00186 
               00187 ;*****************************************************
               00188 ;*                      CAM_OFF                                      *
               00189 ;*****************************************************
               00190 ;*Descripción: Apagar cámara                             *
               00191 ;*****************************************************
               00192 ;*Variables de entrada:                              *
               00193 ;*Variables de salida:                               *
               00194 ;*****************************************************
               00195 
287A 00196 CAM_OFF
               00197 
287A 0100      00198         banksel CAM_STAT
287C 0E00      00199         movlw   .0
287E 6E3D      00200         movwf   CAM_STAT
               00201 
2880 0E40      00202         movlw   COM_WR
2882 6E3A      00203         movwf   COMMAND_CAM
2884 0E0A      00204         movlw   OLAT_ADD
2886 6E3B      00205         movwf   ADDRESS_CAM
2888 0E00      00206         movlw   0x00
288A 6E3C      00207         movwf   DATA_CAM
288C EC78 F014 00208         call    CAM_SEND_COM
2890 0012      00209         return
               00210 
               00211 
               00212 ;*****************************************************
               00213 ;*               CAM_CHN_SEL                                 *
               00214 ;*****************************************************
               00215 ;*Descripción: Selección canal                           *
               00216 ;*****************************************************
               00217 ;*Variables de entrada:      CAM_CHANNEL             *
               00218 ;*Variables de salida:                               *
               00219 ;*****************************************************
               00220 
2892 00221 CAM_CHN_SEL
               00222 
2892 0100      00223         banksel CAM_CHANNEL
2894 503E      00224         movf    CAM_CHANNEL,W
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 97


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
2896 0801      00225         sublw   .1
2898 0ECC      00226         movlw   0xCC
289A B4D8      00227         btfsc   STATUS,Z
289C EF66 F014 00228         goto    CAM_CHN_SEL_01
               00229 
28A0 0100      00230         banksel CAM_CHANNEL
28A2 503E      00231         movf    CAM_CHANNEL,W
28A4 0802      00232         sublw   .2
28A6 0ED4      00233         movlw   0xD4
28A8 B4D8      00234         btfsc   STATUS,Z
28AA EF66 F014 00235         goto    CAM_CHN_SEL_01
               00236 
28AE 0100      00237         banksel CAM_CHANNEL
28B0 503E      00238         movf    CAM_CHANNEL,W
28B2 0803      00239         sublw   .3      
28B4 0ED8      00240         movlw   0xD8
28B6 B4D8      00241         btfsc   STATUS,Z
28B8 EF66 F014 00242         goto    CAM_CHN_SEL_01
               00243 
28BC 0100      00244         banksel CAM_CHANNEL
28BE 503E      00245         movf    CAM_CHANNEL,W
28C0 0804      00246         sublw   .4
28C2 0EDC      00247         movlw   0xDC
28C4 B4D8      00248         btfsc   STATUS,Z
28C6 EF66 F014 00249         goto    CAM_CHN_SEL_01
28CA 0012      00250         return
               00251 
28CC 00252 CAM_CHN_SEL_01
28CC 6E3C      00253         movwf   DATA_CAM
28CE 0E40      00254         movlw   COM_WR
28D0 6E3A      00255         movwf   COMMAND_CAM
28D2 0E00      00256         movlw   IODIR_ADD
28D4 6E3B      00257         movwf   ADDRESS_CAM
28D6 EC78 F014 00258         call    CAM_SEND_COM
               00259 
28DA 0E00      00260         movlw   0x00
28DC B03D      00261         btfsc   CAM_STAT,0
28DE 0E22      00262         movlw   0x22
               00263         
28E0 6E3C      00264         movwf   DATA_CAM
28E2 0E40      00265         movlw   COM_WR
28E4 6E3A      00266         movwf   COMMAND_CAM
28E6 0E0A      00267         movlw   OLAT_ADD
28E8 6E3B      00268         movwf   ADDRESS_CAM
28EA EC78 F014 00269         call    CAM_SEND_COM
               00270         
28EE 0012      00271         return
               00272 
               00273 ;*********************************
               00274 ;*********************************
               00275 ;**        FUNCIONES COMUNICACIÓN       **
               00276 ;*********************************
               00277 ;*********************************
               00278 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 98


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
28F0 00279 CAM_SEND_COM
               00280 
28F0 010F      00281         banksel PORTB
28F2 8485      00282         bsf             CAM_CSN_PIN
               00283 
28F4 0100      00284         banksel COMMAND_CAM
28F6 503A      00285         movf    COMMAND_CAM,W
28F8 0100      00286         banksel BYTE_OUT
28FA 6E01      00287         movwf   BYTE_OUT
28FC EC6E F010 00288         call    BYTE_SPI
               00289         
2900 0100      00290         banksel ADDRESS_CAM
2902 503B      00291         movf    ADDRESS_CAM,W
2904 0100      00292         banksel BYTE_OUT
2906 6E01      00293         movwf   BYTE_OUT
2908 EC6E F010 00294         call    BYTE_SPI
               00295 
290C 0100      00296         banksel DATA_CAM
290E 503C      00297         movf    DATA_CAM,W
2910 0100      00298         banksel BYTE_OUT
2912 6E01      00299         movwf   BYTE_OUT
2914 EC6E F010 00300         call    BYTE_SPI
               00301 
2918 010F      00302         banksel PORTB
291A 9485      00303         bcf             CAM_CSN_PIN
               00304 
291C 0100      00305         banksel DATA_CAM
291E 0012      00306         return
               00307 
               00308 
               00309 ;*********************
               00310 ;*********************
               00311 ;**     FUNCIONES SPI   **
               00312 ;*********************
               00313 ;*********************
               00314 ;*      Subrutina de comunicación por SPI
2920 00315 SPI_WRITE_CAM
2920 0100      00316         banksel BYTE_OUT
2922 5001      00317         movf    BYTE_OUT,w
2924 010F      00318         banksel SSP1BUF
2926 6EC9      00319         movwf   SSP1BUF                         ;Carga el dato a enviar
2928 010F      00320         banksel SSP1STAT
292A 00321 SPI_continuar_CAM
292A A0C7      00322         btfss   SSP1STAT,BF
292C EF95 F014 00323         goto    SPI_continuar_CAM       ;Espera que termine
2930 010F      00324         banksel SSP1BUF
2932 50C9      00325         movf    SSP1BUF,w
2934 0100      00326         banksel BYTE_IN 
2936 6E00      00327         movwf   BYTE_IN                         ;Guarda el dato recibido
2938 0100      00328         banksel INTER_RF
293A 0012      00329         return
               00330 
               00331 
               00332 ;*****************************
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 99


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00333 ;*****************************
               00334 ;**     FUNCIONES AUXILIARES    **
               00335 ;*****************************
               00336 ;*****************************
               00337 
               00338 ;*      Temporizaciones varias
               00339 ;*************************************************
               00340 ;*Delay_xxxx:Temporizaciones necesarias para la  * 
               00341 ;*                       correcta captura de datos                       *
               00342 ;*************************************************
               00343 
293C 00344 Delay_cam_50ms
293C 0100      00345         banksel DELAY_1_CAM
293E 0E0E      00346         movlw   0x0E
2940 6E3F      00347         movwf   DELAY_1_CAM
2942 0E28      00348         movlw   0x28
2944 6E40      00349         movwf   DELAY_1_1_CAM
2946 00350 Delay_cam_50ms_0
2946 2E3F      00351         decfsz  DELAY_1_CAM, f
2948 EFA7 F014 00352         goto    Delay_cam_50ms_1
294C 2E40      00353         decfsz  DELAY_1_1_CAM, f
294E 00354 Delay_cam_50ms_1
294E EFA3 F014 00355         goto    Delay_cam_50ms_0
2952 EFAB F014 00356         goto    Delay_cam_50ms_2
2956 00357 Delay_cam_50ms_2
2956 0000      00358         nop
2958 0012      00030 ;*************************************
               00031 
295A 00032 INIT:
               00033 
               00034 ;#####################################
               00035   ;*************************[MOWAY CONFIGURATION]***********************
               00036   ;Sensor configuration
295A EC15 F008 00037   call    SEN_CONFIG
               00038   ;Motor configuration
295E ECCA F010 00039   call    MOT_CONFIG
               00040 
               00041 ;****************************************
               00042 ;*   Variables initialization           *
               00043 ;****************************************
2962 0E00      00044   movlw   .0
2964 6F7E      00045   movwf    adelante
2966 0E00      00046   movlw   .0
2968 6F7D      00047   movwf    girar
296A 0E00      00048   movlw   .0
296C 6F7C      00049   movwf    sensorLuz
               00050 
               00051 ;************Module RfActivation****************************************
               00052 
               00053 ;***********************************************************************
               00054 
               00055 ;Configuration of SPI
296E EC7D F00D 00056   call      RF_CONFIG_SPI
               00057 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 100


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00058 ;Configuration of RF module (channel and dir)
2972 0E00      00059   movlw     .0          ;Dir
2974 6E0D      00060   movwf     RF_DIR                      
2976 0E00      00061   movlw     .0          ;Channel
2978 6E0C      00062   movwf     RF_CHN                      
297A EC99 F00D 00063   call      RF_CONFIG
297E AC08      00064         btfss   RF_STATUS,CONFIGOK
2980 EFF2 F014 00065   goto    loopEnd
               00066 
               00067 ;Activate the module    
2984 EC0C F00E 00068   call      RF_ON
2988 A808      00069         btfss   RF_STATUS,ONOK
298A EFF2 F014 00070   goto    loopEnd
               00071 
298E 00072 label0:
               00073 ;**************Module Assign Accelerometer******************************
               00074 
               00075 ;***********************************************************************
298E EC2C F00B 00076   call    SEN_ACCE_XYZ_READ
2992 51D3      00077   movf    SEN_ACCE_Y,W
2994 6F7E      00078   movwf   adelante
               00079 
               00080 ;***********************************************************************
               00081 ;**************Module Assign Accelerometer******************************
               00082 
               00083 ;***********************************************************************
2996 EC2C F00B 00084   call    SEN_ACCE_XYZ_READ
299A 51D2      00085   movf    SEN_ACCE_X,W
299C 6F7D      00086   movwf   girar
               00087 
               00088 ;***********************************************************************
               00089 ;************Module RfTransmit********************************************
               00090 
               00091 ;***********************************************************************
               00092 
299E 0E01      00093   movlw       .1                ;Dir of receptor
29A0 6E0E      00094   movwf     RF_DIR_OUT
               00095                         ;Data to send           
               00096 
29A2 517E      00097   movf     adelante,W
29A4 6E0F      00098   movwf     RF_DATA_OUT_0
29A6 517D      00099   movf     girar,W
29A8 6E10      00100   movwf     RF_DATA_OUT_1
29AA 0E00      00101   movlw     .0
29AC 6E11      00102   movwf     RF_DATA_OUT_2
29AE 0E00      00103   movlw     .0
29B0 6E12      00104   movwf     RF_DATA_OUT_3
29B2 0E00      00105   movlw     .0
29B4 6E13      00106   movwf     RF_DATA_OUT_4
29B6 0E00      00107   movlw     .0
29B8 6E14      00108   movwf     RF_DATA_OUT_5
29BA 0E00      00109   movlw     .0
29BC 6E15      00110   movwf     RF_DATA_OUT_6
29BE 0E00      00111   movlw     .0
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 101


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
29C0 6E16      00112   movwf     RF_DATA_OUT_7
               00113 
29C2 EC50 F00E 00114   call      RF_SEND             ;Send
29C6 A008      00115   btfss     RF_STATUS,SNDOK
29C8 EFE9 F014 00116   goto    label1
29CC A208      00117   btfss     RF_STATUS,ACK       
29CE EFE9 F014 00118   goto    label1
               00119 
               00120 
               00121 ;***********************************************************************
               00122 
29D2 00123 label1:
               00124 ;************Module Pause***********************************************
               00125 
               00126 ;***********************************************************************
               00127 
29D2 0100      00128   banksel           AUX_00       
29D4 0E14      00129   movlw   .20
29D6 6FDC      00130   movwf   AUX_00
29D8 EC14 F00D 00131   call    Delay_50ms_mOwayGUI
               00132 
               00133 ;***********************************************************************
               00134 
               00135 
29DC EFC7 F014 00136   goto    label0
               00137 
               00138 
29E0 EFE9 F014 00139   goto    label1
               00140 
29E4 00141 loopEnd:
29E4 EFF2 F014 00142   goto    loopEnd
               00143 
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 102


SYMBOL TABLE
  LABEL                             VALUE 

A                                 00000000
A16                               00000000
A17                               00000001
A18                               00000002
A19                               00000003
ABDEN                             00000000
ABDOVF                            00000007
ACCESS                            00000000
ACCE_ADRESS                       000000D7
ACCE_CHECK_NO                     000016FE
ACCE_CHECK_check_irq              0000168A
ACCE_CHECK_cont                   00001696
ACCE_CHECK_loop                   0000167E
ACCE_CHECK_ok                     000016AA
ACCE_DATA_IN                      000000D9
ACCE_DATA_OUT                     000000D8
ACCE_NO_HIGH                      000000D5
ACCE_NO_LOW                       000000D6
ACCE_READ                         00001982
ACCE_WRITE                        0000195E
ACKDT                             00000005
ACKEN                             00000004
ACKSTAT                           00000006
ACQT0                             00000003
ACQT1                             00000004
ACQT2                             00000005
ACTVIE                            00000002
ACTVIF                            00000002
AD0                               00000000
AD1                               00000001
AD10                              00000002
AD11                              00000003
AD12                              00000004
AD13                              00000005
AD14                              00000006
AD15                              00000007
AD2                               00000002
AD3                               00000003
AD4                               00000004
AD5                               00000005
AD6                               00000006
AD7                               00000007
AD8                               00000000
AD9                               00000001
ADCAL                             00000006
ADCON0                            00000FC2
ADCON1                            00000FC1
ADCS0                             00000000
ADCS1                             00000001
ADCS2                             00000002
ADDEN                             00000003
ADDR0                             00000000
ADDR1                             00000001
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 103


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
ADDR2                             00000002
ADDR3                             00000003
ADDR4                             00000004
ADDR5                             00000005
ADDR6                             00000006
ADDRESS_CAM                       0000003B
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADIP                              00000006
ADMSK1                            00000001
ADMSK2                            00000002
ADMSK3                            00000003
ADMSK4                            00000004
ADMSK5                            00000005
ADON                              00000000
ADRES                             00000FC3
ADRESH                            00000FC4
ADRESL                            00000FC3
ADRMUX0                           00000003
ADRMUX1                           00000004
ADSHR                             00000004
ALE                               00000000
ALP                               00000005
AN0                               00000000
AN1                               00000001
AN10                              00000005
AN11                              00000006
AN12                              00000004
AN13                              00000005
AN14                              00000006
AN15                              00000007
AN2                               00000002
AN3                               00000003
AN4                               00000005
AN7                               00000002
ANCON0                            00000FC1
ANCON1                            00000FC2
AUX_00                            000000DC
AUX_01                            000000DD
AUX_CAM                           00000041
BA0                               00000004
BAD_CONFIG                        00001C10
BAD_OFF                           00001C98
BAD_ON                            00001C50
BANKED                            00000001
BAUDCON                           00000F7E
BAUDCON1                          00000F7E
BAUDCON2                          00000F7C
BCL1IE                            00000003
BCL1IF                            00000003
BCL1IP                            00000003
BCL2IE                            00000006
BCL2IF                            00000006
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 104


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
BCL2IP                            00000006
BCLIE                             00000003
BCLIF                             00000003
BCLIP                             00000003
BEP                               00000002
BF                                00000000
BOR                               00000000
BRG16                             00000003
BRGH                              00000002
BSR                               00000FE0
BTOEE                             00000004
BTOEF                             00000004
BTSEE                             00000007
BTSEF                             00000007
BUSY                              00000007
BYTE_IN                           00000000
BYTE_OUT                          00000001
BYTE_SPI                          000020DC
C                                 00000000
C1CH0                             00000000
C1CH1                             00000001
C1INA                             00000006
C1INB                             00000005
C1INC                             00000006
C1OUT                             00000007
C2INA                             00000005
C2INB                             00000002
C2INC                             00000004
C2IND                             00000005
C2OUT                             00000005
CAL_TEMP0                         00000038
CAL_TEMP1                         00000039
CAM_CHANNEL                       0000003E
CAM_CHN_SEL                       00002892
CAM_CHN_SEL_01                    000028CC
CAM_CONFIG                        000027FE
CAM_OFF                           0000287A
CAM_ON                            00002840
CAM_SEND_COM                      000028F0
CAM_STAT                          0000003D
CCH0                              00000000
CCH1                              00000001
CCP1                              00000002
CCP1CON                           00000FBB
CCP1IE                            00000002
CCP1IF                            00000002
CCP1IP                            00000002
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCP1X                             00000005
CCP1Y                             00000004
CCP2CON                           00000FB6
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 105


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
CCP2IE                            00000000
CCP2IF                            00000000
CCP2IP                            00000000
CCP2M0                            00000000
CCP2M1                            00000001
CCP2M2                            00000002
CCP2M3                            00000003
CCP2X                             00000005
CCP2Y                             00000004
CCP2_PORTB                        00000003
CCP2_PORTC                        00000001
CCP2_PORTE                        00000007
CCP3                              00000000
CCP3CON                           00000FB1
CCP3IE                            00000000
CCP3IF                            00000000
CCP3IP                            00000000
CCP3M0                            00000000
CCP3M1                            00000001
CCP3M2                            00000002
CCP3M3                            00000003
CCP3X                             00000005
CCP3Y                             00000004
CCP4                              00000003
CCP4CON                           00000F73
CCP4IE                            00000001
CCP4IF                            00000001
CCP4IP                            00000001
CCP4M0                            00000000
CCP4M1                            00000001
CCP4M2                            00000002
CCP4M3                            00000003
CCP4OD                            00000003
CCP5                              00000004
CCP5CON                           00000F70
CCP5IE                            00000002
CCP5IF                            00000002
CCP5IP                            00000002
CCP5M0                            00000000
CCP5M1                            00000001
CCP5M2                            00000002
CCP5M3                            00000003
CCP5OD                            00000004
CCPR1                             00000FBC
CCPR1H                            00000FBD
CCPR1L                            00000FBC
CCPR2                             00000FB7
CCPR2H                            00000FB8
CCPR2L                            00000FB7
CCPR3                             00000FB2
CCPR3H                            00000FB3
CCPR3L                            00000FB2
CCPR4                             00000F74
CCPR4H                            00000F75
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 106


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
CCPR4L                            00000F74
CCPR5                             00000F71
CCPR5H                            00000F72
CCPR5L                            00000F71
CE                                00000005
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CHS3                              00000005
CK                                00000006
CK2                               00000001
CKE                               00000006
CKP                               00000004
CLKO                              00000006
CLOCK_PULSE                       000027CE
CM                                00000005
CM1CON                            00000FD2
CM1CON1                           00000FD2
CM1IE                             00000005
CM1IF                             00000005
CM1IP                             00000005
CM2CON                            00000FD1
CM2CON1                           00000FD1
CM2IE                             00000006
CM2IF                             00000006
CM2IP                             00000006
CMSTAT                            00000F6A
CMSTATUS                          00000F6A
COE                               00000006
COLISION_ANALOG                   00001644
COLISION_DIG                      00001460
COMMAND_CAM                       0000003A
CON                               00000007
CONT_IN                           00002772
COUT1                             00000000
COUT2                             00000001
CPOL                              00000005
CRC16EE                           00000002
CRC16EF                           00000002
CRC5EE                            00000001
CRC5EF                            00000001
CREF                              00000002
CREN                              00000004
CS1                               00000006
CS1P                              00000003
CS2                               00000007
CS2P                              00000004
CSF0                              00000006
CSF1                              00000007
CSRC                              00000007
CVR0                              00000000
CVR1                              00000001
CVR2                              00000002
CVR3                              00000003
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 107


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
CVRCON                            00000F77
CVREF                             00000005
CVREN                             00000007
CVROE                             00000006
CVRR                              00000005
CVRSS                             00000004
D                                 00000005
DATA_ADDRESS                      00000005
DATA_CAM                          0000003C
DATA_N_RCV                        0000000B
DATA_N_SND                        0000000A
DATO_DIR                          00000009
DATO_REG                          00000004
DC                                00000001
DC1B0                             00000004
DC1B1                             00000005
DC2B0                             00000004
DC2B1                             00000005
DC3B0                             00000004
DC3B1                             00000005
DC4B0                             00000004
DC4B1                             00000005
DC5B0                             00000004
DC5B1                             00000005
DCCP4X                            00000005
DCCP4Y                            00000004
DCCP5X                            00000005
DCCP5Y                            00000004
DDRF                              00000F97
DDRG                              00000F98
DDRH                              00000F99
DDRJ                              00000F9A
DELAY_1                           000000DF
DELAY_150us                       0000216E
DELAY_15us                        00002180
DELAY_1_1                         000000E0
DELAY_1_1_CAM                     00000040
DELAY_1_CAM                       0000003F
DELAY_1s                          00002126
DELAY_2ms                         00002150
DEVCFG                            00000004
DFN8EE                            00000003
DFN8EF                            00000003
DIR                               00000002
DIR_REG                           00000003
DONE                              00000001
DT2                               00000002
DTRXP                             00000005
D_A                               00000005
Delay_1000us_0                    00001AE6
Delay_1000us_1                    00001AEE
Delay_1000us_2                    00001AF6
Delay_100ms                       00001ADC
Delay_100us                       00001A4E
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 108


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
Delay_100us_0                     00001A54
Delay_100us_1                     00001A5E
Delay_120us                       00001A60
Delay_120us_0                     00001A66
Delay_120us_1                     00001A70
Delay_1500us                      00001ABE
Delay_1500us_0                    00001AC8
Delay_1500us_1                    00001AD0
Delay_1500us_2                    00001AD8
Delay_30us                        00001AAE
Delay_30us_0                      00001AB4
Delay_500us                       00001A92
Delay_500us_0                     00001A98
Delay_50ms                        00001A0A
Delay_50ms_0                      00001A14
Delay_50ms_1                      00001A1C
Delay_50ms_2                      00001A24
Delay_50ms_mOwayGUI               00001A28
Delay_50ms_mOwayGUI_0             00001A32
Delay_50ms_mOwayGUI_1             00001A3A
Delay_50ms_mOwayGUI_2             00001A42
Delay_65us                        00001AA0
Delay_65us_0                      00001AA6
Delay_900us                       00001A72
Delay_900us_0                     00001A7C
Delay_900us_1                     00001A84
Delay_900us_2                     00001A8C
Delay_cam_50ms                    0000293C
Delay_cam_50ms_0                  00002946
Delay_cam_50ms_1                  0000294E
Delay_cam_50ms_2                  00002956
ECCP1AS                           00000FBF
ECCP1AS0                          00000004
ECCP1AS1                          00000005
ECCP1AS2                          00000006
ECCP1ASE                          00000007
ECCP1CON                          00000FBB
ECCP1DEL                          00000FBE
ECCP1OD                           00000000
ECCP2AS                           00000FBA
ECCP2AS0                          00000004
ECCP2AS1                          00000005
ECCP2AS2                          00000006
ECCP2ASE                          00000007
ECCP2CON                          00000FB6
ECCP2DEL                          00000FB9
ECCP2OD                           00000001
ECCP3AS                           00000FB5
ECCP3AS0                          00000004
ECCP3AS1                          00000005
ECCP3AS2                          00000006
ECCP3ASE                          00000007
ECCP3CON                          00000FB1
ECCP3DEL                          00000FB4
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 109


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
ECCP3OD                           00000002
ECCPAS0                           00000004
ECCPAS1                           00000005
ECCPAS2                           00000006
ECCPASE                           00000007
EDBIS                             00000007
EECON1                            00000FA6
EECON2                            00000FA7
ENDP0                             00000003
ENDP1                             00000004
ENDP2                             00000005
ENDP3                             00000006
EPCONDIS                          00000003
EPHSHK                            00000004
EPINEN                            00000001
EPOUTEN                           00000002
EPSTALL                           00000000
EVPOL0                            00000003
EVPOL1                            00000004
FAST                              00000001
FERR                              00000002
FLAGS_MOT                         0000002E
FLT0                              00000000
FLTS                              00000002
FLUSH_RX                          0000208E
FLUSH_TX                          00002074
FREE                              00000004
FRM0                              00000000
FRM1                              00000001
FRM10                             00000002
FRM2                              00000002
FRM3                              00000003
FRM4                              00000004
FRM5                              00000005
FRM6                              00000006
FRM7                              00000007
FRM8                              00000000
FRM9                              00000001
FSEN                              00000002
FSR0                              00000000
FSR0H                             00000FEA
FSR0L                             00000FE9
FSR1                              00000001
FSR1H                             00000FE2
FSR1L                             00000FE1
FSR2                              00000002
FSR2H                             00000FDA
FSR2L                             00000FD9
GCEN                              00000007
GIE                               00000007
GIEH                              00000007
GIEL                              00000006
GO                                00000001
GO_DONE                           00000001
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 110


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
HIGH_SCL                          000027EC
HIGH_SDA                          000027DA
I2CSTART                          000027A6
I2C_DAT                           00000005
I2C_READ                          00000002
I2C_START                         00000003
I2C_STOP                          00000004
IB0F                              00000000
IB1F                              00000001
IB2F                              00000002
IB3F                              00000003
IBF                               00000007
IBOV                              00000006
IDLEIE                            00000004
IDLEIF                            00000004
IDLEN                             00000007
INCM0                             00000003
INCM1                             00000004
INDF0                             00000FEF
INDF1                             00000FE7
INDF2                             00000FDF
INIT                              0000295A
INT0                              00000000
INT0E                             00000004
INT0F                             00000001
INT0IE                            00000004
INT0IF                            00000001
INT1                              00000001
INT1E                             00000003
INT1F                             00000000
INT1IE                            00000003
INT1IF                            00000000
INT1IP                            00000006
INT1P                             00000006
INT2                              00000002
INT2E                             00000004
INT2F                             00000001
INT2IE                            00000004
INT2IF                            00000001
INT2IP                            00000007
INT2P                             00000007
INT3                              00000003
INT3E                             00000005
INT3F                             00000002
INT3IE                            00000005
INT3IF                            00000002
INT3IP                            00000001
INT3P                             00000001
INTCON                            00000FF2
INTCON2                           00000FF1
INTCON3                           00000FF0
INTEDG0                           00000006
INTEDG1                           00000005
INTEDG2                           00000004
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 111


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
INTEDG3                           00000003
INTENTOS                          0000002F
INTER_MOT                         00000030
INTER_RF                          00000007
INTER_SEN                         000000DE
INTSRC                            00000007
IN_ACK                            0000269A
IN_ACK_RET                        000026B6
IN_BIT                            00002740
IN_BIT_CONT                       00002744
IN_BYTE                           00002734
IN_NACK_RET                       000026AA
IN_ONE                            00002764
IN_ZERO                           00002758
IOFS                              00000002
IPEN                              00000007
IPR1                              00000F9F
IPR2                              00000FA2
IPR3                              00000FA5
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRQM0                             00000005
IRQM1                             00000006
I_BYTE                            00000035
KBI0                              00000004
KBI1                              00000005
KBI2                              00000006
KBI3                              00000007
LATA                              00000F89
LATA0                             00000000
LATA1                             00000001
LATA2                             00000002
LATA3                             00000003
LATA4                             00000004
LATA5                             00000005
LATA6                             00000006
LATA7                             00000007
LATB                              00000F8A
LATB0                             00000000
LATB1                             00000001
LATB2                             00000002
LATB3                             00000003
LATB4                             00000004
LATB5                             00000005
LATB6                             00000006
LATB7                             00000007
LATC                              00000F8B
LATC0                             00000000
LATC1                             00000001
LATC2                             00000002
LATC3                             00000003
LATC4                             00000004
LATC5                             00000005
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 112


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
LATC6                             00000006
LATC7                             00000007
LATD                              00000F8C
LATD0                             00000000
LATD1                             00000001
LATD2                             00000002
LATD3                             00000003
LATD4                             00000004
LATD5                             00000005
LATD6                             00000006
LATD7                             00000007
LATE                              00000F8D
LATE0                             00000000
LATE1                             00000001
LATE2                             00000002
LATE3                             00000003
LATE4                             00000004
LATE5                             00000005
LATE6                             00000006
LATE7                             00000007
LATF                              00000F8E
LATF2                             00000002
LATF3                             00000003
LATF4                             00000004
LATF5                             00000005
LATF6                             00000006
LATF7                             00000007
LATG                              00000F8F
LATG0                             00000000
LATG1                             00000001
LATG2                             00000002
LATG3                             00000003
LATG4                             00000004
LATH                              00000F90
LATH0                             00000000
LATH1                             00000001
LATH2                             00000002
LATH3                             00000003
LATH4                             00000004
LATH5                             00000005
LATH6                             00000006
LATH7                             00000007
LATJ                              00000F91
LATJ0                             00000000
LATJ1                             00000001
LATJ2                             00000002
LATJ3                             00000003
LATJ4                             00000004
LATJ5                             00000005
LATJ6                             00000006
LATJ7                             00000007
LB                                00000006
LED_BRAKE_OFF                     00001868
LED_BRAKE_ON                      0000185A
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 113


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
LED_BRAKE_ON_OFF                  00001876
LED_FRONT_OFF                     0000189C
LED_FRONT_ON                      0000188E
LED_FRONT_ON_OFF                  000018AA
LED_IR_OFF                        00001938
LED_IR_ON                         0000192A
LED_IR_ON_OFF                     00001946
LED_TOP_GREEN_OFF                 00001904
LED_TOP_GREEN_ON                  000018F6
LED_TOP_GREEN_ON_OFF              00001912
LED_TOP_RED_OFF                   000018D0
LED_TOP_RED_ON                    000018C2
LED_TOP_RED_ON_OFF                000018DE
LOW_SCL                           000027F4
LOW_SDA                           000027E2
LVDIE                             00000002
LVDIF                             00000002
LVDIP                             00000002
LVDSTAT                           00000006
MANDAR_I2C                        00002662
MEMCON                            00000FCB
MODE0                             00000000
MODE1                             00000001
MODE16                            00000002
MOT_CENWHEEL                      00000026
MOT_CHA_VEL                       00002248
MOT_CHA_VEL_CONT_01               00002262
MOT_CHA_VEL_CONT_02               00002278
MOT_CHA_VEL_CONT_03               0000228C
MOT_CHA_VEL_CONT_04               000022A4
MOT_CHECK_END                     00002534
MOT_CHECK_END_TAG_00              00002534
MOT_COMAND                        0000002D
MOT_CON                           00000028
MOT_CONFIG                        00002194
MOT_CUR                           00002366
MOT_CUR_CONT_01                   00002380
MOT_CUR_CONT_02                   0000239A
MOT_CUR_CONT_03                   000023B4
MOT_CUR_CONT_04                   000023CA
MOT_CUR_CONT_05                   000023DE
MOT_CUR_CONT_06                   000023F6
MOT_DATA_0                        00000031
MOT_DATA_1                        00000032
MOT_DATA_2                        00000033
MOT_DATA_3                        00000034
MOT_FDBCK                         00002476
MOT_FIN                           0000262E
MOT_GIE_CERO                      0000265A
MOT_GIE_UNO                       00002652
MOT_INIT                          0000261C
MOT_INTER_CALL                    00002634
MOT_INTER_RETURN                  00002644
MOT_RAD                           00000027
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 114


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
MOT_ROT                           000022C6
MOT_ROT_CONT_01                   000022E0
MOT_ROT_CONT_02                   000022FE
MOT_ROT_CONT_03                   00002314
MOT_ROT_CONT_04                   00002328
MOT_ROT_CONT_05                   00002340
MOT_RST                           00002450
MOT_RST_COM                       00000029
MOT_SND_I2C_1D                    0000253C
MOT_SND_I2C_3D                    0000256A
MOT_SND_I2C_4D                    000025BA
MOT_STATUS                        00000023
MOT_STATUS_COM                    0000002A
MOT_STATUS_DATA_0                 0000002C
MOT_STATUS_DATA_1                 0000002B
MOT_STOP                          0000241C
MOT_STR                           000021D6
MOT_STR_CONT_01                   000021F0
MOT_STR_CONT_02                   00002206
MOT_STR_CONT_03                   00002226
MOT_TIME_OUT_1D                   00002568
MOT_TIME_OUT_3D                   000025B8
MOT_TIME_OUT_4D                   0000261A
MOT_T_DIST_ANG                    00000025
MOT_VEL                           00000024
MSK0                              00000000
MSK1                              00000001
MSK2                              00000002
MSK3                              00000003
MSK4                              00000004
MSK5                              00000005
MSK6                              00000006
MSK7                              00000007
N                                 00000004
NOT_A                             00000005
NOT_ADDRESS                       00000005
NOT_BOR                           00000000
NOT_CM                            00000005
NOT_DONE                          00000001
NOT_PD                            00000002
NOT_POR                           00000001
NOT_RBPU                          00000007
NOT_RC8                           00000006
NOT_RI                            00000004
NOT_T1SYNC                        00000002
NOT_T3SYNC                        00000002
NOT_TO                            00000003
NOT_TX8                           00000006
NOT_W                             00000002
NOT_WRITE                         00000002
NO_ACK                            00002680
NO_ACK_INTENTOS                   00002694
OB0E                              00000000
OB1E                              00000001
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 115


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
OB2E                              00000002
OB3E                              00000003
OBE                               00000007
OBUF                              00000006
ODCON1                            00000FCF
ODCON2                            00000FCE
ODCON3                            00000FCD
OE                                00000001
OERR                              00000001
OSC2                              00000006
OSCCON                            00000FD3
OSCFIE                            00000007
OSCFIF                            00000007
OSCFIP                            00000007
OSCTUNE                           00000F9B
OSTS                              00000003
OUT_ACK                           00002786
OUT_BIT                           000026C8
OUT_BYTE                          000026C2
OUT_CONT                          00002728
OUT_NACK                          00002796
OUT_ONE                           00002704
OUT_ZERO                          000026DC
OV                                00000003
O_BYTE                            00000036
P                                 00000004
P1DC0                             00000000
P1DC1                             00000001
P1DC2                             00000002
P1DC3                             00000003
P1DC4                             00000004
P1DC5                             00000005
P1DC6                             00000006
P1M0                              00000006
P1M1                              00000007
P1RSEN                            00000007
P2DC0                             00000000
P2DC1                             00000001
P2DC2                             00000002
P2DC3                             00000003
P2DC4                             00000004
P2DC5                             00000005
P2DC6                             00000006
P2M0                              00000006
P2M1                              00000007
P2RSEN                            00000007
P3DC0                             00000000
P3DC1                             00000001
P3DC2                             00000002
P3DC3                             00000003
P3DC4                             00000004
P3DC5                             00000005
P3DC6                             00000006
P3M0                              00000006
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 116


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
P3M1                              00000007
P3RSEN                            00000007
PADCFG1                           00000FCC
PARPA                             0000284A
PC                                00000FF9
PCFG0                             00000000
PCFG1                             00000001
PCFG10                            00000002
PCFG11                            00000003
PCFG12                            00000004
PCFG13                            00000005
PCFG14                            00000006
PCFG15                            00000007
PCFG2                             00000002
PCFG3                             00000003
PCFG4                             00000004
PCFG5                             00000005
PCFG6                             00000006
PCFG7                             00000007
PCFG8                             00000000
PCFG9                             00000001
PCL                               00000FF9
PCLATH                            00000FFA
PCLATU                            00000FFB
PD                                00000002
PDC0                              00000000
PDC1                              00000001
PDC2                              00000002
PDC3                              00000003
PDC4                              00000004
PDC5                              00000005
PDC6                              00000006
PDel0                             00000020
PDel1                             00000021
PDel2                             00000022
PDelL1                            00002148
PDelL1_                           00002158
PDelL1___                         0000218E
PDelL2                            0000214C
PDelL2_                           0000215C
PDelL2___                         00002192
PDelL3_                           00002160
PDelL4_                           00002166
PDelL5_                           0000216A
PEIE                              00000006
PEN                               00000002
PGC                               00000005
PGD                               00000006
PIDEE                             00000000
PIDEF                             00000000
PIE1                              00000F9D
PIE2                              00000FA0
PIE3                              00000FA3
PIR1                              00000F9E
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 117


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
PIR2                              00000FA1
PIR3                              00000FA4
PKTDIS                            00000004
PLLEN                             00000006
PLUSW0                            00000FEB
PLUSW1                            00000FE3
PLUSW2                            00000FDB
PLoop0                            0000212C
PLoop0_                           00002156
PLoop0__                          00002174
PLoop0___                         00002186
PLoop1                            00002130
PLoop2                            00002134
PMA0                              00000005
PMA1                              00000004
PMA10                             00000006
PMA11                             00000005
PMA12                             00000004
PMA13                             00000003
PMA2                              00000003
PMA3                              00000002
PMA4                              00000001
PMA5                              00000002
PMA6                              00000002
PMA7                              00000001
PMA8                              00000000
PMA9                              00000007
PMADDR                            00000F68
PMADDRH                           00000F69
PMADDRL                           00000F68
PMBE_PORTE                        00000002
PMBE_PORTH                        00000005
PMCON                             00000F4A
PMCONH                            00000F4B
PMCONL                            00000F4A
PMCS1                             00000003
PMCS2                             00000004
PMD0_PORTD                        00000000
PMD0_PORTF                        00000007
PMD1_PORTD                        00000001
PMD1_PORTF                        00000006
PMD2_PORTD                        00000002
PMD2_PORTF                        00000005
PMD3_PORTD                        00000003
PMD3_PORTH                        00000004
PMD4_PORTA                        00000005
PMD4_PORTD                        00000004
PMD5_PORTA                        00000004
PMD5_PORTD                        00000005
PMD6_PORTD                        00000006
PMD6_PORTH                        00000003
PMD7_PORTD                        00000007
PMD7_PORTH                        00000002
PMDIN1                            00000F66
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 118


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
PMDIN1H                           00000F67
PMDIN1L                           00000F66
PMDIN2                            00000F44
PMDIN2H                           00000F45
PMDIN2L                           00000F44
PMDOUT1                           00000F68
PMDOUT1H                          00000F69
PMDOUT1L                          00000F68
PMDOUT2                           00000F46
PMDOUT2H                          00000F47
PMDOUT2L                          00000F46
PMEH                              00000F43
PMEL                              00000F42
PMEN                              00000F42
PMMODE                            00000F48
PMMODEH                           00000F49
PMMODEL                           00000F48
PMPEN                             00000007
PMPIE                             00000007
PMPIF                             00000007
PMPIP                             00000007
PMPTTL                            00000000
PMRD_PORTE                        00000000
PMRD_PORTH                        00000006
PMSTAT                            00000F40
PMSTATH                           00000F41
PMSTATL                           00000F40
PMWR_PORTE                        00000001
PMWR_PORTH                        00000007
POR                               00000001
PORTA                             00000F80
PORTB                             00000F81
PORTC                             00000F82
PORTD                             00000F83
PORTE                             00000F84
PORTF                             00000F85
PORTG                             00000F86
PORTH                             00000F87
PORTJ                             00000F88
POSTDEC0                          00000FED
POSTDEC1                          00000FE5
POSTDEC2                          00000FDD
POSTINC0                          00000FEE
POSTINC1                          00000FE6
POSTINC2                          00000FDE
PPB0                              00000000
PPB1                              00000001
PPBI                              00000001
PPBRST                            00000006
PR2                               00000FCB
PR4                               00000F77
PREINC0                           00000FEC
PREINC1                           00000FE4
PREINC2                           00000FDC
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 119


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
PROD                              00000FF3
PRODH                             00000FF4
PRODL                             00000FF3
PRSEN                             00000007
PSA                               00000003
PSIDL                             00000005
PSS1AC0                           00000002
PSS1AC1                           00000003
PSS1BD0                           00000000
PSS1BD1                           00000001
PSS2AC0                           00000002
PSS2AC1                           00000003
PSS2BD0                           00000000
PSS2BD1                           00000001
PSS3AC0                           00000002
PSS3AC1                           00000003
PSS3BD0                           00000000
PSS3BD1                           00000001
PSSAC0                            00000002
PSSAC1                            00000003
PSSBD0                            00000000
PSSBD1                            00000001
PTBEEN                            00000002
PTEN0                             00000000
PTEN1                             00000001
PTEN10                            00000002
PTEN11                            00000003
PTEN12                            00000004
PTEN13                            00000005
PTEN14                            00000006
PTEN15                            00000007
PTEN2                             00000002
PTEN3                             00000003
PTEN4                             00000004
PTEN5                             00000005
PTEN6                             00000006
PTEN7                             00000007
PTEN8                             00000000
PTEN9                             00000001
PTRDEN                            00000000
PTWREN                            00000001
R                                 00000002
RA0                               00000000
RA1                               00000001
RA2                               00000002
RA3                               00000003
RA4                               00000004
RA5                               00000005
RA6                               00000006
RA7                               00000007
RB0                               00000000
RB1                               00000001
RB2                               00000002
RB3                               00000003
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 120


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
RB4                               00000004
RB5                               00000005
RB6                               00000006
RB7                               00000007
RBIE                              00000003
RBIF                              00000000
RBIP                              00000000
RBPU                              00000007
RC0                               00000000
RC1                               00000001
RC1IE                             00000005
RC1IF                             00000005
RC1IP                             00000005
RC2                               00000002
RC2IE                             00000005
RC2IF                             00000005
RC2IP                             00000005
RC3                               00000003
RC4                               00000004
RC5                               00000005
RC6                               00000006
RC7                               00000007
RC8_9                             00000006
RC9                               00000006
RCD8                              00000000
RCEN                              00000003
RCIDL                             00000006
RCIE                              00000005
RCIF                              00000005
RCIP                              00000005
RCMT                              00000006
RCON                              00000FD0
RCREG                             00000FAF
RCREG1                            00000FAF
RCREG2                            00000FAA
RCSTA                             00000FAC
RCSTA1                            00000FAC
RCSTA2                            00000F9C
RD0                               00000000
RD1                               00000001
RD16                              00000007
RD2                               00000002
RD3                               00000003
RD4                               00000004
RD5                               00000005
RD6                               00000006
RD7                               00000007
RDPU                              00000007
RDSP                              00000000
RE0                               00000000
RE1                               00000001
RE2                               00000002
RE3                               00000003
RE4                               00000004
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 121


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
RE5                               00000005
RE6                               00000006
RE7                               00000007
READ_WRITE                        00000002
REFO                              00000003
REFOCON                           00000FD3
REGSLP                            00000007
REPU                              00000006
RESUME                            00000002
REUSE_TX_PL                       000020A8
RF1                               00000001
RF2                               00000002
RF3                               00000003
RF4                               00000004
RF5                               00000005
RF6                               00000006
RF7                               00000007
RF_CHN                            0000000C
RF_CONFIG                         00001B32
RF_CONFIG_SPI                     00001AFA
RF_DATA_IN_0                      00000018
RF_DATA_IN_1                      00000019
RF_DATA_IN_2                      0000001A
RF_DATA_IN_3                      0000001B
RF_DATA_IN_4                      0000001C
RF_DATA_IN_5                      0000001D
RF_DATA_IN_6                      0000001E
RF_DATA_IN_7                      0000001F
RF_DATA_OUT_0                     0000000F
RF_DATA_OUT_1                     00000010
RF_DATA_OUT_2                     00000011
RF_DATA_OUT_3                     00000012
RF_DATA_OUT_4                     00000013
RF_DATA_OUT_5                     00000014
RF_DATA_OUT_6                     00000015
RF_DATA_OUT_7                     00000016
RF_DIR                            0000000D
RF_DIR_IN                         00000017
RF_DIR_OUT                        0000000E
RF_ESTADO                         00000002
RF_GIE_CERO                       0000211E
RF_GIE_UNO                        00002116
RF_INTER_CALL                     000020F8
RF_INTER_RETURN                   00002108
RF_INT_EN                         00001B1C
RF_NO_HIGH                        00000005
RF_NO_LOW                         00000006
RF_OFF                            00001C64
RF_ON                             00001C18
RF_READ                           00001DE2
RF_READ_INT                       00001E86
RF_RECEIVE                        00001D9C
RF_RECEIVE_DATA                   00001DCC
RF_RECEIVE_DATA_INT               00001E6A
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 122


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
RF_RECEIVE_INT                    00001E42
RF_RECEIVE_INT_bien               00001EB4
RF_RECEIVE_INT_mal                00001E92
RF_RECEIVE_bien                   00001E18
RF_RECEIVE_mal                    00001DEE
RF_SEND                           00001CA0
RF_SEND_ACK                       00001D94
RF_SEND_NO                        00001D82
RF_SEND_NO_ACK                    00001D8C
RF_SEND_check_irq                 00001D14
RF_SEND_cont                      00001D20
RF_SEND_fin                       00001D52
RF_SEND_loop                      00001D08
RF_SEND_seguir                    00001D34
RF_STATUS                         00000008
RG0                               00000000
RG1                               00000001
RG2                               00000002
RG3                               00000003
RG4                               00000004
RH0                               00000000
RH1                               00000001
RH2                               00000002
RH3                               00000003
RH4                               00000004
RH5                               00000005
RH6                               00000006
RH7                               00000007
RI                                00000004
RJ0                               00000000
RJ1                               00000001
RJ2                               00000002
RJ3                               00000003
RJ4                               00000004
RJ5                               00000005
RJ6                               00000006
RJ7                               00000007
RJPU                              00000005
RODIV0                            00000000
RODIV1                            00000001
RODIV2                            00000002
RODIV3                            00000003
ROON                              00000007
ROSEL                             00000004
ROSSLP                            00000005
RSEN                              00000001
RX                                00000007
RX2                               00000002
RX9                               00000006
RX9D                              00000000
RXDTP                             00000005
R_REGISTER_1                      00001ED6
R_REGISTER_5                      00001F00
R_RX_PAYLOAD_10                   00001F9C
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 123


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
R_STATUS                          000020C2
R_W                               00000002
S                                 00000003
SCK                               00000003
SCK2                              00000006
SCKP                              00000004
SCL                               00000003
SCL2                              00000006
SCS0                              00000000
SCS1                              00000001
SDA                               00000004
SDA2                              00000005
SDI                               00000004
SDI2                              00000005
SDO                               00000005
SDO2                              00000004
SE0                               00000005
SEN                               00000000
SENDB                             00000003
SEN_ACCE_BYTE_IN_1                000000D0
SEN_ACCE_BYTE_IN_2                000000D1
SEN_ACCE_BYTE_OUT_1               000000CE
SEN_ACCE_BYTE_OUT_2               000000CF
SEN_ACCE_CHECK_TAP                00001716
SEN_ACCE_SPI_OUT                  000019AA
SEN_ACCE_TAP                      000000DA
SEN_ACCE_X                        000000D2
SEN_ACCE_XYZ_READ                 00001658
SEN_ACCE_Y                        000000D3
SEN_ACCE_Z                        000000D4
SEN_BATTERY                       000011CA
SEN_BATTERY_P                     000000C1
SEN_BATTERY_TAG_00                000011E8
SEN_BATTERY_TAG_01                00001232
SEN_BATTERY_TAG_02                00001242
SEN_CHECK_OBS                     000000CD
SEN_CONFIG                        0000102A
SEN_GIE_CERO                      00001A02
SEN_GIE_UNO                       000019FA
SEN_INTER_CALL                    000019DC
SEN_INTER_RETURN                  000019EC
SEN_LIGHT                         00001190
SEN_LIGHT_P                       000000C0
SEN_LIGHT_TAG_00                  000011AA
SEN_LINE_ANALOG                   000017AC
SEN_LINE_ANALOG_TAG_00            000017D0
SEN_LINE_ANALOG_TAG_01            000017EC
SEN_LINE_CONT_01                  00001796
SEN_LINE_CONT_02                  000017A2
SEN_LINE_DIG                      00001778
SEN_LINE_L                        000000C7
SEN_LINE_R                        000000C8
SEN_MIC                           000000C3
SEN_MIC_ANALOG                    000012D2
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 124


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
SEN_MIC_ANALOG_TAG_00             000012F0
SEN_MIC_DIG                       0000132C
SEN_MIC_DIG_TAG_00                0000134E
SEN_OBS_ANALOG                    00001476
SEN_OBS_ANALOG_TAG_00             000014B8
SEN_OBS_ANALOG_TAG_01             000014FC
SEN_OBS_ANALOG_TAG_02             00001540
SEN_OBS_ANALOG_TAG_03             00001584
SEN_OBS_ANALOG_TAG_NEXT_00        000014CE
SEN_OBS_ANALOG_TAG_NEXT_01        00001512
SEN_OBS_ANALOG_TAG_NEXT_02        00001556
SEN_OBS_ANALOG_TAG_NEXT_03        0000159A
SEN_OBS_CENTER_L                  000000C9
SEN_OBS_CENTER_R                  000000CA
SEN_OBS_DIG                       000013CA
SEN_OBS_DIG_CONT_01               0000140E
SEN_OBS_DIG_CONT_02               0000141A
SEN_OBS_DIG_CONT_03               00001426
SEN_OBS_DIG_CONT_04               00001432
SEN_OBS_SIDE_L                    000000CB
SEN_OBS_SIDE_R                    000000CC
SEN_SEN_SPEAKER_TAG_00            00001396
SEN_SEN_SPEAKER_TAG_01            000013BE
SEN_SEN_SPEAKER_TAG_02            000013C4
SEN_SPEAKER                       00001354
SEN_SPEAKER_FREQ                  000000C4
SEN_SPEAKER_ON_OFF                000000C6
SEN_SPEAKER_TIME                  000000C5
SEN_STATUS                        000000DB
SEN_TEMPERATURE                   00001252
SEN_TEMPERATURE_C                 000000C2
SEN_TEMPERATURE_TAG_00            00001270
SEN_TEMPERATURE_TAG_01            000012C2
SMP                               00000007
SND_I2C_NO_ACK_1D                 0000253C
SND_I2C_NO_ACK_3D                 0000256A
SND_I2C_NO_ACK_4D                 000025BA
SND_I2C_NO_ACK_READ               00002496
SOFIE                             00000006
SOFIF                             00000006
SP0                               00000000
SP1                               00000001
SP2                               00000002
SP3                               00000003
SP4                               00000004
SPBRG                             00000FB0
SPBRG1                            00000FB0
SPBRG2                            00000FAB
SPBRGH                            00000F7F
SPBRGH1                           00000F7F
SPBRGH2                           00000F7D
SPEN                              00000007
SPI1OD                            00000000
SPI2OD                            00000001
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 125


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
SPI_WRITE_CAM                     00002920
SPI_continuar                     000020E6
SPI_continuar_1                   000019B4
SPI_continuar_2                   000019CC
SPI_continuar_CAM                 0000292A
SREN                              00000005
SS                                00000007
SS2                               00000007
SSP1ADD                           00000FC8
SSP1BUF                           00000FC9
SSP1CON1                          00000FC6
SSP1CON2                          00000FC5
SSP1IE                            00000003
SSP1IF                            00000003
SSP1IP                            00000003
SSP1MSK                           00000FC8
SSP1STAT                          00000FC7
SSP2ADD                           00000F6E
SSP2BUF                           00000F6F
SSP2CON1                          00000F6C
SSP2CON2                          00000F6B
SSP2IE                            00000007
SSP2IF                            00000007
SSP2IP                            00000007
SSP2MSK                           00000F6E
SSP2STAT                          00000F6D
SSPADD                            00000FC8
SSPBUF                            00000FC9
SSPCON1                           00000FC6
SSPCON2                           00000FC5
SSPEN                             00000005
SSPIE                             00000003
SSPIF                             00000003
SSPIP                             00000003
SSPM0                             00000000
SSPM1                             00000001
SSPM2                             00000002
SSPM3                             00000003
SSPOV                             00000006
SSPSTAT                           00000FC7
STALLIE                           00000005
STALLIF                           00000005
STATUS                            00000FD8
STKFUL                            00000007
STKOVF                            00000007
STKPTR                            00000FFC
STKPTR0                           00000000
STKPTR1                           00000001
STKPTR2                           00000002
STKPTR3                           00000003
STKPTR4                           00000004
STKUNF                            00000006
STOP                              000027C2
SUSPND                            00000001
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 126


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
SWDTE                             00000000
SWDTEN                            00000000
SYNC                              00000004
T08BIT                            00000006
T0CKI                             00000004
T0CON                             00000FD5
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0IP                              00000002
T0PS0                             00000000
T0PS1                             00000001
T0PS2                             00000002
T0PS3                             00000003
T0SE                              00000004
T13CKI                            00000000
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000FCD
T1INSYNC                          00000002
T1OSCEN                           00000003
T1OSI                             00000001
T1OSO                             00000000
T1RUN                             00000006
T1SYNC                            00000002
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000FCA
T2OUTPS0                          00000003
T2OUTPS1                          00000004
T2OUTPS2                          00000005
T2OUTPS3                          00000006
T3CCP1                            00000003
T3CCP2                            00000006
T3CKPS0                           00000004
T3CKPS1                           00000005
T3CON                             00000F79
T3INSYNC                          00000002
T3SYNC                            00000002
T4CKPS0                           00000000
T4CKPS1                           00000001
T4CON                             00000F76
T4OUTPS0                          00000003
T4OUTPS1                          00000004
T4OUTPS2                          00000005
T4OUTPS3                          00000006
TABLAT                            00000FF5
TBLPTR                            00000FF6
TBLPTRH                           00000FF7
TBLPTRL                           00000FF6
TBLPTRU                           00000FF8
TEMP0                             000000E1
TMR0H                             00000FD7
TMR0IE                            00000005
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 127


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
TMR0IF                            00000002
TMR0IP                            00000002
TMR0L                             00000FD6
TMR0ON                            00000007
TMR1CS                            00000001
TMR1H                             00000FCF
TMR1IE                            00000000
TMR1IF                            00000000
TMR1IP                            00000000
TMR1L                             00000FCE
TMR1ON                            00000000
TMR2                              00000FCC
TMR2IE                            00000001
TMR2IF                            00000001
TMR2IP                            00000001
TMR2ON                            00000002
TMR3CS                            00000001
TMR3H                             00000F7B
TMR3IE                            00000001
TMR3IF                            00000001
TMR3IP                            00000001
TMR3L                             00000F7A
TMR3ON                            00000000
TMR4                              00000F78
TMR4IE                            00000003
TMR4IF                            00000003
TMR4IP                            00000003
TMR4ON                            00000002
TO                                00000003
TOS                               00000FFD
TOSH                              00000FFE
TOSL                              00000FFD
TOSU                              00000FFF
TRISA                             00000F92
TRISA0                            00000000
TRISA1                            00000001
TRISA2                            00000002
TRISA3                            00000003
TRISA4                            00000004
TRISA5                            00000005
TRISA6                            00000006
TRISA7                            00000007
TRISB                             00000F93
TRISB0                            00000000
TRISB1                            00000001
TRISB2                            00000002
TRISB3                            00000003
TRISB4                            00000004
TRISB5                            00000005
TRISB6                            00000006
TRISB7                            00000007
TRISC                             00000F94
TRISC0                            00000000
TRISC1                            00000001
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 128


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
TRISC2                            00000002
TRISC3                            00000003
TRISC4                            00000004
TRISC5                            00000005
TRISC6                            00000006
TRISC7                            00000007
TRISD                             00000F95
TRISD0                            00000000
TRISD1                            00000001
TRISD2                            00000002
TRISD3                            00000003
TRISD4                            00000004
TRISD5                            00000005
TRISD6                            00000006
TRISD7                            00000007
TRISE                             00000F96
TRISE0                            00000000
TRISE1                            00000001
TRISE2                            00000002
TRISE3                            00000003
TRISE4                            00000004
TRISE5                            00000005
TRISE6                            00000006
TRISE7                            00000007
TRISF                             00000F97
TRISF2                            00000002
TRISF3                            00000003
TRISF4                            00000004
TRISF5                            00000005
TRISF6                            00000006
TRISF7                            00000007
TRISG                             00000F98
TRISG0                            00000000
TRISG1                            00000001
TRISG2                            00000002
TRISG3                            00000003
TRISG4                            00000004
TRISH                             00000F99
TRISH0                            00000000
TRISH1                            00000001
TRISH2                            00000002
TRISH3                            00000003
TRISH4                            00000004
TRISH5                            00000005
TRISH6                            00000006
TRISH7                            00000007
TRISJ                             00000F9A
TRISJ0                            00000000
TRISJ1                            00000001
TRISJ2                            00000002
TRISJ3                            00000003
TRISJ4                            00000004
TRISJ5                            00000005
TRISJ6                            00000006
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 129


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
TRISJ7                            00000007
TRMT                              00000001
TRNIE                             00000003
TRNIF                             00000003
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
TUN5                              00000005
TX                                00000006
TX1IE                             00000004
TX1IF                             00000004
TX1IP                             00000004
TX2                               00000001
TX2IE                             00000004
TX2IF                             00000004
TX2IP                             00000004
TX8_9                             00000006
TX9                               00000006
TX9D                              00000000
TXCKP                             00000004
TXD8                              00000000
TXEN                              00000005
TXIE                              00000004
TXIF                              00000004
TXIP                              00000004
TXREG                             00000FAE
TXREG1                            00000FAE
TXREG2                            00000FA9
TXSTA                             00000FAD
TXSTA1                            00000FAD
TXSTA2                            00000FA8
U1OD                              00000000
U2OD                              00000001
UA                                00000001
UADDR                             00000F5E
UB                                00000007
UCFG                              00000F5F
UCON                              00000F65
UEIE                              00000F5D
UEIR                              00000F63
UEP0                              00000F4C
UEP1                              00000F4D
UEP10                             00000F56
UEP11                             00000F57
UEP12                             00000F58
UEP13                             00000F59
UEP14                             00000F5A
UEP15                             00000F5B
UEP2                              00000F4E
UEP3                              00000F4F
UEP4                              00000F50
UEP5                              00000F51
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 130


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
UEP6                              00000F52
UEP7                              00000F53
UEP8                              00000F54
UEP9                              00000F55
UERRIE                            00000001
UERRIF                            00000001
UFRM                              00000F60
UFRMH                             00000F61
UFRML                             00000F60
UIE                               00000F5C
UIR                               00000F62
UOEMON                            00000006
UPUEN                             00000004
URSTIE                            00000000
URSTIF                            00000000
USART1OD                          00000000
USART2OD                          00000001
USBEN                             00000003
USBIE                             00000004
USBIF                             00000004
USBIP                             00000004
USTAT                             00000F64
UTEYE                             00000007
UTRDIS                            00000003
VCFG0                             00000006
VCFG1                             00000007
VREFM                             00000002
VREFP                             00000003
W                                 00000000
WAIT0                             00000004
WAIT1                             00000005
WAITB0                            00000006
WAITB1                            00000007
WAITE0                            00000000
WAITE1                            00000001
WAITM0                            00000002
WAITM1                            00000003
WAITM2                            00000004
WAITM3                            00000005
WCOL                              00000007
WDTCON                            00000FC0
WM0                               00000000
WM1                               00000001
WPROG                             00000005
WR                                00000001
WREG                              00000FE8
WREN                              00000002
WRERR                             00000003
WRH                               00000003
WRL                               00000002
WRSP                              00000001
WUE                               00000001
W_REGISTER_1                      00001F32
W_REGISTER_5                      00001F5E
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 131


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
W_TX_PAYLOAD_10                   00002006
Z                                 00000002
_DEVID1                           003FFFFE
_DEVID2                           003FFFFF
_N                                00000037
__18F86J50                        00000001
adelante                          0000007E
girar                             0000007D
label0                            0000298E
label1                            000029D2
loopEnd                           000029E4
sensorLuz                         0000007C
ACCE_CSN                          PORTD,7
ACCE_CSN_TRIS                     TRISD,7
ACCE_INT1_DRDY                    PORTB,1
ACCE_INT1_DRDY_TRIS               TRISB,1
ACCE_INT2                         PORTB,2
ACCE_INT2_TRIS                    TRISB,2
ACCE_SCL                          PORTD,6
ACCE_SCL_TRIS                     TRISD,6
ACCE_SDI                          PORTD,5
ACCE_SDI_TRIS                     TRISD,5
ACCE_SDO                          PORTD,4
ACCE_SDO_TRIS                     TRISD,4
ACCE_TAP_LAT                      b'00000100'
ACCE_TAP_SENSI                    b'01110000'
ACCE_TAP_WINDOW                   b'01111111'
ACK                               1
BATTERY_IN                        PORTH,6
BATTERY_TRIS                      TRISH,6
CAM_CSN_PIN                       PORTF,2
CAM_CSN_TRIS                      TRISF,2
CAM_SCK_PIN                       PORTC,3
CAM_SCK_TRIS                      TRISC,3
CAM_SDI_PIN                       PORTC,4
CAM_SDI_TRIS                      TRISC,4
CAM_SDO_PIN                       PORTC,5
CAM_SDO_TRIS                      TRISC,5
CE_PIN                            PORTH,4
CE_TRIS                           TRISH,4
COM                               1
COMOK                             0
COMTYPE                           2
COM_CHA_VEL                       0x01
COM_CUR                           0x03
COM_RD                            0x41
COM_ROT                           0x02
COM_STOP                          0x04
COM_STR                           0x00
COM_WR                            0x40
CONFIGOK                          6
CSN_PIN                           PORTF,2
CSN_TRIS                          TRISF,2
CTL1                              0x18
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 132


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
CTL2                              0x19
DAT1                              2
DAT2                              3
DAT3                              4
DDRA                              TRISA
DDRB                              TRISB
DDRC                              TRISC
DDRD                              TRISD
DDRE                              TRISE
DETSRC                            0x0A
DIR_M                             0
DIV_100_MAX_BAT_ADC_MIN_BAT_ADC   .3
DWRONG                            1
FWDBACK                           0
I2CAD                             0x0D
INTRST                            0x17
IODIR_ADD                         0x00
IRQ_PIN                           PORTB,0
IRQ_TRIS                          TRISB,0
IR_RX_L_1                         PORTA,1
IR_RX_L_1_TRIS                    TRISA,1
IR_RX_L_2                         PORTA,3
IR_RX_L_2_TRIS                    TRISA,3
IR_RX_R_1                         PORTF,6
IR_RX_R_1_TRIS                    TRISF,6
IR_RX_R_2                         PORTF,5
IR_RX_R_2_TRIS                    TRISF,5
IR_TX                             PORTJ,6
IR_TX_TRIS                        TRISJ,6
LDTH                              0x1A
LED_BRAKE                         PORTE,5
LED_BRAKE_TRIS                    TRISE,5
LED_FRONT                         PORTC,7
LED_FRONT_TRIS                    TRISC,7
LED_IR                            PORTJ,7
LED_IR_TRIS                       TRISJ,7
LED_TOP_GREEN                     PORTB,6
LED_TOP_GREEN_TRIS                TRISB,6
LED_TOP_RED                       PORTB,5
LED_TOP_RED_TRIS                  TRISB,5
LIGHT_SEN                         PORTA,0
LIGHT_SEN_TRIS                    TRISA,0
LINE_RX_L                         PORTA,5
LINE_RX_L_TRIS                    TRISA,5
LINE_RX_R                         PORTA,2
LINE_RX_R_TRIS                    TRISA,2
LINE_TX                           PORTD,1
LINE_TX_TRIS                      TRISD,1
LT                                0x1D
MAX_BAT_ADC                       .162
MCTL                              0x16
MIC_IN                            PORTH,7
MIC_IN_TRIS                       TRISH,7
MIN_BAT_ADC                       .132
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 133


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
MOT_DIR_M                         0x10
MOT_END                           PORTE,7
MOT_END_TRIS                      TRISE,7
NO_ACK_INTENTO                    5
NTC                               PORTH,5
NTC_TRIS                          TRISH,5
OBS_CENTER_L                      0
OBS_CENTER_R                      2
OBS_SIDE_L                        1
OBS_SIDE_R                        3
OFFOK                             5
OLAT_ADD                          0x0A
ONOK                              4
PDTH                              0x1B
PW                                0x1C
RCVNW                             3
RCVOK                             2
RL                                1
RST_D                             0x01
RST_KM                            0x02
RST_T                             0x00
SCK_PIN                           PORTC,3
SCK_TRIS                          TRISC,3
SCL_SOFT                          PORTE,0
SCL_TRIS                          TRISE,0
SDA_SOFT                          PORTE,1
SDA_TRIS                          TRISE,1
SDI_PIN                           PORTC,4
SDI_TRIS                          TRISC,4
SDO_PIN                           PORTC,5
SDO_TRIS                          TRISC,5
SENOK                             1
SNDOK                             0
SPEAKER                           PORTB,3
SPEAKER_OFF                       0
SPEAKER_ON                        1
SPEAKER_TIME                      2
SPEAKER_TRIS                      TRISB,3
STATUS_A                          0x01
STATUS_ACCE                       0x09
STATUS_D_L                        0x05
STATUS_D_R                        0x04
STATUS_KM                         0x06
STATUS_T                          0x00
STATUS_V_L                        0x03
STATUS_V_R                        0x02
TAP                               0
TAP_TAP                           1
TOUT                              0x0B
TW                                0x1E
USRINF                            0x0E
WHOAMI                            0x0F
XOFFH                             0x11
XOFFL                             0x10
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 134


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
XOUT8                             0x06
XOUTH                             0x01
XOUTL                             0x00
YOFFH                             0x13
YOFFL                             0x12
YOUT8                             0x07
YOUTH                             0x03
YOUTL                             0x02
ZOFFH                             0x15
ZOFFL                             0x14
ZOUT8                             0x08
ZOUTH                             0x05
ZOUTL                             0x04


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

00001000 : XXXX------------ ---------------- ----------XXXXXX XXXXXXXXXXXXXXXX
00001040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000010c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000011c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000012c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001300 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001340 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001380 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000013c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001480 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000014c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001500 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001540 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001580 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000015c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001600 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001640 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001680 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000016c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001700 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001740 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001780 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000017c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001800 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001840 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001880 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000018c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001900 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 135


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
00001940 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001980 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000019c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001a00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001a40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001a80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001ac0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001b00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001b40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001b80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001bc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001c00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001c40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001c80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001cc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001d00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001d40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001d80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001dc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001e00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001e40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001e80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001ec0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001f00 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001f40 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001f80 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00001fc0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002000 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002040 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002080 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000020c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002100 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002140 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002180 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000021c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002200 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002240 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002280 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000022c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002300 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002340 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002380 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000023c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002400 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002440 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002480 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000024c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002500 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002540 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002580 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000025c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002600 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002640 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002680 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
gpasm-0.13.7 beta               C:\Users\Luis\Documents\mOproj\transmisor_movimiento-files\transmisor_movimiento.asm1-14-2015  20:38:09          PAGE 136


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
000026c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002700 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002740 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002780 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000027c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002800 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002840 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002880 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000028c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002900 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002940 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00002980 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
000029c0 : XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXX-------- ----------------

All other memory blocks unused.

Program Memory Words Used: 3297


Errors   :       0
Warnings :       0 reported,       0 suppressed
Messages :       9 reported,       0 suppressed

